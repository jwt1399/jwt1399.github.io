<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="SpringCloud-å®ç”¨ç¯‡, ç®€ç®€,ç®€ç®€åšå®¢,ç½‘ç»œå®‰å…¨,è®¡ç®—æœº,Javaå¼€å‘">
    <meta name="description" content="
å®ç”¨ç¯‡åŒ…å«å¾®æœåŠ¡æ²»ç†(æ³¨å†Œå‘ç°ï¼Œè¿œç¨‹è°ƒç”¨ï¼Œé…ç½®ç®¡ç†ï¼Œç½‘å…³è·¯ç”±)ã€DockeræŠ€æœ¯ã€å¼‚æ­¥é€šä¿¡ã€åˆ†å¸ƒå¼ç¼“å­˜ã€åˆ†å¸ƒå¼æœç´¢

å°ç®€ä» 0 å¼€å§‹å­¦ Java çŸ¥è¯†ä¹‹ Java-å­¦ä¹ è·¯çº¿ ä¸­çš„ã€ŠSpringCloud-å®ç”¨ç¯‡ã€‹ï¼Œä¸å®šæœŸæ›´æ–°æ‰€å­¦ç¬”è®°ï¼ŒæœŸ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html;charset=gb2312" />
    <meta name="sogou_site_verification" content="VTcD33rrfd" />
    <meta name="google-site-verification" content="mHsYpjV9Rl0e0UzjioJFLg8RMtOhxw8HB3D21dIWvmc" />
	<meta name="referrer" content="unsafe-url">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SpringCloud-å®ç”¨ç¯‡ | ç®€è¨€ä¹‹</title>
    <link rel="icon" type="image/png" href="/favicon.png">
	<!--å˜ç°-->
	<!-- <link href="http://static.isenyu.cn/file/css/MemorialDay.css"; rel="stylesheet" type="text/css" /> -->
    <!-- <style type="text/css">
     html{ filter: grayscale(100%); /* æ ‡å‡†å†™æ³• just for IE6-9 */ 
        -webkit-filter: grayscale(100%); /* webkit å†…æ ¸æ”¯æŒç¨‹åº¦è¾ƒå¥½ */ 
        -moz-filter: grayscale(100%); /* å…¶ä»–å†…æ ¸ç°åœ¨å¹¶ä¸æ”¯æŒï¼Œä¸ºäº†å°†æ¥å…¼å®¹æ€§ä¹¦å†™ */ 
        -ms-filter: grayscale(100%); 
        -o-filter: grayscale(100%); filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);
        filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); /* Firefox 3.5+ */ }
     </style> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.staticfile.org/font-awesome/6.0.0/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.staticfile.org/aos/0.1.0/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="https://upcdn.b0.upaiyun.com/libs/jquery/jquery-2.0.3.min.js"></script>
	<!--valine_äººæœºéªŒè¯-->
	<script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
	<script src="/js/Valine-RJyanzheng.js"></script>

    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="alternate" href="/atom.xml" title="ç®€è¨€ä¹‹" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img no-lazy src="/medias/logo.png" class="logo-img" alt="">
                    
                    <span class="logo-span">ç®€è¨€ä¹‹</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Home</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-user-secret" style="zoom: 0.6;"></i>
      
      <span>Sec</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/categories/Web/">
          
          <i class="fab fa-internet-explorer" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Web</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/CTF/">
          
          <i class="fas fa-flag" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>CTF</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/Crypto/">
          
          <i class="fa-solid fa-shield" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Data</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fab fa-java" style="zoom: 0.6;"></i>
      
      <span>Java</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/categories/JavaSE/">
          
          <i class="fa-solid fa-mug-saucer" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>JavaSE</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/JavaWeb/">
          
          <i class="fa-solid fa-earth-americas" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>JavaWeb</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/Spring/">
          
          <i class="fa-solid fa-leaf" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Spring</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/Q-A/">
          
          <i class="fa-solid fa-bell" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Q&A</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fa-solid fa-desktop" style="zoom: 0.6;"></i>
      
      <span>CS</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/categories/CS%E5%9F%BA%E7%A1%80/">
          
          <i class="fa-solid fa-server" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>CSåŸºç¡€</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/SQL/">
          
          <i class="fas fa-database" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>æ•°æ®åº“</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/">
          
          <i class="fa-solid fa-bezier-curve" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>ç»“æ„-ç®—æ³•</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-layer-group" style="zoom: 0.6;"></i>
      
      <span>Others</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/categories/Python/">
          
          <i class="fab fa-python" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Python</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/Course/">
          
          <i class="fa-solid fa-graduation-cap" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Course</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/Share/">
          
          <i class="fa-solid fa-crown" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Share~</span>
        </a>
      </li>
      
      <li>
        <a href="/categories/Tools/">
          
          <i class="fas fa-tools" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Tools~</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>æ•´ç†</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/tags/">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>å½’ç±»</span>
        </a>
      </li>
      
      <li>
        <a href="/archives/">
          
          <i class="fas fa-file-contract" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>å½’æ¡£</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fa-solid fa-paper-plane" style="zoom: 0.6;"></i>
      
      <span>äº¤æµ</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/friends/">
          
          <i class="fas fa-venus-mars" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>å‹é“¾</span>
        </a>
      </li>
      
      <li>
        <a href="/contact/">
          
          <i class="fas fa-envelope" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>ç•™è¨€</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about/" class="waves-effect waves-light">
      
      <i class="fas fa-id-card-alt" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img no-lazy src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ç®€è¨€ä¹‹</div>
        <div class="logo-desc">
            
            æ‚„æ— å£°æ¯åœ°å˜åšå¼ºï¼Œå®‰é™åœ°å˜ä¼˜ç§€ï¼
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Home
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-user-secret"></i>
			
			Sec
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/categories/Web/ " style="margin-left:50px";>
				  
				   <i class="fab fa-internet-explorer" style="position: absolute;left:28px" ></i>
			      
		          <span>Web</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/CTF/ " style="margin-left:50px";>
				  
				   <i class="fas fa-flag" style="position: absolute;left:28px" ></i>
			      
		          <span>CTF</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/Crypto/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-shield" style="position: absolute;left:28px" ></i>
			      
		          <span>Data</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fab fa-java"></i>
			
			Java
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/categories/JavaSE/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-mug-saucer" style="position: absolute;left:28px" ></i>
			      
		          <span>JavaSE</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/JavaWeb/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-earth-americas" style="position: absolute;left:28px" ></i>
			      
		          <span>JavaWeb</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/Spring/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-leaf" style="position: absolute;left:28px" ></i>
			      
		          <span>Spring</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/Q-A/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-bell" style="position: absolute;left:28px" ></i>
			      
		          <span>Q&A</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fa-solid fa-desktop"></i>
			
			CS
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/categories/CS%E5%9F%BA%E7%A1%80/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-server" style="position: absolute;left:28px" ></i>
			      
		          <span>CSåŸºç¡€</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/SQL/ " style="margin-left:50px";>
				  
				   <i class="fas fa-database" style="position: absolute;left:28px" ></i>
			      
		          <span>æ•°æ®åº“</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-bezier-curve" style="position: absolute;left:28px" ></i>
			      
		          <span>ç»“æ„-ç®—æ³•</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-layer-group"></i>
			
			Others
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/categories/Python/ " style="margin-left:50px";>
				  
				   <i class="fab fa-python" style="position: absolute;left:28px" ></i>
			      
		          <span>Python</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/Course/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-graduation-cap" style="position: absolute;left:28px" ></i>
			      
		          <span>Course</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/Share/ " style="margin-left:50px";>
				  
				   <i class="fa-solid fa-crown" style="position: absolute;left:28px" ></i>
			      
		          <span>Share~</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/categories/Tools/ " style="margin-left:50px";>
				  
				   <i class="fas fa-tools" style="position: absolute;left:28px" ></i>
			      
		          <span>Tools~</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			æ•´ç†
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/tags/ " style="margin-left:50px";>
				  
				   <i class="fas fa-bookmark" style="position: absolute;left:28px" ></i>
			      
		          <span>å½’ç±»</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/archives/ " style="margin-left:50px";>
				  
				   <i class="fas fa-file-contract" style="position: absolute;left:28px" ></i>
			      
		          <span>å½’æ¡£</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fa-solid fa-paper-plane"></i>
			
			äº¤æµ
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/friends/ " style="margin-left:50px";>
				  
				   <i class="fas fa-venus-mars" style="position: absolute;left:28px" ></i>
			      
		          <span>å‹é“¾</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact/ " style="margin-left:50px";>
				  
				   <i class="fas fa-envelope" style="position: absolute;left:28px" ></i>
			      
		          <span>ç•™è¨€</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-id-card-alt"></i>
			
			å…³äº
		</a>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('çŒœçŒœå¯†ç æ˜¯ä»€ä¹ˆå‘¢ãƒ¾ï¾‰â‰§âˆ€â‰¦)o')).toString(CryptoJS.enc.Hex)) {
                alert('å“å‘¦ï¼å¯†ç å¥½åƒä¸å¯¹å“Ÿï¼Œå°†è¿”å›ä¸»é¡µï¼');
                location.href = '/';	
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://img.jwt1399.top/img/202210091429098.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">SpringCloud-å®ç”¨ç¯‡</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    /*.toc-widget {
        width: 345px;
        padding-left: 20px;
    }*/
    .toc-widget {
        width: 345px;
        padding-left: 20px;
        /* æ¯›ç»ç’ƒ */
        /*background-color: rgba(162,101,228, 0.08);*/
        /*backdrop-filter: saturate(180%) blur(20px);*/
        /*ç›®å½•æ ·å¼ä¿®æ”¹*/
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }
    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/SpringCloud/">
                                <span class="chip bg-color">SpringCloud</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Spring/" class="post-category">
                                Spring
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2022-09-20
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>æ›´æ–°æ—¥æœŸ:&nbsp;&nbsp;
                    2022-10-10
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    19.7k
                </div>
                

                
				
                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>å®ç”¨ç¯‡åŒ…å«å¾®æœåŠ¡æ²»ç†(æ³¨å†Œå‘ç°ï¼Œè¿œç¨‹è°ƒç”¨ï¼Œé…ç½®ç®¡ç†ï¼Œç½‘å…³è·¯ç”±)ã€DockeræŠ€æœ¯ã€å¼‚æ­¥é€šä¿¡ã€åˆ†å¸ƒå¼ç¼“å­˜ã€åˆ†å¸ƒå¼æœç´¢</p>
</blockquote>
<p>å°ç®€ä» 0 å¼€å§‹å­¦ Java çŸ¥è¯†ä¹‹ <a href="https://jwt1399.top/posts/29829.html">Java-å­¦ä¹ è·¯çº¿</a> ä¸­çš„ã€ŠSpringCloud-å®ç”¨ç¯‡ã€‹ï¼Œä¸å®šæœŸæ›´æ–°æ‰€å­¦ç¬”è®°ï¼ŒæœŸå¾…ä¸€å¹´åçš„èœ•å˜å§ï¼&lt;æœ‰åŒæ ·æƒ³æ³•çš„å°ä¼™ä¼´ï¼Œå¯ä»¥è”ç³»æˆ‘ä¸€èµ·äº¤æµå­¦ä¹ å“¦ï¼&gt;</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> ğŸš©æ—¶é—´å®‰æ’ï¼šé¢„è®¡10å¤©æ›´æ–°å®Œ</li>
<li><input checked="" disabled="" type="checkbox"> ğŸ¯å¼€å§‹æ—¶é—´ï¼š09-20</li>
<li><input checked="" disabled="" type="checkbox"> ğŸ‰ç»“æŸæ—¶é—´ï¼š09-30</li>
<li><input checked="" disabled="" type="checkbox"> ğŸ€æ€»ç»“ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://img.jwt1399.top/img/202209201412578.png" alt="å­¦ä¹ å®‰æ’"></th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://img.jwt1399.top/img/202209201436751.png" alt="æŠ€æœ¯åˆ†ç±»"></td>
</tr>
</tbody></table>
<h1 id="1-å¾®æœåŠ¡"><a href="#1-å¾®æœåŠ¡" class="headerlink" title="1.å¾®æœåŠ¡"></a>1.å¾®æœåŠ¡</h1><h2 id="â‘ æ¶æ„å¯¹æ¯”"><a href="#â‘ æ¶æ„å¯¹æ¯”" class="headerlink" title="â‘ æ¶æ„å¯¹æ¯”"></a>â‘ æ¶æ„å¯¹æ¯”</h2><table>
<thead>
<tr>
<th><code>æ¶æ„</code></th>
<th><code>å•ä½“æ¶æ„</code></th>
<th><code>åˆ†å¸ƒå¼æ¶æ„</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong><code>æè¿°</code></strong></td>
<td>å°†ä¸šåŠ¡çš„æ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å¼€å‘ï¼Œæ‰“æˆä¸€ä¸ªåŒ…éƒ¨ç½²ã€‚</td>
<td>æ ¹æ®ä¸šåŠ¡åŠŸèƒ½å¯¹ç³»ç»Ÿåšæ‹†åˆ†ï¼Œæ¯ä¸ªä¸šåŠ¡åŠŸèƒ½æ¨¡å—ä½œä¸ºç‹¬ç«‹é¡¹ç›®å¼€å‘ã€‚</td>
</tr>
<tr>
<td><strong><code>å›¾ç¤º</code></strong></td>
<td><img src="https://img.jwt1399.top/img/202209201338897.png"></td>
<td><img src="https://img.jwt1399.top/img/202209201338887.png"></td>
</tr>
<tr>
<td><strong><code>ä¼˜ç‚¹</code></strong></td>
<td>æ¶æ„ç®€å•ã€éƒ¨ç½²æˆæœ¬ä½</td>
<td>é™ä½æœåŠ¡è€¦åˆã€æœ‰åˆ©äºæœåŠ¡å‡çº§å’Œæ‹“å±•</td>
</tr>
<tr>
<td><strong><code>ç¼ºç‚¹</code></strong></td>
<td>è€¦åˆåº¦é«˜ï¼ˆç»´æŠ¤å›°éš¾ã€å‡çº§å›°éš¾ï¼‰</td>
<td>æœåŠ¡è°ƒç”¨å…³ç³»é”™ç»¼å¤æ‚</td>
</tr>
</tbody></table>
<p>åˆ†å¸ƒå¼æ¶æ„è™½ç„¶é™ä½äº†æœåŠ¡è€¦åˆï¼Œä½†æ˜¯æœåŠ¡æ‹†åˆ†æ—¶ä¹Ÿæœ‰å¾ˆå¤šé—®é¢˜éœ€è¦æ€è€ƒï¼š</p>
<ul>
<li>æœåŠ¡æ‹†åˆ†çš„ç²’åº¦å¦‚ä½•ç•Œå®šï¼Ÿ</li>
<li>æœåŠ¡é›†ç¾¤åœ°å€å¦‚ä½•ç»´æŠ¤ï¼Ÿ</li>
<li>æœåŠ¡çš„è°ƒç”¨å…³ç³»å¦‚ä½•ç®¡ç†ï¼Ÿ</li>
<li>æœåŠ¡å¥åº·çŠ¶æ€å¦‚ä½•æ„ŸçŸ¥ï¼Ÿ</li>
</ul>
<p>äººä»¬éœ€è¦åˆ¶å®šä¸€å¥—è¡Œä¹‹æœ‰æ•ˆçš„æ ‡å‡†æ¥çº¦æŸåˆ†å¸ƒå¼æ¶æ„ã€‚å› æ­¤å¾®æœåŠ¡æ¥å•¦ï¼ï¼ï¼</p>
<h2 id="â‘¡å¾®æœåŠ¡ç®€ä»‹"><a href="#â‘¡å¾®æœåŠ¡ç®€ä»‹" class="headerlink" title="â‘¡å¾®æœåŠ¡ç®€ä»‹"></a>â‘¡å¾®æœåŠ¡ç®€ä»‹</h2><p><strong>å¾®æœåŠ¡çš„æ¶æ„ç‰¹å¾ï¼š</strong></p>
<ul>
<li>å•ä¸€èŒè´£ï¼šå¾®æœåŠ¡æ‹†åˆ†ç²’åº¦æ›´å°ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½å¯¹åº”å”¯ä¸€çš„ä¸šåŠ¡èƒ½åŠ›ï¼Œåšåˆ°å•ä¸€èŒè´£</li>
<li>è‡ªæ²»ï¼šå›¢é˜Ÿç‹¬ç«‹ã€æŠ€æœ¯ç‹¬ç«‹ã€æ•°æ®ç‹¬ç«‹ï¼Œç‹¬ç«‹éƒ¨ç½²å’Œäº¤ä»˜</li>
<li>é¢å‘æœåŠ¡ï¼šæœåŠ¡æä¾›ç»Ÿä¸€æ ‡å‡†çš„æ¥å£ï¼Œä¸è¯­è¨€å’ŒæŠ€æœ¯æ— å…³</li>
<li>éš”ç¦»æ€§å¼ºï¼šæœåŠ¡è°ƒç”¨åšå¥½éš”ç¦»ã€å®¹é”™ã€é™çº§ï¼Œé¿å…å‡ºç°çº§è”é—®é¢˜</li>
</ul>
<p>å¾®æœåŠ¡çš„ä¸Šè¿°ç‰¹æ€§å…¶å®æ˜¯åœ¨ç»™åˆ†å¸ƒå¼æ¶æ„åˆ¶å®šä¸€ä¸ªæ ‡å‡†ï¼Œè¿›ä¸€æ­¥é™ä½æœåŠ¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæä¾›æœåŠ¡çš„ç‹¬ç«‹æ€§å’Œçµæ´»æ€§ã€‚åšåˆ°é«˜å†…èšï¼Œä½è€¦åˆã€‚å› æ­¤<strong>å¾®æœåŠ¡</strong>æ˜¯ä¸€ç§ç»è¿‡è‰¯å¥½æ¶æ„è®¾è®¡çš„<strong>åˆ†å¸ƒå¼æ¶æ„æ–¹æ¡ˆ</strong> ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202209201355158.png" alt="å¾®æœåŠ¡æ¶æ„"></p>
<p>ä½†æ–¹æ¡ˆè¯¥æ€ä¹ˆè½åœ°ï¼Ÿé€‰ç”¨ä»€ä¹ˆæ ·çš„æŠ€æœ¯æ ˆï¼Ÿå…¶ä¸­åœ¨Javaé¢†åŸŸæœ€å¼•äººæ³¨ç›®çš„å°±æ˜¯SpringCloudæä¾›çš„æ–¹æ¡ˆäº†ã€‚</p>
<h2 id="â‘¢å¾®æœåŠ¡æ–¹æ¡ˆ"><a href="#â‘¢å¾®æœåŠ¡æ–¹æ¡ˆ" class="headerlink" title="â‘¢å¾®æœåŠ¡æ–¹æ¡ˆ"></a>â‘¢å¾®æœåŠ¡æ–¹æ¡ˆ</h2><p>ç›®å‰å›½å†…ä½¿ç”¨æœ€å¹¿æ³›çš„å¾®æœåŠ¡æ–¹æ¡ˆï¼šDubboã€SpringCloudã€SpringCloudAlibaba</p>
<p><img src="https://img.jwt1399.top/img/202209201416386.png" alt="æ–¹æ¡ˆå¯¹æ¯”"></p>
<p><img src="https://img.jwt1399.top/img/202209201419610.png"></p>
<h2 id="â‘¤æ¡ˆä¾‹å¼•å…¥"><a href="#â‘¤æ¡ˆä¾‹å¼•å…¥" class="headerlink" title="â‘¤æ¡ˆä¾‹å¼•å…¥"></a>â‘¤æ¡ˆä¾‹å¼•å…¥</h2><blockquote>
<p>ä¸‹æ–¹çš„è®²è§£éƒ½åŸºäºæ­¤æ¡ˆä¾‹è¿›è¡Œï¼Œè¯·æå‰æ­å»ºå¥½æ­¤é¡¹ç›®ã€‚<a target="_blank" rel="noopener" href="https://jwt1399.lanzouv.com/b01dymdva">é¡¹ç›®cloud-demo</a> å¯†ç :1399</p>
<p>æ­å»ºæ–¹å¼ï¼š1.ä½¿ç”¨IDEA æ‰“å¼€ cloud-demoé¡¹ç›® 2.åˆ›å»ºä¸¤ä¸ªæ•°æ®åº“<code>cloud_order</code>å’Œ<code>cloud_user </code>3.å°†æä¾›çš„<code>cloud-order.sql</code>å’Œ<code>cloud-user.sql</code>å¯¼å…¥å¯¹åº”åº“ä¸­ 4.ä¿®æ”¹é¡¹ç›®ä¸­æ•°æ®åº“å¯†ç </p>
</blockquote>
<p><strong>é¡¹ç›®ç»“æ„ï¼š</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">cloud-demo  <span class="token comment" spellcheck="true"># çˆ¶å·¥ç¨‹ï¼Œç®¡ç†ä¾èµ–</span>
â”œâ”€â”€ order-service <span class="token comment" spellcheck="true"># è®¢å•å¾®æœåŠ¡ï¼Œè´Ÿè´£è®¢å•ç›¸å…³ä¸šåŠ¡</span>
â””â”€â”€ user-service  <span class="token comment" spellcheck="true"># ç”¨æˆ·å¾®æœåŠ¡ï¼Œè´Ÿè´£ç”¨æˆ·ç›¸å…³ä¸šåŠ¡</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>é¡¹ç›®ç‰¹å¾ï¼š</strong></p>
<ul>
<li>è®¢å•å¾®æœåŠ¡å’Œç”¨æˆ·å¾®æœåŠ¡æœ‰å„è‡ªçš„æ•°æ®åº“ï¼Œç›¸äº’ç‹¬ç«‹</li>
<li>è®¢å•æœåŠ¡å’Œç”¨æˆ·æœåŠ¡éƒ½å¯¹å¤–æš´éœ²Restfulçš„æ¥å£</li>
<li>è®¢å•æœåŠ¡å¦‚æœéœ€è¦æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œåªèƒ½è°ƒç”¨ç”¨æˆ·æœåŠ¡çš„Restfulæ¥å£ï¼Œä¸èƒ½æŸ¥è¯¢ç”¨æˆ·æ•°æ®åº“</li>
</ul>
<p><strong>åŸºç¡€æ¦‚å¿µï¼š</strong></p>
<p>åœ¨æœåŠ¡è°ƒç”¨å…³ç³»ä¸­ï¼Œä¼šæœ‰ä¸¤ä¸ªä¸åŒçš„è§’è‰²ï¼š</p>
<ul>
<li><p><strong>æœåŠ¡æä¾›è€…</strong>ï¼šä¸€æ¬¡ä¸šåŠ¡ä¸­ï¼Œè¢«å…¶å®ƒå¾®æœåŠ¡è°ƒç”¨çš„æœåŠ¡ã€‚ï¼ˆæä¾›æ¥å£ç»™å…¶å®ƒå¾®æœåŠ¡ï¼‰</p>
</li>
<li><p><strong>æœåŠ¡æ¶ˆè´¹è€…</strong>ï¼šä¸€æ¬¡ä¸šåŠ¡ä¸­ï¼Œè°ƒç”¨å…¶å®ƒå¾®æœåŠ¡çš„æœåŠ¡ã€‚ï¼ˆè°ƒç”¨å…¶å®ƒå¾®æœåŠ¡æä¾›çš„æ¥å£ï¼‰</p>
</li>
<li><p>æœåŠ¡æä¾›è€…ä¸æœåŠ¡æ¶ˆè´¹è€…çš„è§’è‰²å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œè€Œæ˜¯ç›¸å¯¹äºä¸šåŠ¡è€Œè¨€ã€‚</p>
</li>
</ul>
<p><img src="https://img.jwt1399.top/img/202209202043982.png"></p>
<p><strong>ç›®å‰éœ€æ±‚ï¼š</strong>ä¿®æ”¹order-serviceä¸­çš„æŸ¥è¯¢è®¢å•ä¸šåŠ¡ï¼Œè¦æ±‚åœ¨æŸ¥è¯¢è®¢å•çš„åŒæ—¶ï¼Œæ ¹æ®è®¢å•ä¸­åŒ…å«çš„userIdæŸ¥è¯¢å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œä¸€èµ·è¿”å›ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202209202020487.png"></p>
<h1 id="2-æœåŠ¡è¿œç¨‹è°ƒç”¨â‘ "><a href="#2-æœåŠ¡è¿œç¨‹è°ƒç”¨â‘ " class="headerlink" title="2.æœåŠ¡è¿œç¨‹è°ƒç”¨â‘ "></a>2.æœåŠ¡è¿œç¨‹è°ƒç”¨â‘ </h1><h2 id="â‘ RestTemplate"><a href="#â‘ RestTemplate" class="headerlink" title="â‘ RestTemplate"></a>â‘ RestTemplate</h2><p>è¦å®ç°ä¸Šæ–¹éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨order-serviceä¸­å‘user-serviceå‘èµ·ä¸€ä¸ªhttpçš„è¯·æ±‚ï¼Œè°ƒç”¨<code>http://localhost:8081/user/&#123;userId&#125;</code>æ¥å£ã€‚</p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ³¨å†Œä¸€ä¸ªRestTemplateçš„å®ä¾‹åˆ°Springå®¹å™¨</li>
<li>ä¿®æ”¹order-serviceæœåŠ¡ä¸­çš„OrderServiceç±»ä¸­çš„queryOrderByIdæ–¹æ³•ï¼Œæ ¹æ®Orderå¯¹è±¡ä¸­çš„userIdæŸ¥è¯¢User</li>
<li>å°†æŸ¥è¯¢çš„Userå¡«å……åˆ°Orderå¯¹è±¡ï¼Œä¸€èµ·è¿”å›</li>
</ul>
<p><strong>æ­¥éª¤ä¸€ï¼šæ³¨å†ŒRestTemplate</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"cn.xxxx.order.mapper"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> RestTemplate <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤äºŒï¼šå®ç°è¿œç¨‹è°ƒç”¨</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> OrderMapper orderMapper<span class="token punctuation">;</span>
  
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> RestTemplate restTemplate 

    <span class="token keyword">public</span> Order <span class="token function">queryOrderById</span><span class="token punctuation">(</span>Long orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1.æŸ¥è¯¢è®¢å•</span>
        Order order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.è¿œç¨‹æŸ¥è¯¢user</span>
        <span class="token comment" spellcheck="true">// 2.1 urlåœ°å€</span>
        String url <span class="token operator">=</span> <span class="token string">"http://localhost:8081/user/"</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.2 å‘èµ·è°ƒç”¨</span>
        User user <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 3.å­˜å…¥order</span>
        order<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 4.è¿”å›</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="3-æœåŠ¡æ³¨å†Œå‘ç°"><a href="#3-æœåŠ¡æ³¨å†Œå‘ç°" class="headerlink" title="3.æœåŠ¡æ³¨å†Œå‘ç°"></a>3.æœåŠ¡æ³¨å†Œå‘ç°</h1><h2 id="â‘ Eureka"><a href="#â‘ Eureka" class="headerlink" title="â‘ Eureka"></a>â‘ Eureka</h2><blockquote>
<p>å‡å¦‚æˆ‘ä»¬çš„æœåŠ¡æä¾›è€…user-serviceéƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œå¦‚å›¾ï¼š</p>
<img src="https://img.jwt1399.top/img/202209202108940.png" style="zoom: 25%;" />

<p>æ€è€ƒå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>order-serviceåœ¨å‘èµ·è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•å¾—çŸ¥user-serviceå®ä¾‹çš„ipåœ°å€å’Œç«¯å£ï¼Ÿ</li>
<li>æœ‰å¤šä¸ªuser-serviceå®ä¾‹åœ°å€ï¼Œorder-serviceè°ƒç”¨æ—¶è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</li>
<li>order-serviceå¦‚ä½•å¾—çŸ¥æŸä¸ªuser-serviceå®ä¾‹æ˜¯å¦ä¾ç„¶å¥åº·ï¼Œæ˜¯ä¸æ˜¯å·²ç»å®•æœºï¼Ÿ</li>
</ul>
</blockquote>
<h3 id="â¶EurekaåŸç†åˆ†æ"><a href="#â¶EurekaåŸç†åˆ†æ" class="headerlink" title="â¶EurekaåŸç†åˆ†æ"></a>â¶EurekaåŸç†åˆ†æ</h3><p>è¿™äº›é—®é¢˜éƒ½éœ€è¦åˆ©ç”¨SpringCloudä¸­çš„æ³¨å†Œä¸­å¿ƒæ¥è§£å†³ï¼Œå…¶ä¸­æœ€å¹¿ä¸ºäººçŸ¥çš„æ³¨å†Œä¸­å¿ƒå°±æ˜¯Eurekaï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209202112546.png"></p>
<p>é—®é¢˜1ï¼šorder-serviceå¦‚ä½•å¾—çŸ¥user-serviceå®ä¾‹åœ°å€ï¼Ÿ</p>
<ul>
<li>user-serviceæœåŠ¡å®ä¾‹å¯åŠ¨åï¼Œå°†è‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ°eureka-serverï¼ˆEurekaæœåŠ¡ç«¯ï¼‰ã€‚è¿™ä¸ªå«æœåŠ¡æ³¨å†Œ</li>
<li>eureka-serverä¿å­˜æœåŠ¡åç§°åˆ°æœåŠ¡å®ä¾‹åœ°å€åˆ—è¡¨çš„æ˜ å°„å…³ç³»</li>
<li>order-serviceæ ¹æ®æœåŠ¡åç§°ï¼Œæ‹‰å–å®ä¾‹åœ°å€åˆ—è¡¨ã€‚è¿™ä¸ªå«æœåŠ¡å‘ç°æˆ–æœåŠ¡æ‹‰å–</li>
</ul>
<p>é—®é¢˜2ï¼šorder-serviceå¦‚ä½•ä»å¤šä¸ªuser-serviceå®ä¾‹ä¸­é€‰æ‹©å…·ä½“çš„å®ä¾‹ï¼Ÿ</p>
<ul>
<li>order-serviceä»å®ä¾‹åˆ—è¡¨ä¸­åˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•é€‰ä¸­ä¸€ä¸ªå®ä¾‹åœ°å€</li>
<li>å¹¶å‘è¯¥å®ä¾‹åœ°å€å‘èµ·è¿œç¨‹è°ƒç”¨</li>
</ul>
<p>é—®é¢˜3ï¼šorder-serviceå¦‚ä½•å¾—çŸ¥æŸä¸ªuser-serviceå®ä¾‹æ˜¯å¦ä¾ç„¶å¥åº·ï¼Œæ˜¯ä¸æ˜¯å·²ç»å®•æœºï¼Ÿ</p>
<ul>
<li>user-serviceä¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤30ç§’ï¼‰å‘eureka-serverå‘èµ·è¯·æ±‚ï¼ŒæŠ¥å‘Šè‡ªå·±çŠ¶æ€ï¼Œç§°ä¸ºå¿ƒè·³</li>
<li>å½“è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å‘é€å¿ƒè·³æ—¶ï¼Œeureka-serverä¼šè®¤ä¸ºå¾®æœåŠ¡å®ä¾‹æ•…éšœï¼Œå°†è¯¥å®ä¾‹ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤</li>
<li>order-serviceæ‹‰å–æœåŠ¡æ—¶ï¼Œå°±èƒ½å°†æ•…éšœå®ä¾‹æ’é™¤äº†</li>
</ul>
<p><img src="https://img.jwt1399.top/img/202209202118474.png" alt="ä½¿ç”¨æ­¥éª¤"></p>
<h3 id="â·æ­å»ºeureka-server"><a href="#â·æ­å»ºeureka-server" class="headerlink" title="â·æ­å»ºeureka-server"></a>â·æ­å»ºeureka-server</h3><p><strong>æ­¥éª¤ä¸€ï¼šåˆ›å»ºeureka-serveræ¨¡å—</strong></p>
<p>åœ¨cloud-demoçˆ¶å·¥ç¨‹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªmavenå­æ¨¡å— eureka-server</p>
<p><strong>æ­¥éª¤äºŒï¼šå¼•å…¥eurekaä¾èµ–</strong></p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤ä¸‰ï¼šç¼–å†™å¯åŠ¨ç±»</strong></p>
<p>ç¼–å†™ä¸€ä¸ªå¯åŠ¨ç±»ï¼Œæ·»åŠ <code>@EnableEurekaServer</code>æ³¨è§£ï¼Œå¼€å¯eurekaçš„æ³¨å†Œä¸­å¿ƒåŠŸèƒ½</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableEurekaServer</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>EurekaApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤å››ï¼šç¼–å†™é…ç½®æ–‡ä»¶</strong></p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10086</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>server
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span> 
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>10086/eureka
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤äº”ï¼šå¯åŠ¨æœåŠ¡</strong></p>
<p>å¯åŠ¨å¾®æœåŠ¡ï¼Œç„¶ååœ¨æµè§ˆå™¨è®¿é—®ï¼š<code>http://127.0.0.1:10086</code>ï¼Œçœ‹åˆ°Webé¡µé¢è¡¨ç¤ºæˆåŠŸäº†</p>
<h3 id="â¸æœåŠ¡æ³¨å†Œ"><a href="#â¸æœåŠ¡æ³¨å†Œ" class="headerlink" title="â¸æœåŠ¡æ³¨å†Œ"></a>â¸æœåŠ¡æ³¨å†Œ</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†user-serviceæ³¨å†Œåˆ°eureka-serverä¸­å»ã€‚</p>
<p><strong>æ­¥éª¤ä¸€ï¼šå¼•å…¥ä¾èµ–</strong></p>
<p>åœ¨user-serviceçš„pomæ–‡ä»¶ä¸­ï¼Œå¼•å…¥<code>eureka-client</code>ä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤äºŒï¼šé…ç½®æ–‡ä»¶</strong></p>
<p>åœ¨user-serviceä¸­ï¼Œä¿®æ”¹application.ymlæ–‡ä»¶ï¼Œæ·»åŠ æœåŠ¡åç§°ã€eurekaåœ°å€ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> userservice
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>10086/eureka
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤ä¸‰ï¼šå¯åŠ¨å¤šä¸ªuser-serviceå®ä¾‹</strong></p>
<p>ä¸ºäº†æ¼”ç¤ºä¸€ä¸ªæœåŠ¡æœ‰å¤šä¸ªå®ä¾‹çš„åœºæ™¯ï¼Œå¯ä»¥é€šè¿‡SpringBootçš„å¯åŠ¨é…ç½®ï¼Œå†å¯åŠ¨ä¸€ä¸ªuser-serviceã€‚</p>
<table>
<thead>
<tr>
<th>1.å¤åˆ¶åŸæ¥çš„user-serviceå¯åŠ¨é…ç½®ï¼š</th>
<th>2.åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œå¡«å†™ä¿¡æ¯ï¼š</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://img.jwt1399.top/img/202209211240292.png"></td>
<td><img src="https://img.jwt1399.top/img/202209211241706.png" style="zoom:50%;" /></td>
</tr>
<tr>
<td><strong>3.å‡ºç°ä¸¤ä¸ªuser-serviceå®ä¾‹</strong></td>
<td><strong>4.å¯åŠ¨ä¸¤ä¸ªuser-serviceå®ä¾‹</strong></td>
</tr>
<tr>
<td><img src="https://img.jwt1399.top/img/202209211241315.png"></td>
<td><img src="https://img.jwt1399.top/img/202209211241522.png"></td>
</tr>
</tbody></table>
<p>æŸ¥çœ‹eureka-serverç®¡ç†é¡µé¢ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211241215.png"></p>
<h3 id="â¹æœåŠ¡å‘ç°"><a href="#â¹æœåŠ¡å‘ç°" class="headerlink" title="â¹æœåŠ¡å‘ç°"></a>â¹æœåŠ¡å‘ç°</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†order-serviceçš„é€»è¾‘ä¿®æ”¹ï¼šå®ç°å‘eureka-serveræ‹‰å–user-serviceçš„ä¿¡æ¯ï¼Œå³æœåŠ¡å‘ç°ã€‚</p>
<p><strong>æ­¥éª¤ä¸€ï¼šå¼•å…¥ä¾èµ–</strong></p>
<p>æœåŠ¡å‘ç°ã€æœåŠ¡æ³¨å†Œç»Ÿä¸€éƒ½å°è£…åœ¨eureka-clientä¾èµ–ï¼Œå› æ­¤è¿™ä¸€æ­¥ä¸æœåŠ¡æ³¨å†Œæ—¶ä¸€è‡´ã€‚</p>
<p>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­ï¼Œå¼•å…¥eureka-clientä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤äºŒï¼šé…ç½®æ–‡ä»¶</strong></p>
<p>æœåŠ¡å‘ç°ä¹Ÿéœ€è¦çŸ¥é“eurekaåœ°å€ï¼Œåœ¨order-serviceä¸­ï¼Œä¿®æ”¹application.ymlæ–‡ä»¶ï¼Œæ·»åŠ æœåŠ¡åç§°ã€eurekaåœ°å€ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> orderservice
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>10086/eureka
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤ä¸‰ï¼šæœåŠ¡æ‹‰å–å’Œè´Ÿè½½å‡è¡¡</strong></p>
<p>æœ€åï¼Œæˆ‘ä»¬è¦å»eureka-serverä¸­æ‹‰å–user-serviceæœåŠ¡çš„å®ä¾‹åˆ—è¡¨ï¼Œå¹¶ä¸”å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<p>åœ¨order-serviceçš„OrderApplicationä¸­ï¼Œç»™RestTemplateè¿™ä¸ªBeanæ·»åŠ ä¸€ä¸ª@LoadBalancedæ³¨è§£ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"cn.xxxx.order.mapper"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment" spellcheck="true">//æ·»åŠ æ³¨è§£</span>
    <span class="token keyword">public</span> RestTemplate <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹order-serviceæœåŠ¡ä¸­çš„OrderServiceç±»ä¸­çš„queryOrderByIdæ–¹æ³•ã€‚ä¿®æ”¹è®¿é—®çš„urlè·¯å¾„ï¼Œç”¨æœåŠ¡åä»£æ›¿ipã€ç«¯å£ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> OrderMapper orderMapper<span class="token punctuation">;</span>
  
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> RestTemplate restTemplate 

    <span class="token keyword">public</span> Order <span class="token function">queryOrderById</span><span class="token punctuation">(</span>Long orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1.æŸ¥è¯¢è®¢å•</span>
        Order order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.è¿œç¨‹æŸ¥è¯¢user</span>
        <span class="token comment" spellcheck="true">// 2.1 urlåœ°å€</span>
                <span class="token comment" spellcheck="true">//String url = "http://localhost:8081/user/" + order.getUserId();</span>
        String url <span class="token operator">=</span> <span class="token string">"http://userservice/user/"</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.2 å‘èµ·è°ƒç”¨</span>
        User user <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 3.å­˜å…¥order</span>
        order<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 4.è¿”å›</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>springä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬ä»eureka-serverç«¯ï¼Œæ ¹æ®userserviceè¿™ä¸ªæœåŠ¡åç§°ï¼Œè·å–å®ä¾‹åˆ—è¡¨ï¼Œè€Œåå®Œæˆè´Ÿè½½å‡è¡¡ã€‚</p>
<h3 id="âºæ€»ç»“"><a href="#âºæ€»ç»“" class="headerlink" title="âºæ€»ç»“"></a>âºæ€»ç»“</h3><ul>
<li><p>1.æ­å»ºEurekaServer</p>
<ul>
<li><p>å¼•å…¥eureka-serverä¾èµ–</p>
</li>
<li><p>æ·»åŠ @EnableEurekaServeræ³¨è§£</p>
</li>
<li><p>åœ¨application.ymlä¸­é…ç½®eurekaåœ°å€</p>
</li>
</ul>
</li>
<li><p>2.æœåŠ¡æ³¨å†Œ</p>
<ul>
<li>å¼•å…¥eureka-clientä¾èµ–</li>
<li>åœ¨application.ymlä¸­é…ç½®eurekaåœ°å€</li>
</ul>
</li>
<li><p>3.æœåŠ¡å‘ç°</p>
<ul>
<li>å¼•å…¥eureka-clientä¾èµ–</li>
<li>åœ¨application.ymlä¸­é…ç½®eurekaåœ°å€</li>
<li>ç»™RestTemplateæ·»åŠ @LoadBalancedæ³¨è§£</li>
<li>ç”¨æœåŠ¡æä¾›è€…çš„æœåŠ¡åç§°è¿œç¨‹è°ƒç”¨</li>
</ul>
</li>
</ul>
<h2 id="â‘¡Nacos"><a href="#â‘¡Nacos" class="headerlink" title="â‘¡Nacos"></a>â‘¡Nacos</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://nacos.io/">Nacos</a>æ˜¯é˜¿é‡Œå·´å·´çš„äº§å“ï¼Œæ˜¯ SpringCloudAlibaba ä¸­çš„ä¸€ä¸ªç»„ä»¶ã€‚ç›¸æ¯” Eureka åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œåœ¨å›½å†…å—æ¬¢è¿ç¨‹åº¦è¾ƒé«˜ã€‚</p>
</blockquote>
<h3 id="â¶å®‰è£…"><a href="#â¶å®‰è£…" class="headerlink" title="â¶å®‰è£…"></a>â¶å®‰è£…</h3><p>ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos">https://github.com/alibaba/nacos</a></p>
<p>ä¸‹è½½åè§£å‹å³å¯ï¼Œç›®å½•è¯´æ˜ï¼š</p>
<pre><code>- log           nacosç”Ÿæˆæ—¥å¿—è¯´æ˜
- bin           nacosæœåŠ¡ç›¸å…³è„šæœ¬ç›®å½•ï¼Œ
- conf          nacosçš„é…ç½®æ–‡ä»¶ç›®å½•
- target        nacosçš„å¯åŠ¨ä¾èµ–ç›®å½•
- data          nacosè‡ªå¸¦apache-derbyæ•°æ®åº“ï¼Œdataå­˜æ”¾æ•°æ®å†…å®¹
</code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¯åŠ¨å‘½ä»¤ å•ä½“å¯åŠ¨</span>
sh startup.sh -m standalone

<span class="token comment" spellcheck="true"># å…³é—­å‘½ä»¤</span>
sh shutdown.sh
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€å³å¯è®¿é—®ï¼š<code>http://127.0.0.1:8848/nacos</code>ï¼Œé»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯nacos</p>
<p>å¦‚æœä½ æ‰“ä¸å¼€è¿™ä¸ªç½‘é¡µ ï¼å¤šåŠæ˜¯ç‰ˆæœ¬é—®é¢˜ã€‚</p>
<h3 id="â·æœåŠ¡æ³¨å†Œ-x2F-å‘ç°"><a href="#â·æœåŠ¡æ³¨å†Œ-x2F-å‘ç°" class="headerlink" title="â·æœåŠ¡æ³¨å†Œ&#x2F;å‘ç°"></a>â·æœåŠ¡æ³¨å†Œ&#x2F;å‘ç°</h3><p><strong>æ­¥éª¤ä¸€ï¼šå¼•å…¥ä¾èµ–</strong></p>
<p>åœ¨cloud-demoçˆ¶å·¥ç¨‹çš„pomæ–‡ä»¶ä¸­çš„<code>&lt;dependencyManagement&gt;</code>ä¸­å¼•å…¥SpringCloudAlibabaçš„ä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶ååœ¨user-serviceå’Œorder-serviceä¸­çš„pomæ–‡ä»¶ä¸­å¼•å…¥nacos-discoveryä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä¸è¦å¿˜äº†æ³¨é‡Šæ‰eurekaçš„ä¾èµ–ã€‚</p>
</blockquote>
<p><strong>æ­¥éª¤äºŒï¼šé…ç½®nacosåœ°å€</strong></p>
<p>åœ¨user-serviceå’Œorder-serviceçš„application.ymlä¸­æ·»åŠ nacosåœ°å€ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä¸è¦å¿˜äº†æ³¨é‡Šæ‰eurekaçš„åœ°å€</p>
</blockquote>
<p><strong>æ­¥éª¤ä¸‰ï¼šé‡å¯</strong></p>
<p>é‡å¯å¾®æœåŠ¡åï¼Œç™»å½•nacosç®¡ç†é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å¾®æœåŠ¡ä¿¡æ¯</p>
<p><img src="https://img.jwt1399.top/img/202209211820247.png"></p>
<h3 id="â¸é›†ç¾¤é…ç½®"><a href="#â¸é›†ç¾¤é…ç½®" class="headerlink" title="â¸é›†ç¾¤é…ç½®"></a>â¸é›†ç¾¤é…ç½®</h3><h4 id="â“µåˆ†çº§å­˜å‚¨æ¨¡å‹"><a href="#â“µåˆ†çº§å­˜å‚¨æ¨¡å‹" class="headerlink" title="â“µåˆ†çº§å­˜å‚¨æ¨¡å‹"></a>â“µåˆ†çº§å­˜å‚¨æ¨¡å‹</h4><p>ä¸€ä¸ª<strong>æœåŠ¡</strong>å¯ä»¥æœ‰å¤šä¸ª<strong>å®ä¾‹</strong>ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„user-serviceï¼Œå‡å¦‚è¿™äº›å®ä¾‹åˆ†å¸ƒäºå…¨å›½å„åœ°çš„ä¸åŒæœºæˆ¿</p>
<table>
<thead>
<tr>
<th>å®ä¾‹</th>
<th>æœºæˆ¿</th>
</tr>
</thead>
<tbody><tr>
<td>127.0.0.1:8081</td>
<td>æ­å·</td>
</tr>
<tr>
<td>127.0.0.1:8082</td>
<td>æ­å·</td>
</tr>
<tr>
<td>127.0.0.1:8083</td>
<td>ä¸Šæµ·</td>
</tr>
</tbody></table>
<p>Nacoså°±å°†åŒä¸€æœºæˆ¿å†…çš„å®ä¾‹åˆ’åˆ†ä¸ºä¸€ä¸ª<strong>é›†ç¾¤</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œuser-serviceæ˜¯æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥åŒ…å«å¤šä¸ªé›†ç¾¤ï¼Œå¦‚æ­å·ã€ä¸Šæµ·ã€åŒ—äº¬ï¼Œæ¯ä¸ªé›†ç¾¤ä¸‹å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œå½¢æˆåˆ†çº§æ¨¡å‹ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211844749.png"></p>
<p>â‘ ä¸€çº§æ˜¯æœåŠ¡ï¼Œä¾‹å¦‚user-serviceï¼›â‘¡äºŒçº§æ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æ­å·æˆ–ä¸Šæµ·ï¼›â‘¢ä¸‰çº§æ˜¯å®ä¾‹ï¼Œä¾‹å¦‚æ­å·æœºæˆ¿çš„æŸå°éƒ¨ç½²</p>
<p>å¾®æœåŠ¡äº’ç›¸è®¿é—®æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½è®¿é—®åŒé›†ç¾¤å®ä¾‹ï¼Œå› ä¸ºæœ¬åœ°è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚å½“æœ¬é›†ç¾¤å†…å®ä¾‹ä¸å¯ç”¨æ—¶ï¼Œæ‰è®¿é—®å…¶å®ƒé›†ç¾¤ã€‚ä¾‹å¦‚ï¼šæ­å·æœºæˆ¿å†…çš„order-serviceåº”è¯¥ä¼˜å…ˆè®¿é—®åŒæœºæˆ¿çš„user-serviceã€‚</p>
<p><img src="https://img.jwt1399.top/img/202209211845713.png"></p>
<h4 id="â“¶ç»™user-serviceé…ç½®é›†ç¾¤"><a href="#â“¶ç»™user-serviceé…ç½®é›†ç¾¤" class="headerlink" title="â“¶ç»™user-serviceé…ç½®é›†ç¾¤"></a>â“¶ç»™user-serviceé…ç½®é›†ç¾¤</h4><p>ä¿®æ”¹<code>user-service</code>çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ é›†ç¾¤é…ç½®ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> HZ <span class="token comment" spellcheck="true"># é›†ç¾¤åç§°</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é‡å¯ä¸¤ä¸ªuser-serviceå®ä¾‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nacosæ§åˆ¶å°çœ‹åˆ°ä¸‹é¢ç»“æœï¼š</p>
<p><img src="/../images/SpringCloud-%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220921185203122.png"></p>
<p>æˆ‘ä»¬å†æ¬¡å¤åˆ¶ä¸€ä¸ªuser-serviceå¯åŠ¨é…ç½®UserApplication3ï¼Œå¤åˆ¶æ–¹å¼å‚è€ƒã€ä¸Šæ–¹æ­å»ºeureka-serveræ­¥éª¤ä¸‰ã€‘</p>
<p>æ·»åŠ VMå±æ€§ï¼š</p>
<pre class="line-numbers language-sh"><code class="language-sh">-Dserver.port=8083 -Dspring.cloud.nacos.discovery.cluster-name=SH
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¯åŠ¨UserApplication3åå†æ¬¡æŸ¥çœ‹nacosæ§åˆ¶å°ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211858088.png"></p>
<h4 id="â“·åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"><a href="#â“·åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡" class="headerlink" title="â“·åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"></a>â“·åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡</h4><p>è´Ÿè½½å‡è¡¡é»˜è®¤è§„åˆ™<code>ZoneAvoidanceRule</code>å¹¶ä¸èƒ½å®ç°æ ¹æ®åŒé›†ç¾¤ä¼˜å…ˆæ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚å› æ­¤Nacosä¸­æä¾›äº†ä¸€ä¸ª<code>NacosRule</code>çš„å®ç°ï¼Œå¯ä»¥ä¼˜å…ˆä»åŒé›†ç¾¤ä¸­æŒ‘é€‰å®ä¾‹ã€‚</p>
<p><strong>æ­¥éª¤ä¸€ï¼šç»™order-serviceé…ç½®é›†ç¾¤ä¿¡æ¯</strong></p>
<p>ä¿®æ”¹<code>order-service</code>çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ é›†ç¾¤é…ç½®ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> HZ <span class="token comment" spellcheck="true"># é›†ç¾¤åç§°</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤äºŒï¼šä¿®æ”¹è´Ÿè½½å‡è¡¡è§„åˆ™</strong></p>
<p>ä¿®æ”¹<code>order-service</code>çš„application.ymlæ–‡ä»¶ï¼Œä¿®æ”¹è´Ÿè½½å‡è¡¡è§„åˆ™ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">userservice</span><span class="token punctuation">:</span>
  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
    <span class="token key atrule">NFLoadBalancerRuleClassName</span><span class="token punctuation">:</span> com.alibaba.cloud.nacos.ribbon.NacosRule <span class="token comment" spellcheck="true"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>NacosRuleè´Ÿè½½å‡è¡¡ç­–ç•¥</p>
<ul>
<li><p>â‘ ä¼˜å…ˆé€‰æ‹©åŒé›†ç¾¤æœåŠ¡å®ä¾‹åˆ—è¡¨</p>
</li>
<li><p>â‘¡æœ¬åœ°é›†ç¾¤æ‰¾ä¸åˆ°æä¾›è€…ï¼Œæ‰å»å…¶å®ƒé›†ç¾¤å¯»æ‰¾ï¼Œå¹¶ä¸”ä¼šæŠ¥è­¦å‘Š</p>
</li>
<li><p>â‘¢ç¡®å®šäº†å¯ç”¨å®ä¾‹åˆ—è¡¨åï¼Œå†é‡‡ç”¨éšæœºè´Ÿè½½å‡è¡¡æŒ‘é€‰å®ä¾‹</p>
</li>
</ul>
<h3 id="â¹æƒé‡é…ç½®"><a href="#â¹æƒé‡é…ç½®" class="headerlink" title="â¹æƒé‡é…ç½®"></a>â¹æƒé‡é…ç½®</h3><p><strong>å®é™…éƒ¨ç½²ä¸­ä¼šå‡ºç°è¿™æ ·çš„åœºæ™¯ï¼š</strong>æœåŠ¡å™¨è®¾å¤‡æ€§èƒ½æœ‰å·®å¼‚ï¼Œéƒ¨åˆ†å®ä¾‹æ‰€åœ¨æœºå™¨æ€§èƒ½è¾ƒå¥½ï¼Œå¦ä¸€äº›è¾ƒå·®ï¼Œæˆ‘ä»¬å¸Œæœ›æ€§èƒ½å¥½çš„æœºå™¨æ‰¿æ‹…æ›´å¤šçš„ç”¨æˆ·è¯·æ±‚ã€‚ä½†é»˜è®¤æƒ…å†µä¸‹NacosRuleæ˜¯åŒé›†ç¾¤å†…éšæœºæŒ‘é€‰ï¼Œä¸ä¼šè€ƒè™‘æœºå™¨çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<p>å› æ­¤ï¼ŒNacosæä¾›äº†æƒé‡é…ç½®æ¥æ§åˆ¶è®¿é—®é¢‘ç‡ï¼Œæƒé‡è¶Šå¤§åˆ™è®¿é—®é¢‘ç‡è¶Šé«˜ã€‚åœ¨nacosæ§åˆ¶å°ï¼Œæ‰¾åˆ°user-serviceçš„å®ä¾‹åˆ—è¡¨ï¼Œç‚¹å‡»ç¼–è¾‘ï¼Œå³å¯ä¿®æ”¹æƒé‡ï¼š</p>
<table>
<thead>
<tr>
<th><img src="https://img.jwt1399.top/img/202209211916270.png"></th>
<th><img src="https://img.jwt1399.top/img/202209211916058.png"></th>
</tr>
</thead>
</table>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæƒé‡ä¿®æ”¹ä¸º0ï¼Œåˆ™è¯¥å®ä¾‹æ°¸è¿œä¸ä¼šè¢«è®¿é—®ï¼Œä½¿ç”¨åœºæ™¯ï¼šè¿›è¡Œå®ä¾‹çš„å¹³æ»‘æ›´æ–°</p>
</blockquote>
<h3 id="âºç¯å¢ƒéš”ç¦»"><a href="#âºç¯å¢ƒéš”ç¦»" class="headerlink" title="âºç¯å¢ƒéš”ç¦»"></a>âºç¯å¢ƒéš”ç¦»</h3><p>Nacosæä¾›äº†namespaceæ¥å®ç°ç¯å¢ƒéš”ç¦»åŠŸèƒ½ã€‚</p>
<ul>
<li>nacosä¸­å¯ä»¥æœ‰å¤šä¸ªnamespace</li>
<li>namespaceä¸‹å¯ä»¥æœ‰groupã€serviceç­‰</li>
<li>ä¸åŒnamespaceä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œä¾‹å¦‚ä¸åŒnamespaceçš„æœåŠ¡äº’ç›¸ä¸å¯è§</li>
</ul>
<p><strong>æ­¥éª¤ä¸€ï¼šåˆ›å»ºnamespace</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰serviceã€groupã€dataéƒ½åœ¨åŒä¸€ä¸ªnamespaceï¼Œåä¸ºpublic</p>
<p><img src="https://img.jwt1399.top/img/202209211923602.png"></p>
<table>
<thead>
<tr>
<th>æ·»åŠ ä¸€ä¸ªnamespace</th>
<th>è®¾ç½®ä¿¡æ¯</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://img.jwt1399.top/img/202209211922322.png"></td>
<td><img src="https://img.jwt1399.top/img/202209211922404.png"></td>
</tr>
</tbody></table>
<p>å°±èƒ½åœ¨é¡µé¢çœ‹åˆ°ä¸€ä¸ªæ–°çš„namespaceï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211923581.png"></p>
<p><strong>æ­¥éª¤äºŒï¼šç»™å¾®æœåŠ¡é…ç½®namespace</strong></p>
<p>ç»™å¾®æœåŠ¡é…ç½®namespaceåªèƒ½é€šè¿‡ä¿®æ”¹é…ç½®æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œä¿®æ”¹order-serviceçš„application.ymlæ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> HZ
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 492a7d5d<span class="token punctuation">-</span>237b<span class="token punctuation">-</span>46a1<span class="token punctuation">-</span>a99a<span class="token punctuation">-</span>fa8e98e4b0f9 <span class="token comment" spellcheck="true"># å‘½åç©ºé—´ï¼Œå¡«ID</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é‡å¯order-serviceåï¼Œè®¿é—®æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th><img src="https://img.jwt1399.top/img/202209211924994.png"></th>
<th><img src="https://img.jwt1399.top/img/202209211924277.png"></th>
</tr>
</thead>
</table>
<p>æ­¤æ—¶è®¿é—®order-serviceï¼Œå› ä¸ºnamespaceä¸åŒï¼Œä¼šå¯¼è‡´æ‰¾ä¸åˆ°userserviceï¼Œæ§åˆ¶å°ä¼šæŠ¥é”™ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211925591.png"></p>
<h2 id="â‘¢Nacosä¸EurekaåŒºåˆ«"><a href="#â‘¢Nacosä¸EurekaåŒºåˆ«" class="headerlink" title="â‘¢Nacosä¸EurekaåŒºåˆ«"></a>â‘¢Nacosä¸EurekaåŒºåˆ«</h2><p>Nacosçš„æœåŠ¡å®ä¾‹åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li><p>ä¸´æ—¶å®ä¾‹ï¼š    å¦‚æœå®ä¾‹å®•æœºè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼Œé»˜è®¤çš„å®ä¾‹ç±»å‹ã€‚</p>
</li>
<li><p>éä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºï¼Œä¸ä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼Œä¹Ÿå¯ä»¥å«æ°¸ä¹…å®ä¾‹ã€‚</p>
</li>
</ul>
<p>é…ç½®ä¸€ä¸ªæœåŠ¡å®ä¾‹ä¸ºæ°¸ä¹…å®ä¾‹ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">ephemeral</span><span class="token punctuation">:</span> <span class="token boolean important">false </span><span class="token comment" spellcheck="true"># è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Nacoså’ŒEurekaæ•´ä½“ç»“æ„ç±»ä¼¼ï¼ŒæœåŠ¡æ³¨å†Œã€æœåŠ¡æ‹‰å–ã€å¿ƒè·³ç­‰å¾…ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›å·®å¼‚ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211928061.png"></p>
<table>
<thead>
<tr>
<th>å…±åŒç‚¹</th>
<th>ä¸åŒç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>â‘ éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–<br>â‘¡éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</td>
<td>â‘ Nacosæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼Œä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼ <br/>â‘¡ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤<br/>â‘¢Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶<br/>â‘£Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</td>
</tr>
</tbody></table>
<h1 id="4-è´Ÿè½½å‡è¡¡-Ribbon"><a href="#4-è´Ÿè½½å‡è¡¡-Ribbon" class="headerlink" title="4.è´Ÿè½½å‡è¡¡-Ribbon"></a>4.è´Ÿè½½å‡è¡¡-Ribbon</h1><h2 id="â‘ è´Ÿè½½å‡è¡¡åŸç†"><a href="#â‘ è´Ÿè½½å‡è¡¡åŸç†" class="headerlink" title="â‘ è´Ÿè½½å‡è¡¡åŸç†"></a>â‘ è´Ÿè½½å‡è¡¡åŸç†</h2><p>SpringCloudåº•å±‚åˆ©ç”¨Ribbonæ¥å®ç°è´Ÿè½½å‡è¡¡åŠŸèƒ½</p>
<p><img src="https://img.jwt1399.top/img/202209211319306.png"></p>
<p>æˆ‘ä»¬å‘å‡ºçš„è¯·æ±‚æ˜æ˜æ˜¯<code>http://userservice/user/1</code>ï¼Œæ€ä¹ˆå˜æˆäº†<code>http://localhost:8081/user/1</code>çš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>æ˜¾ç„¶æœ‰äººå¸®æˆ‘ä»¬æ ¹æ®serviceåç§°ï¼Œè·å–åˆ°äº†æœåŠ¡å®ä¾‹çš„ipå’Œç«¯å£ã€‚å®ƒå°±æ˜¯<code>LoadBalancerInterceptor</code>ï¼Œè¿™ä¸ªç±»ä¼šåœ¨å¯¹RestTemplateçš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œç„¶åä»Eurekaæ ¹æ®æœåŠ¡idè·å–æœåŠ¡åˆ—è¡¨ï¼Œéšååˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•å¾—åˆ°çœŸå®çš„æœåŠ¡åœ°å€ä¿¡æ¯ï¼Œæ›¿æ¢æœåŠ¡idã€‚æˆ‘ä»¬è¿›è¡Œæºç è·Ÿè¸ªï¼š</p>
</blockquote>
<h3 id="â¶LoadBalancerIntercepor"><a href="#â¶LoadBalancerIntercepor" class="headerlink" title="â¶LoadBalancerIntercepor"></a>â¶LoadBalancerIntercepor</h3><p><img src="https://img.jwt1399.top/img/202209211333296.png"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„<code>intercept</code>æ–¹æ³•ï¼Œæ‹¦æˆªäº†ç”¨æˆ·çš„HttpRequestè¯·æ±‚ï¼Œç„¶ååšäº†å‡ ä»¶äº‹ï¼š</p>
<ul>
<li><code>request.getURI()</code>ï¼šè·å–è¯·æ±‚uriï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯ <code>http://user-service/user/8</code></li>
<li><code>originalUri.getHost()</code>ï¼šè·å–uriè·¯å¾„çš„ä¸»æœºåï¼Œå…¶å®å°±æ˜¯æœåŠ¡idï¼Œ<code>user-service</code></li>
<li><code>this.loadBalancer.execute()</code>ï¼šå¤„ç†æœåŠ¡idï¼Œå’Œç”¨æˆ·è¯·æ±‚ã€‚</li>
</ul>
<p>è¿™é‡Œçš„<code>this.loadBalancer</code>æ˜¯<code>LoadBalancerClient</code>ç±»å‹ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿå…¥executeæ–¹æ³•ï¼š</p>
<h3 id="â·LoadBalancerClient"><a href="#â·LoadBalancerClient" class="headerlink" title="â·LoadBalancerClient"></a>â·LoadBalancerClient</h3><p><img src="https://img.jwt1399.top/img/202209211333636.png"></p>
<ul>
<li><code>getLoadBalancer(serviceId)</code>ï¼šæ ¹æ®æœåŠ¡idè·å–ILoadBalancerï¼Œè€ŒILoadBalancerä¼šæ‹¿ç€æœåŠ¡idå»eurekaä¸­è·å–æœåŠ¡åˆ—è¡¨å¹¶ä¿å­˜èµ·æ¥ã€‚</li>
<li><code>getServer(loadBalancer)</code>ï¼šåˆ©ç”¨å†…ç½®çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä»æœåŠ¡åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªã€‚æœ¬ä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è·å–äº†8082ç«¯å£çš„æœåŠ¡</li>
</ul>
<p>æ”¾è¡Œåï¼Œå†æ¬¡è®¿é—®å¹¶è·Ÿè¸ªï¼Œå‘ç°è·å–çš„æ˜¯8081ï¼Œæœç„¶å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚</p>
<p> <img src="https://img.jwt1399.top/img/202209211333458.png"></p>
<h3 id="â¸è´Ÿè½½å‡è¡¡ç­–ç•¥IRule"><a href="#â¸è´Ÿè½½å‡è¡¡ç­–ç•¥IRule" class="headerlink" title="â¸è´Ÿè½½å‡è¡¡ç­–ç•¥IRule"></a>â¸è´Ÿè½½å‡è¡¡ç­–ç•¥IRule</h3><p>åœ¨åˆšæ‰çš„ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è·å–æœåŠ¡ä½¿é€šè¿‡ä¸€ä¸ª<code>getServer</code>æ–¹æ³•æ¥åšè´Ÿè½½å‡è¡¡:</p>
<p><img src="https://img.jwt1399.top/img/202209211333458.png"></p>
<p>æˆ‘ä»¬ç»§ç»­è·Ÿå…¥ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211337777.png"></p>
<p>ç»§ç»­è·Ÿè¸ªæºç chooseServeræ–¹æ³•ï¼Œå‘ç°è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p>
<table>
<thead>
<tr>
<th><img src="https://img.jwt1399.top/img/202209211337640.png"></th>
<th><img src="https://img.jwt1399.top/img/202209211337661.png"></th>
</tr>
</thead>
</table>
<p>è¿™é‡Œçš„ruleé»˜è®¤å€¼æ˜¯ä¸€ä¸ª<code>RoundRobinRule</code>ï¼Œçœ‹ç±»çš„ä»‹ç»ï¼š</p>
<p> <img src="https://img.jwt1399.top/img/202209211339083.png"></p>
<p>è¿™ä¸å°±æ˜¯è½®è¯¢çš„æ„æ€å˜›ã€‚åˆ°è¿™é‡Œï¼Œæ•´ä¸ªè´Ÿè½½å‡è¡¡çš„æµç¨‹æˆ‘ä»¬å°±æ¸…æ¥šäº†ã€‚</p>
<h3 id="â¹æ€»ç»“"><a href="#â¹æ€»ç»“" class="headerlink" title="â¹æ€»ç»“"></a>â¹æ€»ç»“</h3><p>Ribbonçš„åº•å±‚é‡‡ç”¨äº†ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ‹¦æˆªäº†RestTemplateå‘å‡ºçš„è¯·æ±‚ï¼Œå¯¹åœ°å€åšäº†ä¿®æ”¹ã€‚ç”¨ä¸€å¹…å›¾æ¥æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211340322.png"></p>
<p>åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>1.æ‹¦æˆªæˆ‘ä»¬çš„<strong>RestTemplate</strong>è¯·æ±‚<code>http://userservice/user/1</code></li>
<li>2.<strong>RibbonLoadBalancerClient</strong>ä¼šä»è¯·æ±‚urlä¸­è·å–æœåŠ¡åç§°ï¼Œä¹Ÿå°±æ˜¯userservice</li>
<li>3.<strong>DynamicServerListLoadBalancer</strong>æ ¹æ®userserviceåˆ°eurekaæ‹‰å–æœåŠ¡åˆ—è¡¨</li>
<li>4.<strong>eureka-server</strong>è¿”å›åˆ—è¡¨ï¼Œlocalhost:8081ã€localhost:8082</li>
<li>5.<strong>IRule</strong>åˆ©ç”¨å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œä¾‹å¦‚localhost:8081</li>
<li>6.<strong>RibbonLoadBalancerClient</strong>ä¿®æ”¹è¯·æ±‚åœ°å€ï¼Œç”¨localhost:8081æ›¿ä»£userserviceï¼Œå¾—åˆ°<code>http://localhost:8081/user/1</code>ï¼Œå‘èµ·çœŸå®è¯·æ±‚</li>
</ul>
<h2 id="â‘¡è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#â‘¡è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="â‘¡è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>â‘¡è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p>è´Ÿè½½å‡è¡¡çš„è§„åˆ™éƒ½å®šä¹‰åœ¨IRuleæ¥å£ä¸­ï¼Œè€ŒIRuleæœ‰å¾ˆå¤šä¸åŒçš„å®ç°ç±»ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209211344655.png"></p>
<p><strong>ä¸åŒè§„åˆ™çš„å«ä¹‰å¦‚ä¸‹ï¼š</strong></p>
<table>
<thead>
<tr>
<th><strong>å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ç±»</strong></th>
<th><strong>è§„åˆ™æè¿°</strong></th>
</tr>
</thead>
<tbody><tr>
<td>RoundRobinRule</td>
<td>ç®€å•è½®è¯¢æœåŠ¡åˆ—è¡¨æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚å®ƒæ˜¯Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚</td>
</tr>
<tr>
<td>AvailabilityFilteringRule</td>
<td>å¯¹ä»¥ä¸‹ä¸¤ç§æœåŠ¡å™¨è¿›è¡Œå¿½ç•¥ï¼š   ï¼ˆ1ï¼‰åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°æœåŠ¡å™¨å¦‚æœ3æ¬¡è¿æ¥å¤±è´¥ï¼Œè¿™å°æœåŠ¡å™¨å°±ä¼šè¢«è®¾ç½®ä¸ºâ€œçŸ­è·¯â€çŠ¶æ€ã€‚çŸ­è·¯çŠ¶æ€å°†æŒç»­30ç§’ï¼Œå¦‚æœå†æ¬¡è¿æ¥å¤±è´¥ï¼ŒçŸ­è·¯çš„æŒç»­æ—¶é—´å°±ä¼šå‡ ä½•çº§åœ°å¢åŠ ã€‚  ï¼ˆ2ï¼‰å¹¶å‘æ•°è¿‡é«˜çš„æœåŠ¡å™¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°è¿‡é«˜ï¼Œé…ç½®äº†AvailabilityFilteringRuleè§„åˆ™çš„å®¢æˆ·ç«¯ä¹Ÿä¼šå°†å…¶å¿½ç•¥ã€‚å¹¶å‘è¿æ¥æ•°çš„ä¸Šé™ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯çš„&lt;clientName&gt;.&lt;clientConfigNameSpace&gt;.ActiveConnectionsLimitå±æ€§è¿›è¡Œé…ç½®ã€‚</td>
</tr>
<tr>
<td>WeightedResponseTimeRule</td>
<td>ä¸ºæ¯ä¸€ä¸ªæœåŠ¡å™¨èµ‹äºˆä¸€ä¸ªæƒé‡å€¼ã€‚æœåŠ¡å™¨å“åº”æ—¶é—´è¶Šé•¿ï¼Œè¿™ä¸ªæœåŠ¡å™¨çš„æƒé‡å°±è¶Šå°ã€‚è¿™ä¸ªè§„åˆ™ä¼šéšæœºé€‰æ‹©æœåŠ¡å™¨ï¼Œè¿™ä¸ªæƒé‡å€¼ä¼šå½±å“æœåŠ¡å™¨çš„é€‰æ‹©ã€‚</td>
</tr>
<tr>
<td><strong>ZoneAvoidanceRule</strong></td>
<td>ä»¥åŒºåŸŸå¯ç”¨çš„æœåŠ¡å™¨ä¸ºåŸºç¡€è¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨Zoneå¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¸ªZoneå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºæˆ¿ã€ä¸€ä¸ªæœºæ¶ç­‰ã€‚è€Œåå†å¯¹Zoneå†…çš„å¤šä¸ªæœåŠ¡åšè½®è¯¢ã€‚</td>
</tr>
<tr>
<td>BestAvailableRule</td>
<td>å¿½ç•¥é‚£äº›çŸ­è·¯çš„æœåŠ¡å™¨ï¼Œå¹¶é€‰æ‹©å¹¶å‘æ•°è¾ƒä½çš„æœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td>RandomRule</td>
<td>éšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td>RetryRule</td>
<td>é‡è¯•æœºåˆ¶çš„é€‰æ‹©é€»è¾‘</td>
</tr>
</tbody></table>
<p>é»˜è®¤çš„å®ç°å°±æ˜¯ZoneAvoidanceRuleï¼Œæ˜¯ä¸€ç§è½®è¯¢æ–¹æ¡ˆ</p>
<p><strong>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</strong></p>
<p>é€šè¿‡å®šä¹‰IRuleå®ç°å¯ä»¥ä¿®æ”¹è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>1.å…¨å±€é…ç½®ï¼šåœ¨order-serviceä¸­çš„OrderApplicationç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„IRule</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> IRule <span class="token function">randomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>2.å•ä¸ªé…ç½®ï¼šåœ¨order-serviceçš„application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ æ–°çš„é…ç½®ä¹Ÿå¯ä»¥ä¿®æ”¹è§„åˆ™ï¼š</li>
</ul>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">userservice</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># ç»™æŸä¸ªå¾®æœåŠ¡é…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œè¿™é‡Œæ˜¯userserviceæœåŠ¡</span>
  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
    <span class="token key atrule">NFLoadBalancerRuleClassName</span><span class="token punctuation">:</span> com.netflix.loadbalancer.RandomRule <span class="token comment" spellcheck="true"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼Œä¸€èˆ¬ç”¨é»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œä¸åšä¿®æ”¹ã€‚</p>
</blockquote>
<h2 id="â‘¢é¥¥é¥¿åŠ è½½"><a href="#â‘¢é¥¥é¥¿åŠ è½½" class="headerlink" title="â‘¢é¥¥é¥¿åŠ è½½"></a>â‘¢é¥¥é¥¿åŠ è½½</h2><p>Ribboné»˜è®¤æ˜¯é‡‡ç”¨æ‡’åŠ è½½ï¼Œå³ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰ä¼šå»åˆ›å»ºLoadBalanceClientï¼Œè¯·æ±‚æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p>
<p>è€Œé¥¥é¥¿åŠ è½½åˆ™ä¼šåœ¨é¡¹ç›®å¯åŠ¨æ—¶åˆ›å»ºï¼Œé™ä½ç¬¬ä¸€æ¬¡è®¿é—®çš„è€—æ—¶ï¼Œé€šè¿‡ä¸‹é¢é…ç½®å¼€å¯é¥¥é¥¿åŠ è½½ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
  <span class="token key atrule">eager-load</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">clients</span><span class="token punctuation">:</span> userservice
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="5-æœåŠ¡è¿œç¨‹è°ƒç”¨â‘¡"><a href="#5-æœåŠ¡è¿œç¨‹è°ƒç”¨â‘¡" class="headerlink" title="5.æœåŠ¡è¿œç¨‹è°ƒç”¨â‘¡"></a>5.æœåŠ¡è¿œç¨‹è°ƒç”¨â‘¡</h1><h2 id="â‘¡OpenFeign"><a href="#â‘¡OpenFeign" class="headerlink" title="â‘¡OpenFeign"></a>â‘¡OpenFeign</h2><blockquote>
<p>å‰é¢åˆ©ç”¨RestTemplateå‘èµ·è¿œç¨‹è°ƒç”¨çš„ä»£ç </p>
<pre class="line-numbers language-java"><code class="language-java">String url <span class="token operator">=</span> <span class="token string">"http://localhost:8081/user/"</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
User user <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p>
<ul>
<li><p>ä»£ç å¯è¯»æ€§å·®ï¼Œç¼–ç¨‹ä½“éªŒä¸ç»Ÿä¸€</p>
</li>
<li><p>å‚æ•°å¤æ‚URLéš¾ä»¥ç»´æŠ¤</p>
</li>
</ul>
</blockquote>
<p>OpenFeignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„httpå®¢æˆ·ç«¯ï¼Œå…¶ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç°httpè¯·æ±‚çš„å‘é€ï¼Œè§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</p>
<h3 id="â¶ä½¿ç”¨"><a href="#â¶ä½¿ç”¨" class="headerlink" title="â¶ä½¿ç”¨"></a>â¶ä½¿ç”¨</h3><p><strong>æ­¥éª¤ä¸€ï¼šå¼•å…¥ä¾èµ–</strong></p>
<p>åœ¨order-serviceæœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥openfeignçš„ä¾èµ–</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨ openfeign ä¾èµ– ribbonï¼Œä½†æ˜¯æœ€æ–°ç‰ˆçš„ openfeign ç§»é™¤äº†ribbon ï¼Œå› æ­¤å¦‚æœå•ç‹¬ä½¿ç”¨openfeignéœ€è¦å¼•å…¥ribbonï¼Œå¹¶è¿›è¡Œé…ç½®ã€‚å¦‚æœé…åˆ eureka æˆ– nacos åˆ™ä¸ç”¨</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-ribbon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># è¿™ä¸ªuserserviceæ˜¯åŠ äº†@FeignClientæ³¨è§£çš„ç±»çš„name</span>
<span class="token key atrule">userservice</span><span class="token punctuation">:</span>
  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># æœåŠ¡æä¾›è€…çš„åœ°å€ï¼Œä¸æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„åœ°å€</span>
    <span class="token key atrule">listOfServers</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8081</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤äºŒï¼šæ·»åŠ æ³¨è§£</strong></p>
<p>åœ¨order-serviceçš„å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯openfeignçš„åŠŸèƒ½ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableFeignClients</span> <span class="token comment" spellcheck="true">//å¼€å¯feign</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"cn.xxxx.order.mapper"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>OrderApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤ä¸‰ï¼šç¼–å†™Feignçš„å®¢æˆ·ç«¯</strong></p>
<p>åœ¨order-serviceä¸­æ–°å»ºä¸€ä¸ªæ¥å£ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"userservice"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserClient</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user/{id}"</span><span class="token punctuation">)</span>
    User <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™ä¸ªå®¢æˆ·ç«¯ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æœåŠ¡åç§°ï¼šuserservice</li>
<li>è¯·æ±‚æ–¹å¼ï¼šGET</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;user&#x2F;{id}</li>
<li>è¯·æ±‚å‚æ•°ï¼šLong id</li>
<li>è¿”å›å€¼ç±»å‹ï¼šUser</li>
</ul>
<p>è¿™æ ·ï¼ŒFeignå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘é€httpè¯·æ±‚ï¼Œæ— éœ€è‡ªå·±ä½¿ç”¨RestTemplateæ¥å‘é€äº†ã€‚</p>
<p><strong>æ­¥éª¤å››ï¼šå®ç°è¿œç¨‹è°ƒç”¨</strong></p>
<p>ä¿®æ”¹order-serviceä¸­çš„OrderServiceç±»ä¸­çš„queryOrderByIdæ–¹æ³•ï¼Œä½¿ç”¨Feignå®¢æˆ·ç«¯ä»£æ›¿RestTemplateï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> OrderMapper orderMapper<span class="token punctuation">;</span>
  
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> UserClient userClient 

    <span class="token keyword">public</span> Order <span class="token function">queryOrderById</span><span class="token punctuation">(</span>Long orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1.æŸ¥è¯¢è®¢å•</span>
        Order order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.åˆ©ç”¨Feignå‘èµ·httpè¯·æ±‚ï¼ŒæŸ¥è¯¢ç”¨æˆ·</span>
        User user <span class="token operator">=</span> userClient<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 3.å­˜å…¥order</span>
        order<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 4.è¿”å›</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://img.jwt1399.top/img/202209202105075.png" alt="å®ç°è¿‡ç¨‹"></p>
<p><strong>æ€»ç»“</strong></p>
<p>ä½¿ç”¨Feignçš„æ­¥éª¤ï¼š</p>
<ul>
<li><p>â‘  å¼•å…¥ä¾èµ–</p>
</li>
<li><p>â‘¡ æ·»åŠ @EnableFeignClientsæ³¨è§£</p>
</li>
<li><p>â‘¢ ç¼–å†™FeignClientæ¥å£</p>
</li>
<li><p>â‘£ ä½¿ç”¨FeignClientä¸­å®šä¹‰çš„æ–¹æ³•ä»£æ›¿RestTemplate</p>
</li>
</ul>
<h3 id="â·é…ç½®"><a href="#â·é…ç½®" class="headerlink" title="â·é…ç½®"></a>â·é…ç½®</h3><p>Feignå¯ä»¥æ”¯æŒå¾ˆå¤šçš„è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>feign.Logger.Level</strong></td>
<td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td>
<td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td>
</tr>
<tr>
<td>feign.codec.Decoder</td>
<td>å“åº”ç»“æœçš„è§£æå™¨</td>
<td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td>
</tr>
<tr>
<td>feign.codec.Encoder</td>
<td>è¯·æ±‚å‚æ•°ç¼–ç </td>
<td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td>
</tr>
<tr>
<td>feign. Contract</td>
<td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td>
<td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td>
</tr>
<tr>
<td>feign. Retryer</td>
<td>å¤±è´¥é‡è¯•æœºåˆ¶</td>
<td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td>
</tr>
</tbody></table>
<p>æ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š</p>
<ul>
<li>NONEï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</li>
<li>BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´ï¼ˆæ¨èä½¿ç”¨ï¼‰</li>
<li>HEADERSï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li>
<li>FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</li>
</ul>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼å°±èƒ½æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨ï¼Œå¦‚æœè¦è‡ªå®šä¹‰æ—¶ï¼Œå¯ä»¥é€šè¿‡<strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong>æˆ–è€…åˆ›å»º<strong>è‡ªå®šä¹‰@Beanè¦†ç›–é»˜è®¤Bean</strong></p>
<p><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶æ–¹å¼</strong></p>
<ul>
<li>é’ˆå¯¹å•ä¸ªæœåŠ¡ï¼š</li>
</ul>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">feign</span><span class="token punctuation">:</span>  
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span> 
      <span class="token key atrule">userservice</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> FULL <span class="token comment" spellcheck="true">#  æ—¥å¿—çº§åˆ« </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>é’ˆå¯¹æ‰€æœ‰æœåŠ¡ï¼š</li>
</ul>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">feign</span><span class="token punctuation">:</span>  
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span> 
      <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> FULL <span class="token comment" spellcheck="true">#  æ—¥å¿—çº§åˆ« </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è‡ªå®šä¹‰Beanè¦†ç›–</strong></p>
<p>ä¹Ÿå¯ä»¥åŸºäºJavaä»£ç æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œå…ˆå£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå£°æ˜ä¸€ä¸ªLogger.Levelçš„å¯¹è±¡ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultFeignConfiguration</span>  <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> Logger<span class="token punctuation">.</span>Level <span class="token function">feignLogLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Logger<span class="token punctuation">.</span>Level<span class="token punctuation">.</span>BASIC<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ—¥å¿—çº§åˆ«ä¸ºBASIC</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœè¦<strong>å…¨å±€ç”Ÿæ•ˆ</strong>ï¼Œå°†å…¶æ”¾åˆ°å¯åŠ¨ç±»çš„@EnableFeignClientsè¿™ä¸ªæ³¨è§£ä¸­ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> DefaultFeignConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœæ˜¯<strong>å±€éƒ¨ç”Ÿæ•ˆ</strong>ï¼Œåˆ™æŠŠå®ƒæ”¾åˆ°å¯¹åº”çš„@FeignClientè¿™ä¸ªæ³¨è§£ä¸­ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"userservice"</span><span class="token punctuation">,</span> configuration <span class="token operator">=</span> DefaultFeignConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="â¸ä¼˜åŒ–"><a href="#â¸ä¼˜åŒ–" class="headerlink" title="â¸ä¼˜åŒ–"></a>â¸ä¼˜åŒ–</h3><p>Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </p>
</li>
<li><p>Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </p>
</li>
<li><p>OKHttpï¼šæ”¯æŒè¿æ¥æ± </p>
</li>
</ul>
<p>å› æ­¤æé«˜Feignçš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨<strong>è¿æ¥æ± </strong>ä»£æ›¿é»˜è®¤çš„URLConnectionã€‚è¿™é‡Œæˆ‘ä»¬ç”¨Apacheçš„HttpClientæ¥æ¼”ç¤ºã€‚</p>
<p><strong>æ­¥éª¤ä¸€ï¼š</strong>å¼•å…¥ä¾èµ–</p>
<p>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­å¼•å…¥Apacheçš„HttpClientä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--httpClientçš„ä¾èµ– --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>feign-httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ­¥éª¤äºŒï¼š</strong>é…ç½®è¿æ¥æ± </p>
<p>åœ¨order-serviceçš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># defaultå…¨å±€çš„é…ç½®</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> BASIC <span class="token comment" spellcheck="true"># æ—¥å¿—çº§åˆ«ï¼ŒBASICå°±æ˜¯åŸºæœ¬çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯</span>
  <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true </span><span class="token comment" spellcheck="true"># å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ</span>
    <span class="token key atrule">max-connections</span><span class="token punctuation">:</span> <span class="token number">200 </span><span class="token comment" spellcheck="true"># æœ€å¤§çš„è¿æ¥æ•°</span>
    <span class="token key atrule">max-connections-per-route</span><span class="token punctuation">:</span> <span class="token number">50 </span><span class="token comment" spellcheck="true"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¹æœ€ä½³å®è·µ"><a href="#â¹æœ€ä½³å®è·µ" class="headerlink" title="â¹æœ€ä½³å®è·µ"></a>â¹æœ€ä½³å®è·µ</h3><p>æ‰€è°“æœ€è¿‘å®è·µï¼Œå°±æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­æ€»ç»“çš„ç»éªŒï¼Œæœ€å¥½çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ã€‚ä»”ç»†å¯ä»¥å‘ç°ï¼ŒFeignçš„å®¢æˆ·ç«¯ä¸æœåŠ¡æä¾›è€…çš„controllerä»£ç éå¸¸ç›¸ä¼¼ï¼š</p>
<table>
<thead>
<tr>
<th>UserClient</th>
<th>UserController</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://img.jwt1399.top/img/202209241117530.png"></td>
<td><img src="https://img.jwt1399.top/img/202209241117602.png" style="zoom: 67%;" /></td>
</tr>
</tbody></table>
<p>æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ç®€åŒ–è¿™ç§é‡å¤çš„ä»£ç ç¼–å†™å‘¢ï¼Ÿ</p>
<p><strong>æ–¹æ¡ˆä¸€ï¼šç»§æ‰¿æ–¹å¼</strong></p>
<p>ä¸€æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å…±äº«ï¼š</p>
<ul>
<li>1.å®šä¹‰ä¸€ä¸ªAPIæ¥å£ï¼Œåˆ©ç”¨å®šä¹‰æ–¹æ³•ï¼Œå¹¶åŸºäºSpringMVCæ³¨è§£åšå£°æ˜ã€‚</li>
<li>2.Feignå®¢æˆ·ç«¯å’ŒControlleréƒ½é›†æˆè¯¥æ¥å£</li>
</ul>
<p><img src="https://img.jwt1399.top/img/202209241120933.png">ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç®€å•</li>
<li>å®ç°äº†ä»£ç å…±äº«</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>æœåŠ¡æä¾›æ–¹ã€æœåŠ¡æ¶ˆè´¹æ–¹ç´§è€¦åˆ</p>
</li>
<li><p>å‚æ•°åˆ—è¡¨ä¸­çš„æ³¨è§£æ˜ å°„å¹¶ä¸ä¼šç»§æ‰¿ï¼Œå› æ­¤Controllerä¸­å¿…é¡»å†æ¬¡å£°æ˜æ–¹æ³•ã€å‚æ•°åˆ—è¡¨ã€æ³¨è§£</p>
</li>
</ul>
<p><strong>æ–¹æ¡ˆäºŒï¼šæŠ½å–æ–¹å¼</strong></p>
<p>å°†Feignçš„ClientæŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„POJOã€é»˜è®¤çš„Feigné…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå°†UserClientã€Userã€Feignçš„é»˜è®¤é…ç½®éƒ½æŠ½å–åˆ°ä¸€ä¸ªfeign-apiåŒ…ä¸­ï¼Œæ‰€æœ‰å¾®æœåŠ¡å¼•ç”¨è¯¥ä¾èµ–åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202209241123914.png"></p>
<p><strong>æ­¥éª¤ä¸€ï¼šæŠ½å–</strong></p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªmoduleï¼Œå‘½åä¸ºfeign-apiï¼Œåœ¨feign-apiä¸­ç„¶åå¼•å…¥feignçš„starterä¾èµ–</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åï¼Œorder-serviceä¸­ç¼–å†™çš„UserClientã€Userã€DefaultFeignConfigurationéƒ½å¤åˆ¶åˆ°feign-apié¡¹ç›®ä¸­</p>
<p><img src="https://img.jwt1399.top/img/202209241125595.png"></p>
<p><strong>æ­¥éª¤äºŒï¼šåœ¨order-serviceä¸­ä½¿ç”¨feign-api</strong></p>
<p>é¦–å…ˆï¼Œåˆ é™¤order-serviceä¸­çš„UserClientã€Userã€DefaultFeignConfigurationç­‰ç±»æˆ–æ¥å£ã€‚åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­ä¸­å¼•å…¥feign-apiçš„ä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.itcast.demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>feign-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹order-serviceä¸­çš„æ‰€æœ‰ä¸ä¸Šè¿°ä¸‰ä¸ªç»„ä»¶æœ‰å…³çš„å¯¼åŒ…éƒ¨åˆ†ï¼Œæ”¹æˆå¯¼å…¥feign-apiä¸­çš„åŒ…</p>
<p><strong>æ­¥éª¤ä¸‰ï¼šé‡å¯æµ‹è¯•</strong></p>
<p>é‡å¯åï¼Œå‘ç°æœåŠ¡æŠ¥é”™äº†ï¼š</p>
<p><img src="/../images/SpringCloud-%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210714205623048.png"></p>
<p>è¿™æ˜¯å› ä¸ºUserClientç°åœ¨åœ¨cn.itcast.feign.clientsåŒ…ä¸‹ï¼Œè€Œorder-serviceçš„@EnableFeignClientsæ³¨è§£æ˜¯åœ¨cn.itcast.orderåŒ…ä¸‹ï¼Œä¸åœ¨åŒä¸€ä¸ªåŒ…ï¼Œæ— æ³•æ‰«æåˆ°UserClientã€‚</p>
<p><strong>æ­¥éª¤å››ï¼šè§£å†³æ‰«æåŒ…é—®é¢˜</strong></p>
<p>æ–¹å¼ä¸€ï¼šæŒ‡å®šFeignåº”è¯¥æ‰«æçš„åŒ…ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"cn.itcast.feign.clients"</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ–¹å¼äºŒï¼šæŒ‡å®šéœ€è¦åŠ è½½çš„Clientæ¥å£ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>clients <span class="token operator">=</span> <span class="token punctuation">{</span>UserClient<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="6-ç»Ÿä¸€é…ç½®ç®¡ç†"><a href="#6-ç»Ÿä¸€é…ç½®ç®¡ç†" class="headerlink" title="6.ç»Ÿä¸€é…ç½®ç®¡ç†"></a>6.ç»Ÿä¸€é…ç½®ç®¡ç†</h1><h2 id="â‘ Nacos"><a href="#â‘ Nacos" class="headerlink" title="â‘ Nacos"></a>â‘ Nacos</h2><p>Nacosé™¤äº†å¯ä»¥åšæ³¨å†Œä¸­å¿ƒï¼ŒåŒæ ·å¯ä»¥åšé…ç½®ç®¡ç†æ¥ä½¿ç”¨ã€‚å½“å¾®æœåŠ¡éƒ¨ç½²çš„å®ä¾‹è¶Šæ¥è¶Šå¤šï¼Œè¾¾åˆ°æ•°åã€æ•°ç™¾æ—¶ï¼Œé€ä¸ªä¿®æ”¹å¾®æœåŠ¡é…ç½®å°±ä¼šè®©äººæŠ“ç‹‚ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§ç»Ÿä¸€é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œå¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰å®ä¾‹çš„é…ç½®ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202209241704284.png"></p>
<p>Nacosä¸€æ–¹é¢å¯ä»¥å°†é…ç½®é›†ä¸­ç®¡ç†ï¼Œå¦ä¸€æ–¹å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶ï¼ŒåŠæ—¶é€šçŸ¥å¾®æœåŠ¡ï¼Œå®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚</p>
<h3 id="â¶ç»Ÿä¸€é…ç½®ç®¡ç†"><a href="#â¶ç»Ÿä¸€é…ç½®ç®¡ç†" class="headerlink" title="â¶ç»Ÿä¸€é…ç½®ç®¡ç†"></a>â¶ç»Ÿä¸€é…ç½®ç®¡ç†</h3><p><strong>æ­¥éª¤ä¸€ï¼šåœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶</strong></p>
<table>
<thead>
<tr>
<th>1.åœ¨Nacosä¸­æ·»åŠ é…ç½®ä¿¡æ¯</th>
<th>2.åœ¨å¼¹å‡ºè¡¨å•ä¸­å¡«å†™é…ç½®ä¿¡æ¯</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://img.jwt1399.top/img/202209241700314.png"></td>
<td><img src="https://img.jwt1399.top/img/202209241700595.png"></td>
</tr>
</tbody></table>
<p><strong>æ­¥éª¤äºŒï¼šä»å¾®æœåŠ¡æ‹‰å–é…ç½®</strong></p>
<p>å¾®æœåŠ¡è¦æ‹‰å–nacosä¸­ç®¡ç†çš„é…ç½®ï¼Œå¹¶ä¸”ä¸æœ¬åœ°çš„application.ymlé…ç½®åˆå¹¶ï¼Œæ‰èƒ½å®Œæˆé¡¹ç›®å¯åŠ¨ã€‚</p>
<p>ä½†å¦‚æœå°šæœªè¯»å–application.ymlï¼Œåˆå¦‚ä½•å¾—çŸ¥nacosåœ°å€å‘¢ï¼Ÿ</p>
<p>å› æ­¤springå¼•å…¥äº†ä¸€ç§æ–°çš„é…ç½®æ–‡ä»¶ï¼š<code>bootstrap.yaml</code>æ–‡ä»¶ï¼Œä¼šåœ¨application.ymlä¹‹å‰è¢«è¯»å–ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>ä¼ ç»Ÿè¯»å–é…ç½®</th>
<th><img src="https://img.jwt1399.top/img/202209241707016.png"></th>
</tr>
</thead>
<tbody><tr>
<td><strong>nacosç®¡ç†é…ç½®</strong></td>
<td><img src="https://img.jwt1399.top/img/202209241707835.png"></td>
</tr>
</tbody></table>
<p>1.å¼•å…¥Nacosçš„é…ç½®ç®¡ç†å®¢æˆ·ç«¯ä¾èµ–</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.åœ¨userserviceçš„resourceç›®å½•æ·»åŠ ä¸€ä¸ªbootstrap.ymlæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¼•å¯¼æ–‡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºapplication.ymlï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> userservice <span class="token comment" spellcheck="true"># æœåŠ¡åç§°</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment" spellcheck="true">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev </span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># Nacosåœ°å€</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment" spellcheck="true"># æ–‡ä»¶åç¼€å</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™é‡Œä¼šæ ¹æ®spring.cloud.nacos.server-addrè·å–nacosåœ°å€ï¼Œå†æ ¹æ®</p>
<p><code>$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</code>ä½œä¸ºæ–‡ä»¶idï¼Œæ¥è¯»å–é…ç½®ã€‚æœ¬ä¾‹ä¸­ï¼Œå°±æ˜¯å»è¯»å–<code>userservice-dev.yaml</code></p>
<p><img src="https://img.jwt1399.top/img/202209241709238.png"></p>
<p>3.åœ¨user-serviceä¸­çš„UserControllerä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘ï¼Œè¯»å–pattern.dateformaté…ç½®</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${pattern.dateformat}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String dateformat<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"now"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span>dateformat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®¿é—®é¡µé¢<code>http://127.0.0.1:8081/user/now</code>å³å¯çœ‹åˆ°æ—¶é—´</p>
<p><strong>æ€»ç»“ï¼š</strong>å°†é…ç½®äº¤ç»™Nacosç®¡ç†çš„æ­¥éª¤</p>
<ul>
<li><p>â‘ åœ¨Nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶</p>
</li>
<li><p>â‘¡åœ¨å¾®æœåŠ¡ä¸­å¼•å…¥nacosçš„configä¾èµ–</p>
</li>
<li><p>â‘¢åœ¨å¾®æœåŠ¡ä¸­æ·»åŠ bootstrap.ymlï¼Œé…ç½®nacosåœ°å€ã€å½“å‰ç¯å¢ƒã€æœåŠ¡åç§°ã€æ–‡ä»¶åç¼€åã€‚</p>
</li>
</ul>
<h3 id="â·é…ç½®çƒ­æ›´æ–°"><a href="#â·é…ç½®çƒ­æ›´æ–°" class="headerlink" title="â·é…ç½®çƒ­æ›´æ–°"></a>â·é…ç½®çƒ­æ›´æ–°</h3><p>æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ï¼Œæ˜¯ä¿®æ”¹nacosä¸­çš„é…ç½®åï¼Œå¾®æœåŠ¡æ— éœ€é‡å¯å³å¯è®©é…ç½®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯<strong>é…ç½®çƒ­æ›´æ–°</strong>ã€‚</p>
<p>è¦å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p>
<p><strong>æ–¹å¼ä¸€ï¼šé€šè¿‡ Spring Cloud åŸç”Ÿæ³¨è§£ <code>@RefreshScope</code> å®ç°é…ç½®è‡ªåŠ¨æ›´æ–°</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RefreshScope</span> <span class="token comment" spellcheck="true">//æ·»åŠ æ³¨è§£</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${pattern.dateformat}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String dateformat<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"now"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span>dateformat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨@ConfigurationPropertiesæ³¨è§£ä»£æ›¿@Valueæ³¨è§£</strong></p>
<p>åœ¨user-serviceæœåŠ¡ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç±»ï¼Œè¯»å–patterrn.dateformatå±æ€§ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"pattern"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PatternProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String dateformat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨UserControllerä¸­ä½¿ç”¨è¿™ä¸ªç±»ä»£æ›¿@Valueï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> PatternProperties patternProperties<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"now"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span>patternProperties<span class="token punctuation">.</span><span class="token function">getDateformat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¸é…ç½®å…±äº«"><a href="#â¸é…ç½®å…±äº«" class="headerlink" title="â¸é…ç½®å…±äº«"></a>â¸é…ç½®å…±äº«</h3><p>å…¶å®å¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå»nacosè¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p><code>[spring.application.name]-[spring.profiles.active].yaml</code>ï¼Œä¾‹å¦‚ï¼šuserservice-dev.yaml</p>
</li>
<li><p><code>[spring.application.name].yaml</code>ï¼Œä¾‹å¦‚ï¼šuserservice.yaml</p>
</li>
</ul>
<p>è€Œ<code>[spring.application.name].yaml</code>ä¸åŒ…å«ç¯å¢ƒï¼Œå› æ­¤å¯ä»¥è¢«å¤šä¸ªç¯å¢ƒå…±äº«ã€‚</p>
<p>ä¾‹å¦‚ï¼šåœ¨nacosé…ç½®3ä¸ªæ–‡ä»¶ï¼šuserservice-dev.yamlã€userservice-test.yamlã€userservice.yaml</p>
<p>UserApplication(8081)ä½¿ç”¨çš„profileæ˜¯devï¼ŒUserApplication2(8082)ä½¿ç”¨çš„profileæ˜¯testï¼Œè¿è¡Œåä¸ç®¡æ˜¯devï¼Œè¿˜æ˜¯testç¯å¢ƒï¼Œéƒ½è¯»å–åˆ°äº†userservice.yamlä¸­å±æ€§çš„å€¼ã€‚</p>
<p>ä½†æ˜¯å½“nacoså’ŒæœåŠ¡æœ¬åœ°åŒæ—¶å‡ºç°ç›¸åŒå±æ€§æ—¶ï¼Œä¼˜å…ˆçº§æœ‰é«˜ä½ä¹‹åˆ†ï¼šuserservice-dev.yaml &gt; userservice.yaml &gt; application.yml</p>
<p><img src="https://img.jwt1399.top/img/202209241736075.png"></p>
<p><strong>å¤šæœåŠ¡å…±äº«é…ç½®</strong></p>
<p>ä¸åŒå¾®æœåŠ¡ä¹‹é—´å¯ä»¥å…±äº«é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ä¸‹é¢çš„ä¸¤ç§æ–¹å¼æ¥æŒ‡å®š</p>
<p>æ–¹å¼ä¸€ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> userservice <span class="token comment" spellcheck="true"># æœåŠ¡åç§°</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment" spellcheck="true">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># Nacosåœ°å€</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment" spellcheck="true"># æ–‡ä»¶åç¼€å</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># å¤šå¾®æœåŠ¡é—´å…±äº«çš„é…ç½®åˆ—è¡¨</span>
         <span class="token punctuation">-</span> <span class="token key atrule">dataId</span><span class="token punctuation">:</span> common.yaml <span class="token comment" spellcheck="true"># è¦å…±äº«çš„é…ç½®æ–‡ä»¶id</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ–¹å¼äºŒï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> userservice <span class="token comment" spellcheck="true"># æœåŠ¡åç§°</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment" spellcheck="true">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># Nacosåœ°å€</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment" spellcheck="true"># æ–‡ä»¶åç¼€å</span>
        <span class="token key atrule">extends-configs</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># å¤šå¾®æœåŠ¡é—´å…±äº«çš„é…ç½®åˆ—è¡¨</span>
         <span class="token punctuation">-</span> <span class="token key atrule">dataId</span><span class="token punctuation">:</span> extend.yaml <span class="token comment" spellcheck="true"># è¦å…±äº«çš„é…ç½®æ–‡ä»¶id</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¤šç§é…ç½®çš„ä¼˜å…ˆçº§ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209241748244.png"></p>
<h3 id="â¹æ­å»ºNacosé›†ç¾¤"><a href="#â¹æ­å»ºNacosé›†ç¾¤" class="headerlink" title="â¹æ­å»ºNacosé›†ç¾¤"></a>â¹æ­å»ºNacosé›†ç¾¤</h3><p><img src="https://img.jwt1399.top/img/202209242331548.png"></p>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹</th>
<th>ip</th>
<th>port</th>
</tr>
</thead>
<tbody><tr>
<td>nacos1</td>
<td>192.168.150.1</td>
<td>8845</td>
</tr>
<tr>
<td>nacos2</td>
<td>192.168.150.1</td>
<td>8846</td>
</tr>
<tr>
<td>nacos3</td>
<td>192.168.150.1</td>
<td>8847</td>
</tr>
</tbody></table>
<h4 id="â“µåˆå§‹åŒ–æ•°æ®åº“"><a href="#â“µåˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="â“µåˆå§‹åŒ–æ•°æ®åº“"></a>â“µåˆå§‹åŒ–æ•°æ®åº“</h4><p>Nacosé»˜è®¤æ•°æ®å­˜å‚¨åœ¨å†…åµŒæ•°æ®åº“Derbyä¸­ï¼Œä¸å±äºç”Ÿäº§å¯ç”¨çš„æ•°æ®åº“ã€‚å®˜æ–¹æ¨èçš„æœ€ä½³å®è·µæ˜¯ä½¿ç”¨å¸¦æœ‰ä¸»ä»çš„é«˜å¯ç”¨æ•°æ®åº“é›†ç¾¤ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥å•ç‚¹çš„æ•°æ®åº“ä¸ºä¾‹ã€‚</p>
<p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå‘½åä¸ºnacosï¼Œè€Œåå¯¼å…¥å®˜æ–¹æä¾›çš„SQLï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/blob/master/distribution/conf/schema.sql">nacos&#x2F;schema.sql </a></p>
<h4 id="â“¶éƒ¨ç½²é…ç½®nacos"><a href="#â“¶éƒ¨ç½²é…ç½®nacos" class="headerlink" title="â“¶éƒ¨ç½²é…ç½®nacos"></a>â“¶éƒ¨ç½²é…ç½®nacos</h4><p>ä¸‹è½½nacosåï¼Œè¿›å…¥nacosçš„confç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶cluster.conf.exampleï¼Œé‡å‘½åä¸ºcluster.conf</p>
<p>ç„¶åæ·»åŠ å†…å®¹ï¼š</p>
<pre><code>127.0.0.1:8845
127.0.0.1.8846
127.0.0.1.8847
</code></pre>
<p>ç„¶åä¿®æ”¹application.propertiesæ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®åº“é…ç½®</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token attr-value">mysql</span>

<span class="token attr-name">db.num</span><span class="token punctuation">=</span><span class="token attr-value">1</span>

<span class="token attr-name">db.url.0</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span>
<span class="token attr-name">db.user.0</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">db.password.0</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“·å¯åŠ¨nacosé›†ç¾¤"><a href="#â“·å¯åŠ¨nacosé›†ç¾¤" class="headerlink" title="â“·å¯åŠ¨nacosé›†ç¾¤"></a>â“·å¯åŠ¨nacosé›†ç¾¤</h4><p>å°†nacosæ–‡ä»¶å¤¹å¤åˆ¶ä¸‰ä»½ï¼Œåˆ†åˆ«å‘½åä¸ºï¼šnacos1ã€nacos2ã€nacos3ï¼›ç„¶ååˆ†åˆ«ä¿®æ”¹ä¸‰ä¸ªæ–‡ä»¶å¤¹ä¸­çš„application.properties</p>
<p>nacos1:</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8845</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>nacos2:</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8846</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>nacos3:</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8847</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç„¶ååˆ†åˆ«å¯åŠ¨ä¸‰ä¸ªnacosèŠ‚ç‚¹ï¼š<code>startup.cmd</code></p>
<h4 id="â“¸nginxåå‘ä»£ç†"><a href="#â“¸nginxåå‘ä»£ç†" class="headerlink" title="â“¸nginxåå‘ä»£ç†"></a>â“¸nginxåå‘ä»£ç†</h4><p>ä¸‹è½½nginxåï¼Œä¿®æ”¹conf&#x2F;nginx.confæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-json"><code class="language-json">upstream nacos-cluster <span class="token punctuation">{</span>
  server <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">8845</span><span class="token punctuation">;</span>
    server <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">8846</span><span class="token punctuation">;</span>
    server <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">8847</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    location /nacos <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span>//nacos-cluster<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è€Œååœ¨æµè§ˆå™¨è®¿é—®ï¼š<code>http://localhost/nacos</code>å³å¯ã€‚</p>
<p>ä»£ç ä¸­application.ymlæ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">80 </span><span class="token comment" spellcheck="true"># Nacosåœ°å€</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¹ä¼˜åŒ–"><a href="#â“¹ä¼˜åŒ–" class="headerlink" title="â“¹ä¼˜åŒ–"></a>â“¹ä¼˜åŒ–</h4><ul>
<li><p>å®é™…éƒ¨ç½²æ—¶ï¼Œéœ€è¦ç»™åšåå‘ä»£ç†çš„nginxæœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªåŸŸåï¼Œè¿™æ ·åç»­å¦‚æœæœ‰æœåŠ¡å™¨è¿ç§»ï¼Œnacosçš„å®¢æˆ·ç«¯ä¹Ÿæ— éœ€æ›´æ”¹é…ç½®</p>
</li>
<li><p>Nacosçš„å„ä¸ªèŠ‚ç‚¹åº”è¯¥éƒ¨ç½²åˆ°å¤šä¸ªä¸åŒæœåŠ¡å™¨ï¼Œåšå¥½å®¹ç¾å’Œéš”ç¦»</p>
</li>
</ul>
<h1 id="7-ç»Ÿä¸€ç½‘å…³è·¯ç”±"><a href="#7-ç»Ÿä¸€ç½‘å…³è·¯ç”±" class="headerlink" title="7.ç»Ÿä¸€ç½‘å…³è·¯ç”±"></a>7.ç»Ÿä¸€ç½‘å…³è·¯ç”±</h1><h2 id="â‘ ç®€ä»‹"><a href="#â‘ ç®€ä»‹" class="headerlink" title="â‘ ç®€ä»‹"></a>â‘ ç®€ä»‹</h2><p>Spring Cloud Gateway æ˜¯ Spring Cloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº Spring 5.0ï¼ŒSpring Boot 2.0 å’Œ Project Reactor ç­‰å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶æµæŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p>
<p>Gatewayç½‘å…³æ˜¯æˆ‘ä»¬æœåŠ¡çš„å®ˆé—¨ç¥ï¼Œæ‰€æœ‰å¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£ã€‚ç½‘å…³çš„<strong>æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>è·¯ç”±å’Œè´Ÿè½½å‡è¡¡<ul>
<li>ä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡gatewayï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè·¯ç”±ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚</li>
</ul>
</li>
<li>æƒé™æ§åˆ¶<ul>
<li>ç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</li>
</ul>
</li>
<li>é™æµ<ul>
<li>å½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</li>
</ul>
</li>
</ul>
<img src="../images/SpringCloud-å®ç”¨ç¯‡/image-20220925101634632.png" alt="æ¶æ„å›¾" style="zoom:50%;" />

<p>åœ¨SpringCloudä¸­ç½‘å…³çš„å®ç°åŒ…æ‹¬ä¸¤ç§ï¼š</p>
<ul>
<li>gateway</li>
<li>zuul</li>
</ul>
<p>Zuulæ˜¯åŸºäºServletçš„å®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ã€‚è€ŒSpringCloudGatewayåˆ™æ˜¯åŸºäºSpring5ä¸­æä¾›çš„WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<h2 id="â‘¡å¿«é€Ÿå…¥é—¨"><a href="#â‘¡å¿«é€Ÿå…¥é—¨" class="headerlink" title="â‘¡å¿«é€Ÿå…¥é—¨"></a>â‘¡å¿«é€Ÿå…¥é—¨</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºä¸‹ç½‘å…³çš„åŸºæœ¬è·¯ç”±åŠŸèƒ½ã€‚åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºæ–°æ¨¡å—ï¼Œå¼•å…¥ç½‘å…³ä¾èµ–</li>
<li>ç¼–å†™å¯åŠ¨ç±»</li>
<li>ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</li>
<li>å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•</li>
</ol>
<h3 id="â¶åˆ›å»ºæ–°æ¨¡å—ï¼Œå¼•å…¥ç½‘å…³ä¾èµ–"><a href="#â¶åˆ›å»ºæ–°æ¨¡å—ï¼Œå¼•å…¥ç½‘å…³ä¾èµ–" class="headerlink" title="â¶åˆ›å»ºæ–°æ¨¡å—ï¼Œå¼•å…¥ç½‘å…³ä¾èµ–"></a>â¶åˆ›å»ºæ–°æ¨¡å—ï¼Œå¼•å…¥ç½‘å…³ä¾èµ–</h3><p>åˆ›å»ºæœåŠ¡ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209251033539.png"></p>
<p>å¼•å…¥ä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--ç½‘å…³--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â·ç¼–å†™å¯åŠ¨ç±»"><a href="#â·ç¼–å†™å¯åŠ¨ç±»" class="headerlink" title="â·ç¼–å†™å¯åŠ¨ç±»"></a>â·ç¼–å†™å¯åŠ¨ç±»</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>GatewayApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¸ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™"><a href="#â¸ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™" class="headerlink" title="â¸ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™"></a>â¸ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</h3><p>åˆ›å»ºapplication.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10010 </span><span class="token comment" spellcheck="true"># ç½‘å…³ç«¯å£</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway <span class="token comment" spellcheck="true"># æœåŠ¡åç§°</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># nacosåœ°å€</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># ç½‘å…³è·¯ç”±é…ç½®</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service <span class="token comment" spellcheck="true"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span>
          <span class="token comment" spellcheck="true"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice <span class="token comment" spellcheck="true"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span>
            <span class="token punctuation">-</span> Path=/user/** <span class="token comment" spellcheck="true"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬å°†ç¬¦åˆ<code>Path</code> è§„åˆ™çš„ä¸€åˆ‡è¯·æ±‚ï¼Œéƒ½ä»£ç†åˆ° <code>uri</code>å‚æ•°æŒ‡å®šçš„åœ°å€ã€‚</p>
<p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† <code>/user/**</code>å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ°<code>lb://userservice</code>ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æœåŠ¡åæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<h3 id="â¹å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•"><a href="#â¹å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•" class="headerlink" title="â¹å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•"></a>â¹å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•</h3><p>å¯åŠ¨ç½‘å…³ï¼Œè®¿é—®<code>http://localhost:10010/user/1</code>æ—¶ï¼Œç¬¦åˆ<code>/user/**</code>è§„åˆ™ï¼Œè¯·æ±‚è½¬å‘åˆ°uriï¼š<code>http://userservice/user/1</code>ï¼Œå¾—åˆ°äº†ç»“æœï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209251054663.png"></p>
<p>æ•´ä¸ªè®¿é—®çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209251055650.png"></p>
<h3 id="âºæ€»ç»“-1"><a href="#âºæ€»ç»“-1" class="headerlink" title="âºæ€»ç»“"></a>âºæ€»ç»“</h3><p>ç½‘å…³æ­å»ºæ­¥éª¤ï¼š</p>
<ol>
<li><p>åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥nacosæœåŠ¡å‘ç°å’Œgatewayä¾èµ–</p>
</li>
<li><p>é…ç½®application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€nacosåœ°å€ã€è·¯ç”±</p>
</li>
</ol>
<p>è·¯ç”±é…ç½®åŒ…æ‹¬ï¼š</p>
<ol>
<li><p>è·¯ç”±idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</p>
</li>
<li><p>è·¯ç”±ç›®æ ‡ï¼ˆuriï¼‰ï¼šè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œhttpä»£è¡¨å›ºå®šåœ°å€ï¼Œlbä»£è¡¨æ ¹æ®æœåŠ¡åè´Ÿè½½å‡è¡¡</p>
</li>
<li><p>è·¯ç”±æ–­è¨€ï¼ˆpredicatesï¼‰ï¼šåˆ¤æ–­è·¯ç”±çš„è§„åˆ™</p>
</li>
<li><p>è·¯ç”±è¿‡æ»¤å™¨ï¼ˆfiltersï¼‰ï¼šå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†</p>
</li>
</ol>
<h2 id="â‘¢æ–­è¨€å·¥å‚"><a href="#â‘¢æ–­è¨€å·¥å‚" class="headerlink" title="â‘¢æ–­è¨€å·¥å‚"></a>â‘¢æ–­è¨€å·¥å‚</h2><p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢«Predicate Factoryè¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</p>
<p>ä¾‹å¦‚<code>Path=/user/**</code>æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±</p>
<p><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>ç±»æ¥</p>
<p>å¤„ç†çš„ï¼Œåƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨SpringCloudGatewayè¿˜æœ‰åå‡ ä¸ª:</p>
<table>
<thead>
<tr>
<th><strong>åç§°</strong></th>
<th><strong>è¯´æ˜</strong></th>
<th><strong>ç¤ºä¾‹</strong></th>
</tr>
</thead>
<tbody><tr>
<td>After</td>
<td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td>
<td>-  After&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver]</td>
</tr>
<tr>
<td>Before</td>
<td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td>
<td>-  Before&#x3D;2031-04-13T15:14:47.433+08:00[Asia&#x2F;Shanghai]</td>
</tr>
<tr>
<td>Between</td>
<td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td>
<td>-  Between&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver],  2037-01-21T17:42:47.789-07:00[America&#x2F;Denver]</td>
</tr>
<tr>
<td>Cookie</td>
<td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td>
<td>- Cookie&#x3D;chocolate, ch.p</td>
</tr>
<tr>
<td>Header</td>
<td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td>
<td>- Header&#x3D;X-Request-Id, \d+</td>
</tr>
<tr>
<td>Host</td>
<td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td>
<td>-  Host&#x3D;<strong>.somehost.org,</strong>.anotherhost.org</td>
</tr>
<tr>
<td>Method</td>
<td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td>
<td>- Method&#x3D;GET,POST</td>
</tr>
<tr>
<td>Path</td>
<td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td>
<td>- Path&#x3D;&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;**</td>
</tr>
<tr>
<td>Query</td>
<td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td>
<td>- Query&#x3D;name, Jackæˆ–è€…-  Query&#x3D;name</td>
</tr>
<tr>
<td>RemoteAddr</td>
<td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td>
<td>- RemoteAddr&#x3D;192.168.1.1&#x2F;24</td>
</tr>
<tr>
<td>Weight</td>
<td>æƒé‡å¤„ç†</td>
<td></td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬åªéœ€è¦æŒæ¡Pathè¿™ç§è·¯ç”±å·¥ç¨‹å°±å¯ä»¥äº†ã€‚</p>
<h2 id="â‘£è¿‡æ»¤å·¥å‚"><a href="#â‘£è¿‡æ»¤å·¥å‚" class="headerlink" title="â‘£è¿‡æ»¤å·¥å‚"></a>â‘£è¿‡æ»¤å·¥å‚</h2><p>GatewayFilteræ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡è¿”å›çš„å“åº”åšå¤„ç†ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209251101960.png"></p>
<h3 id="â¶è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»"><a href="#â¶è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»" class="headerlink" title="â¶è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»"></a>â¶è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»</h3><p>Springæä¾›äº†31ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th><strong>åç§°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td>AddRequestHeader</td>
<td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td>
</tr>
<tr>
<td>RemoveRequestHeader</td>
<td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td>
</tr>
<tr>
<td>AddResponseHeader</td>
<td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td>
</tr>
<tr>
<td>RemoveResponseHeader</td>
<td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td>
</tr>
<tr>
<td>RequestRateLimiter</td>
<td>é™åˆ¶è¯·æ±‚çš„æµé‡</td>
</tr>
<tr>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
</tr>
</tbody></table>
<h3 id="â·å“åº”å¤´è¿‡æ»¤å™¨"><a href="#â·å“åº”å¤´è¿‡æ»¤å™¨" class="headerlink" title="â·å“åº”å¤´è¿‡æ»¤å™¨"></a>â·å“åº”å¤´è¿‡æ»¤å™¨</h3><p>ä¸‹é¢æˆ‘ä»¬ä»¥AddResponseHeader ä¸ºä¾‹æ¥è®²è§£ã€‚</p>
<blockquote>
<p><strong>éœ€æ±‚</strong>ï¼šç»™æ‰€æœ‰è¿›å…¥userserviceçš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šTruth&#x3D;This is a test !</p>
</blockquote>
<p>åªéœ€è¦ä¿®æ”¹gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±è¿‡æ»¤å³å¯ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service 
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice 
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> Path=/user/** 
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> order<span class="token punctuation">-</span>service
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//orderservice
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/order/**
        <span class="token key atrule">filters</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># è¿‡æ»¤å™¨</span>
        <span class="token punctuation">-</span> AddResponseHeader=Truth<span class="token punctuation">,</span> This is a test! <span class="token comment" spellcheck="true"># æ·»åŠ è¯·æ±‚å¤´</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“å‰è¿‡æ»¤å™¨å†™åœ¨userserviceè·¯ç”±ä¸‹ï¼Œå› æ­¤ä»…ä»…å¯¹è®¿é—®userserviceçš„è¯·æ±‚æœ‰æ•ˆã€‚</p>
<p><img src="https://img.jwt1399.top/img/202209251112506.png"></p>
<h3 id="â¸é»˜è®¤è¿‡æ»¤å™¨"><a href="#â¸é»˜è®¤è¿‡æ»¤å™¨" class="headerlink" title="â¸é»˜è®¤è¿‡æ»¤å™¨"></a>â¸é»˜è®¤è¿‡æ»¤å™¨</h3><p>å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ°defaultä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service 
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice 
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> Path=/user/**
      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># é»˜è®¤è¿‡æ»¤é¡¹</span>
      <span class="token punctuation">-</span> AddResponseHeader=Truth<span class="token punctuation">,</span> This is a test! 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¹æ€»ç»“-1"><a href="#â¹æ€»ç»“-1" class="headerlink" title="â¹æ€»ç»“"></a>â¹æ€»ç»“</h3><p>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><p>â‘  å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</p>
</li>
<li><p>â‘¡ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ</p>
</li>
</ul>
<p>defaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>â‘  å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</li>
</ul>
<h2 id="â‘¤å…¨å±€è¿‡æ»¤å™¨"><a href="#â‘¤å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="â‘¤å…¨å±€è¿‡æ»¤å™¨"></a>â‘¤å…¨å±€è¿‡æ»¤å™¨</h2><p>ä¸Šä¸€èŠ‚å­¦ä¹ çš„è¿‡æ»¤å™¨ï¼Œç½‘å…³æä¾›äº†31ç§ï¼Œä½†æ¯ä¸€ç§è¿‡æ»¤å™¨çš„ä½œç”¨éƒ½æ˜¯å›ºå®šçš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªè¯·æ±‚ï¼Œåšè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åˆ™æ²¡åŠæ³•å®ç°ã€‚</p>
<h3 id="â¶å…¨å±€è¿‡æ»¤å™¨ä½œç”¨"><a href="#â¶å…¨å±€è¿‡æ»¤å™¨ä½œç”¨" class="headerlink" title="â¶å…¨å±€è¿‡æ»¤å™¨ä½œç”¨"></a>â¶å…¨å±€è¿‡æ»¤å™¨ä½œç”¨</h3><p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸GatewayFilterçš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äºGatewayFilteré€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›è€ŒGlobalFilterçš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚</p>
<p>å®šä¹‰æ–¹å¼æ˜¯å®ç°GlobalFilteræ¥å£ã€‚</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     *  å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡{@link GatewayFilterChain}å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†
     *
     * @param exchange è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯
     * @param chain ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ 
     * @return {@code Mono&lt;Void>} è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ
     */</span>
    Mono<span class="token operator">&lt;</span>Void<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>ServerWebExchange exchange<span class="token punctuation">,</span> GatewayFilterChain chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨filterä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</p>
<ul>
<li>ç™»å½•çŠ¶æ€åˆ¤æ–­</li>
<li>æƒé™æ ¡éªŒ</li>
<li>è¯·æ±‚é™æµç­‰</li>
</ul>
<h3 id="â·è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"><a href="#â·è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="â·è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"></a>â·è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</h3><p>éœ€æ±‚ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š</p>
<ul>
<li><p>å‚æ•°ä¸­æ˜¯å¦æœ‰authorizationï¼Œ</p>
</li>
<li><p>authorizationå‚æ•°å€¼æ˜¯å¦ä¸ºadmin</p>
</li>
<li><p>å¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª</p>
</li>
</ul>
<p>å®ç°ï¼šåœ¨gatewayä¸­å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filters<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizeFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Mono<span class="token operator">&lt;</span>Void<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>ServerWebExchange exchange<span class="token punctuation">,</span> GatewayFilterChain chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1.è·å–è¯·æ±‚å‚æ•°</span>
        MultiValueMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> params <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2.è·å–authorizationå‚æ•°</span>
        String auth <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"authorization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 3.æ ¡éªŒ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// æ”¾è¡Œ</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 4.æ‹¦æˆª</span>
        <span class="token comment" spellcheck="true">// 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç </span>
        exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>FORBIDDEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 4.2.ç»“æŸå¤„ç†</span>
        <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¸è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"><a href="#â¸è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" class="headerlink" title="â¸è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"></a>â¸è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</h3><p>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šDefaultFilterã€å½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€GlobalFilter</p>
<p>è¯·æ±‚è·¯ç”±åï¼Œä¼šå°†ä¸‰ä¸ªè¿‡æ»¤å™¨åˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆé›†åˆï¼‰ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209251133009.png"></p>
<p>æ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œ<strong>orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</strong>ã€‚</li>
<li>GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li>
<li>è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä»1é€’å¢ã€‚</li>
<li>å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œã€‚</li>
</ul>
<p>è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼š</p>
<p><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()</code>æ–¹æ³•æ˜¯å…ˆåŠ è½½defaultFiltersï¼Œç„¶åå†åŠ è½½æŸä¸ªrouteçš„filtersï¼Œç„¶ååˆå¹¶ã€‚</p>
<p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler#handle()</code>æ–¹æ³•ä¼šåŠ è½½å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸å‰é¢çš„è¿‡æ»¤å™¨åˆå¹¶åæ ¹æ®orderæ’åºï¼Œç»„ç»‡è¿‡æ»¤å™¨é“¾</p>
<h3 id="â¹æ€»ç»“-2"><a href="#â¹æ€»ç»“-2" class="headerlink" title="â¹æ€»ç»“"></a>â¹æ€»ç»“</h3><p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘</li>
</ul>
<p>å®ç°å…¨å±€è¿‡æ»¤å™¨çš„æ­¥éª¤ï¼Ÿ</p>
<ul>
<li><p>â‘ å®ç°GlobalFilteræ¥å£</p>
</li>
<li><p>â‘¡æ·»åŠ @Orderæ³¨è§£æˆ–å®ç°Orderedæ¥å£</p>
</li>
<li><p>â‘¢ç¼–å†™å¤„ç†é€»è¾‘</p>
</li>
</ul>
<p>è·¯ç”±è¿‡æ»¤å™¨ã€defaultFilterã€å…¨å±€è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ</p>
<ul>
<li><p>â‘ orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</p>
</li>
<li><p>â‘¡å½“orderå€¼ä¸€æ ·æ—¶ï¼Œé¡ºåºæ˜¯defaultFilter &gt; å±€éƒ¨çš„è·¯ç”±è¿‡æ»¤å™¨ &gt; å…¨å±€è¿‡æ»¤å™¨</p>
</li>
</ul>
<h2 id="â‘¥è·¨åŸŸé—®é¢˜"><a href="#â‘¥è·¨åŸŸé—®é¢˜" class="headerlink" title="â‘¥è·¨åŸŸé—®é¢˜"></a>â‘¥è·¨åŸŸé—®é¢˜</h2><h3 id="â¶ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜"><a href="#â¶ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜" class="headerlink" title="â¶ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜"></a>â¶ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜</h3><p>è·¨åŸŸï¼šåŸŸåä¸ä¸€è‡´å°±æ˜¯è·¨åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>åŸŸåä¸åŒï¼š <code>www.taobao.com</code> å’Œ <code>www.taobao.org</code> </p>
</li>
<li><p>åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒï¼š<code>localhost:8080</code> å’Œ <code>localhost8081</code></p>
</li>
</ul>
<p>è·¨åŸŸé—®é¢˜ï¼šæµè§ˆå™¨ç¦æ­¢è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸajaxè¯·æ±‚ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜</p>
<p>è§£å†³æ–¹æ¡ˆï¼šCORSã€‚ä¸çŸ¥é“çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<h3 id="â·æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜"><a href="#â·æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜" class="headerlink" title="â·æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜"></a>â·æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜</h3><p>ç¼–å†™ä¸€ä¸ªé¡µé¢ï¼Œå¹¶åœ¨VScodeä¸­å¯åŠ¨ <code>live-server --port=8090</code></p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ï¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://unpkg.com/axios/dist/axios.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"http://localhost:10010/user/1?authorization=admin"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202209251219308.png"></p>
<p>ä»<code>localhost:8090</code>è®¿é—®<code>localhost:10010</code>ï¼Œç«¯å£ä¸åŒï¼Œæ˜¾ç„¶æ˜¯è·¨åŸŸçš„è¯·æ±‚ã€‚</p>
<h3 id="â¸è§£å†³è·¨åŸŸé—®é¢˜"><a href="#â¸è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="â¸è§£å†³è·¨åŸŸé—®é¢˜"></a>â¸è§£å†³è·¨åŸŸé—®é¢˜</h3><p>åœ¨gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment" spellcheck="true"># .......</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span>
        <span class="token key atrule">add-to-simple-url-handler-mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true </span><span class="token comment" spellcheck="true"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span>
        <span class="token key atrule">corsConfigurations</span><span class="token punctuation">:</span>
          '<span class="token punctuation">[</span>/**<span class="token punctuation">]</span>'<span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># æ‹¦æˆªä¸€åˆ‡è¯·æ±‚</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ </span>
              <span class="token punctuation">-</span> <span class="token string">"http://localhost:8090"</span>
              <span class="token punctuation">-</span> <span class="token string">"https://jwt1399.top"</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span>
              <span class="token punctuation">-</span> <span class="token string">"GET"</span>
              <span class="token punctuation">-</span> <span class="token string">"POST"</span>
              <span class="token punctuation">-</span> <span class="token string">"DELETE"</span>
              <span class="token punctuation">-</span> <span class="token string">"PUT"</span>
              <span class="token punctuation">-</span> <span class="token string">"OPTIONS"</span>
            <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span> <span class="token string">"*"</span> <span class="token comment" spellcheck="true"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span>
            <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true </span><span class="token comment" spellcheck="true"># æ˜¯å¦å…è®¸æºå¸¦cookie</span>
            <span class="token key atrule">maxAge</span><span class="token punctuation">:</span> <span class="token number">360000 </span><span class="token comment" spellcheck="true"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="8-DockeræŠ€æœ¯"><a href="#8-DockeræŠ€æœ¯" class="headerlink" title="8.DockeræŠ€æœ¯"></a>8.DockeræŠ€æœ¯</h1><p><strong>é•œåƒï¼ˆImageï¼‰</strong>ï¼šå°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€éœ€çš„ä¾èµ–ã€å‡½æ•°åº“ã€ç¯å¢ƒã€é…ç½®ç­‰æ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç§°ä¸ºé•œåƒ</p>
<p><strong>å®¹å™¨ï¼ˆContainerï¼‰</strong>ï¼šé•œåƒä¸­çš„åº”ç”¨ç¨‹åºè¿è¡Œåå½¢æˆçš„è¿›ç¨‹å°±æ˜¯å®¹å™¨</p>
<p><strong>ä»“åº“ï¼ˆRepositoryï¼‰</strong>ï¼šä¸€ä¸ªé•œåƒæ‰˜ç®¡çš„æœåŠ¡å™¨ï¼Œå¯ä»¥ä»ä¸­ä¸Šä¼ ã€æ‹‰å–é•œåƒã€‚</p>
<p><strong>æ•°æ®å·ï¼ˆvolumeï¼‰</strong>ï¼šæ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼ŒæŒ‡å‘å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æŸä¸ªç›®å½•ã€‚</p>
<h2 id="â‘ é•œåƒæ“ä½œ"><a href="#â‘ é•œåƒæ“ä½œ" class="headerlink" title="â‘ é•œåƒæ“ä½œ"></a>â‘ é•œåƒæ“ä½œ</h2><h3 id="â¶é•œåƒåç§°"><a href="#â¶é•œåƒåç§°" class="headerlink" title="â¶é•œåƒåç§°"></a>â¶é•œåƒåç§°</h3><ul>
<li>é•œåç§°ä¸€èˆ¬åˆ†ä¸¤éƒ¨åˆ†ç»„æˆï¼š[repository]:[tag]ã€‚</li>
<li>åœ¨æ²¡æœ‰æŒ‡å®štagæ—¶ï¼Œé»˜è®¤æ˜¯latestï¼Œä»£è¡¨æœ€æ–°ç‰ˆæœ¬çš„é•œåƒ</li>
</ul>
<h3 id="â·é•œåƒå‘½ä»¤"><a href="#â·é•œåƒå‘½ä»¤" class="headerlink" title="â·é•œåƒå‘½ä»¤"></a>â·é•œåƒå‘½ä»¤</h3><p><img src="https://img.jwt1399.top/img/202210031952952.png"></p>
<pre class="line-numbers language-bash"><code class="language-bash">docker images  <span class="token comment" spellcheck="true"># æŸ¥çœ‹é•œåƒ</span>
docker inspect <span class="token comment" spellcheck="true"># æŸ¥çœ‹å…·ä½“é•œåƒ</span>
docker rmi		 <span class="token comment" spellcheck="true"># åˆ é™¤é•œåƒ</span>
docker pull    <span class="token comment" spellcheck="true"># æ‹‰å–é•œåƒ</span>
docker push    <span class="token comment" spellcheck="true"># æ¨é€é•œåƒ</span>
docker save    <span class="token comment" spellcheck="true"># å¯¼å‡ºé•œåƒ</span>
docker load    <span class="token comment" spellcheck="true"># åŠ è½½é•œåƒ</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¸é•œåƒæ¡ˆä¾‹"><a href="#â¸é•œåƒæ¡ˆä¾‹" class="headerlink" title="â¸é•œåƒæ¡ˆä¾‹"></a>â¸é•œåƒæ¡ˆä¾‹</h3><blockquote>
<p>éœ€æ±‚ï¼šä»DockerHubä¸­æ‹‰å–ä¸€ä¸ªnginxé•œåƒå¹¶æŸ¥çœ‹</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1ï¼‰é¦–å…ˆå»é•œåƒä»“åº“æœç´¢nginxé•œåƒï¼Œæ¯”å¦‚DockerHub</span>
<span class="token comment" spellcheck="true"># 2ï¼‰æ ¹æ®æŸ¥çœ‹åˆ°çš„é•œåƒåç§°ï¼Œæ‹‰å–è‡ªå·±éœ€è¦çš„é•œåƒ</span>
docker pull nginx
<span class="token comment" spellcheck="true"># 3ï¼‰æŸ¥çœ‹æ‹‰å–åˆ°çš„é•œåƒ</span>
docker images 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>éœ€æ±‚ï¼šåˆ©ç”¨docker saveå°†nginxé•œåƒå¯¼å‡ºç£ç›˜ï¼Œç„¶åå†é€šè¿‡loadåŠ è½½å›æ¥</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1ï¼‰åˆ©ç”¨docker xx --helpå‘½ä»¤æŸ¥çœ‹è¯­æ³•ï¼Œä¾‹å¦‚ï¼ŒæŸ¥çœ‹saveå‘½ä»¤ç”¨æ³•ï¼Œå¯ä»¥è¾“å…¥å‘½ä»¤ï¼š</span>
docker save --help
<span class="token comment" spellcheck="true"># 2ï¼‰ä½¿ç”¨docker saveå¯¼å‡ºé•œåƒåˆ°ç£ç›˜ </span>
docker save -o nginx.tar nginx:latest
<span class="token comment" spellcheck="true"># 3ï¼‰ä½¿ç”¨docker loadåŠ è½½é•œåƒ</span>
<span class="token comment" spellcheck="true"># å…ˆåˆ é™¤æœ¬åœ°çš„nginxé•œåƒï¼š</span>
docker rmi nginx:latest
<span class="token comment" spellcheck="true"># ç„¶åè¿è¡Œå‘½ä»¤ï¼ŒåŠ è½½æœ¬åœ°æ–‡ä»¶</span>
docker load -i nginx.tar
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="â‘¡å®¹å™¨æ“ä½œ"><a href="#â‘¡å®¹å™¨æ“ä½œ" class="headerlink" title="â‘¡å®¹å™¨æ“ä½œ"></a>â‘¡å®¹å™¨æ“ä½œ</h2><h3 id="â¶å®¹å™¨çŠ¶æ€"><a href="#â¶å®¹å™¨çŠ¶æ€" class="headerlink" title="â¶å®¹å™¨çŠ¶æ€"></a>â¶å®¹å™¨çŠ¶æ€</h3><p>å®¹å™¨ä¿æŠ¤ä¸‰ä¸ªçŠ¶æ€ï¼š</p>
<ul>
<li>è¿è¡Œï¼šè¿›ç¨‹æ­£å¸¸è¿è¡Œ</li>
<li>æš‚åœï¼šè¿›ç¨‹æš‚åœï¼ŒCPUä¸å†è¿è¡Œï¼Œå¹¶ä¸é‡Šæ”¾å†…å­˜</li>
<li>åœæ­¢ï¼šè¿›ç¨‹ç»ˆæ­¢ï¼Œå›æ”¶è¿›ç¨‹å ç”¨çš„å†…å­˜ã€CPUç­‰èµ„æº</li>
</ul>
<h3 id="â·å®¹å™¨å‘½ä»¤"><a href="#â·å®¹å™¨å‘½ä»¤" class="headerlink" title="â·å®¹å™¨å‘½ä»¤"></a>â·å®¹å™¨å‘½ä»¤</h3><p><img src="https://img.jwt1399.top/img/202210032001294.png"></p>
<pre class="line-numbers language-bash"><code class="language-bash">docker <span class="token function">ps</span>       <span class="token comment" spellcheck="true"># æŸ¥çœ‹å®¹å™¨çŠ¶æ€, -a æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬å·²ç»åœæ­¢çš„</span>
docker run      <span class="token comment" spellcheck="true"># åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå¤„äºè¿è¡ŒçŠ¶æ€</span>
docker pause    <span class="token comment" spellcheck="true"># è®©ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨æš‚åœ</span>
docker unpause  <span class="token comment" spellcheck="true"># è®©ä¸€ä¸ªå®¹å™¨ä»æš‚åœçŠ¶æ€æ¢å¤è¿è¡Œ</span>
docker stop     <span class="token comment" spellcheck="true"># åœæ­¢ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨</span>
docker start    <span class="token comment" spellcheck="true"># è®©ä¸€ä¸ªåœæ­¢çš„å®¹å™¨å†æ¬¡è¿è¡Œ</span>
docker <span class="token function">rm</span>       <span class="token comment" spellcheck="true"># åˆ é™¤ä¸€ä¸ªå®¹å™¨</span>
docker <span class="token function">exec</span>     <span class="token comment" spellcheck="true"># è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤</span>
docker logs     <span class="token comment" spellcheck="true"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—çš„å‘½ä»¤,-f å‚æ•°å¯ä»¥æŒç»­æŸ¥çœ‹æ—¥å¿—</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¸å®¹å™¨æ¡ˆä¾‹"><a href="#â¸å®¹å™¨æ¡ˆä¾‹" class="headerlink" title="â¸å®¹å™¨æ¡ˆä¾‹"></a>â¸å®¹å™¨æ¡ˆä¾‹</h3><blockquote>
<p><strong>éœ€æ±‚</strong>ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªnginxå®¹å™¨</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">docker run --name mn -p 80:80 -d nginx
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‘½ä»¤è§£è¯»ï¼š</p>
<ul>
<li>docker run ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨</li>
<li>â€“name : ç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚å«åšmn</li>
<li>-p ï¼šå°†å®¿ä¸»æœºç«¯å£ä¸å®¹å™¨ç«¯å£æ˜ å°„ï¼Œå†’å·å·¦ä¾§æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œå³ä¾§æ˜¯å®¹å™¨ç«¯å£</li>
<li>-dï¼šåå°è¿è¡Œå®¹å™¨</li>
<li>nginxï¼šé•œåƒåç§°ï¼Œä¾‹å¦‚nginx</li>
</ul>
<blockquote>
<p><strong>éœ€æ±‚</strong>ï¼šè¿›å…¥Nginxå®¹å™¨ï¼Œä¿®æ”¹HTMLæ–‡ä»¶å†…å®¹ï¼Œæ·»åŠ â€å“ˆå–½ï¼Œä½ å¥½å‘€ï¼â€</p>
</blockquote>
<p>1ï¼‰è¿›å…¥å®¹å™¨ã€‚è¿›å…¥æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„nginxå®¹å™¨çš„å‘½ä»¤ä¸ºï¼š</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker exec -it mn bash
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‘½ä»¤è§£è¯»ï¼š</p>
<ul>
<li><p>docker exec ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤</p>
</li>
<li><p>-it : ç»™å½“å‰è¿›å…¥çš„å®¹å™¨åˆ›å»ºä¸€ä¸ªæ ‡å‡†è¾“å…¥ã€è¾“å‡ºç»ˆç«¯ï¼Œå…è®¸æˆ‘ä»¬ä¸å®¹å™¨äº¤äº’</p>
</li>
<li><p>mn ï¼šè¦è¿›å…¥çš„å®¹å™¨çš„åç§°</p>
</li>
<li><p>bashï¼šè¿›å…¥å®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œbashæ˜¯ä¸€ä¸ªlinuxç»ˆç«¯äº¤äº’å‘½ä»¤</p>
</li>
</ul>
<p>2ï¼‰è¿›å…¥nginxçš„HTMLæ‰€åœ¨ç›®å½•</p>
<p>æŸ¥çœ‹DockerHubç½‘ç«™ä¸­çš„nginxé¡µé¢ï¼Œå¯ä»¥çŸ¥é“nginxçš„htmlç›®å½•ä½ç½®åœ¨<code>/usr/share/nginx/html</code></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> /usr/share/nginx/html
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3ï¼‰ä¿®æ”¹index.htmlçš„å†…å®¹</p>
<p>å®¹å™¨å†…æ²¡æœ‰viå‘½ä»¤ï¼Œæ— æ³•ç›´æ¥ä¿®æ”¹ï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ä¿®æ”¹ï¼š</p>
<pre class="line-numbers language-sh"><code class="language-sh">sed -i -e 's#Welcome to nginx#å“ˆå–½ï¼Œä½ å¥½å‘€ï¼#g' -e 's#<head>#<head><meta charset="utf-8">#g' index.html
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åœ¨æµè§ˆå™¨è®¿é—® <code>127.0.0.1:80</code> ï¼Œå³å¯çœ‹åˆ°ç»“æœ</p>
<h2 id="â‘¢æ•°æ®å·"><a href="#â‘¢æ•°æ®å·" class="headerlink" title="â‘¢æ•°æ®å·"></a>â‘¢æ•°æ®å·</h2><h3 id="â¶ç®€ä»‹"><a href="#â¶ç®€ä»‹" class="headerlink" title="â¶ç®€ä»‹"></a>â¶ç®€ä»‹</h3><p><strong>æ•°æ®å·ï¼ˆvolumeï¼‰</strong>æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼ŒæŒ‡å‘å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æŸä¸ªç›®å½•ã€‚</p>
<p>æ•°æ®å·çš„ä½œç”¨ï¼šå°†å®¹å™¨ä¸æ•°æ®åˆ†ç¦»ï¼Œè§£è€¦åˆï¼Œæ–¹ä¾¿æ“ä½œå®¹å™¨å†…æ•°æ®ï¼Œä¿è¯æ•°æ®å®‰å…¨</p>
<p><img src="https://img.jwt1399.top/img/202210032028213.png"></p>
<p>ä¸€æ—¦å®Œæˆæ•°æ®å·æŒ‚è½½ï¼Œå¯¹å®¹å™¨çš„ä¸€åˆ‡æ“ä½œéƒ½ä¼šä½œç”¨åœ¨æ•°æ®å·å¯¹åº”çš„å®¿ä¸»æœºç›®å½•äº†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬æ“ä½œå®¿ä¸»æœºçš„&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;htmlç›®å½•ï¼Œå°±ç­‰äºæ“ä½œå®¹å™¨å†…çš„&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;htmlç›®å½•äº†</p>
<h3 id="â·æ•°æ®é›†å‘½ä»¤"><a href="#â·æ•°æ®é›†å‘½ä»¤" class="headerlink" title="â·æ•°æ®é›†å‘½ä»¤"></a>â·æ•°æ®é›†å‘½ä»¤</h3><pre class="line-numbers language-sh"><code class="language-sh">docker volume create     # åˆ›å»ºä¸€ä¸ªæ•°æ®å·
docker volume ls         # åˆ—å‡ºæ‰€æœ‰çš„volume
docker volume inspect    # æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªvolumeçš„ä¿¡æ¯
docker volume rm         # åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„volume
docker volume prune      # åˆ é™¤æœªä½¿ç”¨çš„volume
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¸åˆ›å»ºå’ŒæŸ¥çœ‹æ•°æ®å·"><a href="#â¸åˆ›å»ºå’ŒæŸ¥çœ‹æ•°æ®å·" class="headerlink" title="â¸åˆ›å»ºå’ŒæŸ¥çœ‹æ•°æ®å·"></a>â¸åˆ›å»ºå’ŒæŸ¥çœ‹æ•°æ®å·</h3><p><strong>éœ€æ±‚</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ•°æ®å·ï¼Œå¹¶æŸ¥çœ‹æ•°æ®å·åœ¨å®¿ä¸»æœºçš„ç›®å½•ä½ç½®</p>
<p>â‘  åˆ›å»ºæ•°æ®å·</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker volume create html
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>â‘¡ æŸ¥çœ‹æ‰€æœ‰æ•°æ®</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker volume ls
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>â‘¢ æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯å·</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker volume inspect html
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://img.jwt1399.top/img/202210032037488.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºçš„htmlè¿™ä¸ªæ•°æ®å·å…³è”çš„å®¿ä¸»æœºç›®å½•ä¸º<code>/var/lib/docker/volumes/html/_data</code>ç›®å½•ã€‚</p>
<h3 id="â¹æŒ‚è½½æ•°æ®å·"><a href="#â¹æŒ‚è½½æ•°æ®å·" class="headerlink" title="â¹æŒ‚è½½æ•°æ®å·"></a>â¹æŒ‚è½½æ•°æ®å·</h3><p>æˆ‘ä»¬åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ -v å‚æ•°æ¥æŒ‚è½½ä¸€ä¸ªæ•°æ®å·åˆ°æŸä¸ªå®¹å™¨å†…ç›®å½•ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker run \
  --name mn \
  -v html:/root/html \
  -p 8080:80
  nginx \
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™é‡Œçš„-vå°±æ˜¯æŒ‚è½½æ•°æ®å·çš„å‘½ä»¤ï¼š</p>
<ul>
<li><code>-v html:/root/html</code> ï¼šæŠŠhtmlæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„&#x2F;root&#x2F;htmlè¿™ä¸ªç›®å½•ä¸­</li>
</ul>
<h3 id="âºæ¡ˆä¾‹-ç»™NginxæŒ‚è½½æ•°æ®å·"><a href="#âºæ¡ˆä¾‹-ç»™NginxæŒ‚è½½æ•°æ®å·" class="headerlink" title="âºæ¡ˆä¾‹:ç»™NginxæŒ‚è½½æ•°æ®å·"></a>âºæ¡ˆä¾‹:ç»™NginxæŒ‚è½½æ•°æ®å·</h3><blockquote>
<p><strong>éœ€æ±‚</strong>ï¼šåˆ›å»ºä¸€ä¸ªnginxå®¹å™¨ï¼Œä¿®æ”¹å®¹å™¨å†…çš„htmlç›®å½•å†…çš„index.htmlå†…å®¹</p>
</blockquote>
<p>â‘  åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·åˆ°å®¹å™¨å†…çš„HTMLç›®å½•</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker run --name mn -v html:/usr/share/nginx/html -p 80:80 -d nginx
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>â‘¡ è¿›å…¥htmlæ•°æ®å·æ‰€åœ¨ä½ç½®ï¼Œå¹¶ä¿®æ”¹HTMLå†…å®¹</p>
<pre class="line-numbers language-sh"><code class="language-sh"># æŸ¥çœ‹htmlæ•°æ®å·çš„ä½ç½®
docker volume inspect html
# è¿›å…¥è¯¥ç›®å½•
cd /var/lib/docker/volumes/html/_data
# ä¿®æ”¹æ–‡ä»¶
vi index.html
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨ï¼šmacä¸‹ docker å®é™…æ˜¯åœ¨vmé‡ŒåˆåŠ äº†ä¸€å±‚ï¼Œå› æ­¤éœ€è¦è¿›å…¥ vm æ‰èƒ½æ‰§è¡Œä¸Šé¢æ“ä½œ</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker run -it --privileged --pid<span class="token operator">=</span>host justincormack/nsenter1
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="â»æ¡ˆä¾‹-ç»™MySQLæŒ‚è½½æœ¬åœ°ç›®å½•"><a href="#â»æ¡ˆä¾‹-ç»™MySQLæŒ‚è½½æœ¬åœ°ç›®å½•" class="headerlink" title="â»æ¡ˆä¾‹-ç»™MySQLæŒ‚è½½æœ¬åœ°ç›®å½•"></a>â»æ¡ˆä¾‹-ç»™MySQLæŒ‚è½½æœ¬åœ°ç›®å½•</h3><p>å®¹å™¨ä¸ä»…ä»…å¯ä»¥æŒ‚è½½æ•°æ®å·ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‚è½½åˆ°å®¿ä¸»æœºç›®å½•ä¸Šã€‚å…³è”å…³ç³»å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¸¦æ•°æ®å·æ¨¡å¼ï¼šå®¿ä¸»æœºç›®å½• â€“&gt; æ•°æ®å· â€”&gt; å®¹å™¨å†…ç›®å½•</li>
<li>ç›´æ¥æŒ‚è½½æ¨¡å¼ï¼šå®¿ä¸»æœºç›®å½• â€”&gt; å®¹å™¨å†…ç›®å½•</li>
</ul>
<p><img src="https://img.jwt1399.top/img/202210032118037.png"></p>
<p><strong>è¯­æ³•</strong>ï¼šç›®å½•æŒ‚è½½ä¸æ•°æ®å·æŒ‚è½½çš„è¯­æ³•æ˜¯ç±»ä¼¼çš„ï¼š</p>
<ul>
<li>-v [å®¿ä¸»æœºç›®å½•]:[å®¹å™¨å†…ç›®å½•]</li>
<li>-v [å®¿ä¸»æœºæ–‡ä»¶]:[å®¹å™¨å†…æ–‡ä»¶]</li>
</ul>
<blockquote>
<p><strong>éœ€æ±‚</strong>ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªMySQLå®¹å™¨ï¼Œå°†å®¿ä¸»æœºç›®å½•ç›´æ¥æŒ‚è½½åˆ°å®¹å™¨</p>
</blockquote>
<p>1ï¼‰æ‹‰å–mysqlé•œåƒ</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker pull mysql
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2ï¼‰åˆ›å»ºç›®å½•&#x2F;tmp&#x2F;mysql&#x2F;data</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p /tmp/mysql/data
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3ï¼‰åˆ›å»ºç›®å½•&#x2F;tmp&#x2F;mysql&#x2F;confï¼Œå°†æä¾›çš„hmy.cnfæ–‡ä»¶ä¸Šä¼ åˆ°&#x2F;tmp&#x2F;mysql&#x2F;conf</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p /tmp/mysql/conf
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4ï¼‰å»DockerHubæŸ¥é˜…èµ„æ–™ï¼Œåˆ›å»ºå¹¶è¿è¡ŒMySQLå®¹å™¨ï¼Œè¦æ±‚ï¼š</p>
<p>â‘  æŒ‚è½½&#x2F;tmp&#x2F;mysql&#x2F;dataåˆ°mysqlå®¹å™¨å†…æ•°æ®å­˜å‚¨ç›®å½•</p>
<p>â‘¡ æŒ‚è½½&#x2F;tmp&#x2F;mysql&#x2F;conf&#x2F;hmy.cnfåˆ°mysqlå®¹å™¨çš„é…ç½®æ–‡ä»¶</p>
<p>â‘¢ è®¾ç½®MySQLå¯†ç </p>
<pre class="line-numbers language-bash"><code class="language-bash">docker run \
 --name some-mysql \
 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>root \
 -p 3306:3306 \
 -v /tmp/mysql/data:/var/lib/mysql \
 -v /tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf \
 -d mysql:latest 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ•°æ®å·æŒ‚è½½ä¸ç›®å½•ç›´æ¥æŒ‚è½½çš„åŒºåˆ«</p>
<ul>
<li>æ•°æ®å·æŒ‚è½½è€¦åˆåº¦ä½ï¼Œç”±dockeræ¥ç®¡ç†ç›®å½•ï¼Œä½†æ˜¯ç›®å½•è¾ƒæ·±ï¼Œä¸å¥½æ‰¾</li>
<li>ç›®å½•æŒ‚è½½è€¦åˆåº¦é«˜ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç®¡ç†ç›®å½•ï¼Œä¸è¿‡ç›®å½•å®¹æ˜“å¯»æ‰¾æŸ¥çœ‹</li>
</ul>
<h2 id="â‘£Dockerfile"><a href="#â‘£Dockerfile" class="headerlink" title="â‘£Dockerfile"></a>â‘£Dockerfile</h2><p>å¸¸è§çš„é•œåƒåœ¨DockerHubå°±èƒ½æ‰¾åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„é¡¹ç›®å°±å¿…é¡»è‡ªå·±æ„å»ºé•œåƒäº†ã€‚</p>
<h3 id="â¶é•œåƒç»“æ„"><a href="#â¶é•œåƒç»“æ„" class="headerlink" title="â¶é•œåƒç»“æ„"></a>â¶é•œåƒç»“æ„</h3><p>è¦è‡ªå®šä¹‰é•œåƒï¼Œå°±å¿…é¡»å…ˆäº†è§£é•œåƒçš„ç»“æ„æ‰è¡Œã€‚é•œåƒæ˜¯å°†åº”ç”¨ç¨‹åºåŠå…¶éœ€è¦çš„ç³»ç»Ÿå‡½æ•°åº“ã€ç¯å¢ƒã€é…ç½®ã€ä¾èµ–æ‰“åŒ…è€Œæˆã€‚</p>
<p>æˆ‘ä»¬ä»¥MySQLä¸ºä¾‹ï¼Œæ¥çœ‹çœ‹é•œåƒçš„ç»„æˆç»“æ„ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202210041351237.png"></p>
<p>ç®€å•æ¥è¯´ï¼Œé•œåƒå°±æ˜¯åœ¨ç³»ç»Ÿå‡½æ•°åº“ã€è¿è¡Œç¯å¢ƒåŸºç¡€ä¸Šï¼Œæ·»åŠ åº”ç”¨ç¨‹åºæ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€ä¾èµ–æ–‡ä»¶ç­‰ç»„åˆï¼Œç„¶åç¼–å†™å¥½å¯åŠ¨è„šæœ¬æ‰“åŒ…åœ¨ä¸€èµ·å½¢æˆçš„æ–‡ä»¶ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰Dockerï¼Œæˆ‘ä»¬çš„é•œåƒçš„ç»„æˆï¼Œéœ€è¦å“ªäº›BaseImageã€éœ€è¦æ‹·è´ä»€ä¹ˆæ–‡ä»¶ã€éœ€è¦å®‰è£…ä»€ä¹ˆä¾èµ–ã€å¯åŠ¨è„šæœ¬æ˜¯ä»€ä¹ˆï¼Œå°†æ¥Dockerä¼šå¸®åŠ©æˆ‘ä»¬æ„å»ºé•œåƒã€‚è€Œæè¿°è¿™äº›ä¿¡æ¯çš„æ–‡ä»¶å°±æ˜¯Dockerfileæ–‡ä»¶ã€‚</p>
<h3 id="â·è¯­æ³•"><a href="#â·è¯­æ³•" class="headerlink" title="â·è¯­æ³•"></a>â·è¯­æ³•</h3><p><strong>Dockerfile</strong>å°±æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¸ªçš„**æŒ‡ä»¤(Instruction)**ï¼Œç”¨æŒ‡ä»¤æ¥è¯´æ˜è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œæ¥æ„å»ºé•œåƒã€‚æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå½¢æˆä¸€å±‚Layerã€‚</p>
<p><img src="/../images/SpringCloud-%E5%AE%9E%E7%94%A8%E7%AF%87/image-20221004135210763.png"></p>
<p>æ›´æ–°è¯¦ç»†è¯­æ³•è¯´æ˜ï¼Œè¯·å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder">https://docs.docker.com/engine/reference/builder</a></p>
<h3 id="â¸æ¡ˆä¾‹"><a href="#â¸æ¡ˆä¾‹" class="headerlink" title="â¸æ¡ˆä¾‹"></a>â¸æ¡ˆä¾‹</h3><h4 id="â“µåŸºäºUbuntuæ„å»ºJavaé¡¹ç›®"><a href="#â“µåŸºäºUbuntuæ„å»ºJavaé¡¹ç›®" class="headerlink" title="â“µåŸºäºUbuntuæ„å»ºJavaé¡¹ç›®"></a>â“µåŸºäºUbuntuæ„å»ºJavaé¡¹ç›®</h4><blockquote>
<p>éœ€æ±‚ï¼šåŸºäºUbuntué•œåƒæ„å»ºä¸€ä¸ªæ–°é•œåƒï¼Œè¿è¡Œä¸€ä¸ªjavaé¡¹ç›®</p>
</blockquote>
<p>æ­¥éª¤1ï¼šæ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ docker-demo</p>
<p>æ­¥éª¤2ï¼šæ‹·è´ docker-demo.jar æ–‡ä»¶åˆ° docker-demo ç›®å½•</p>
<p>æ­¥éª¤3ï¼šæ‹·è´ jdk8.tar.gz æ–‡ä»¶åˆ° docker-demo ç›®å½•</p>
<p>æ­¥éª¤4ï¼šåœ¨ docker-demo ç›®å½•ä¸‹æ–°å»º Dockerfileï¼Œå†…å®¹å¦‚ä¸‹</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æŒ‡å®šåŸºç¡€é•œåƒ</span>
FROM ubuntu:16.04
<span class="token comment" spellcheck="true"># é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDKçš„å®‰è£…ç›®å½•</span>
ENV JAVA_DIR<span class="token operator">=</span>/usr/local

<span class="token comment" spellcheck="true"># æ‹·è´jdkå’Œjavaé¡¹ç›®çš„åŒ…</span>
COPY ./jdk8.tar.gz <span class="token variable">$JAVA_DIR</span>/
COPY ./docker-demo.jar /tmp/app.jar

<span class="token comment" spellcheck="true"># å®‰è£…JDK</span>
RUN <span class="token function">cd</span> <span class="token variable">$JAVA_DIR</span> \
 <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> -xf ./jdk8.tar.gz \
 <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> ./jdk1.8.0_144 ./java8

<span class="token comment" spellcheck="true"># é…ç½®ç¯å¢ƒå˜é‡</span>
ENV JAVA_HOME<span class="token operator">=</span><span class="token variable">$JAVA_DIR</span>/java8
ENV PATH<span class="token operator">=</span><span class="token variable">$PATH</span><span class="token keyword">:</span><span class="token variable">$JAVA_HOME</span>/bin

<span class="token comment" spellcheck="true"># æš´éœ²ç«¯å£</span>
EXPOSE 8090
<span class="token comment" spellcheck="true"># å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span>
ENTRYPOINT java -jar /tmp/app.jar
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­¥éª¤5ï¼šè¿›å…¥ docker-demoï¼Œè¿è¡Œå‘½ä»¤</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker build -t javaweb:1.0 <span class="token keyword">.</span>

<span class="token comment" spellcheck="true"># -tä»£è¡¨tagå³åå­—</span>
<span class="token comment" spellcheck="true"># .ä»£è¡¨Dockerfileæ‰€åœ¨çš„ç›®å½•</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­¥éª¤6ï¼šä½¿ç”¨docker runåˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker run --name web -p 8090:8090 -d javaweb:1.0 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æœ€åè®¿é—® <a target="_blank" rel="noopener" href="http://127.0.0.1:8090/hello/count">http://127.0.0.1:8090/hello/count</a></p>
<h4 id="â“¶åŸºäºjava8æ„å»ºJavaé¡¹ç›®"><a href="#â“¶åŸºäºjava8æ„å»ºJavaé¡¹ç›®" class="headerlink" title="â“¶åŸºäºjava8æ„å»ºJavaé¡¹ç›®"></a>â“¶åŸºäºjava8æ„å»ºJavaé¡¹ç›®</h4><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åŸºäºUbuntuåŸºç¡€é•œåƒï¼Œæ·»åŠ ä»»æ„è‡ªå·±éœ€è¦çš„å®‰è£…åŒ…ï¼Œæ„å»ºé•œåƒï¼Œä½†æ˜¯å´æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨ä¸€äº›å®‰è£…äº†éƒ¨åˆ†è½¯ä»¶çš„åŸºç¡€é•œåƒä¸Šåšæ”¹é€ ã€‚ä¾‹å¦‚ï¼Œæ„å»ºjavaé¡¹ç›®çš„é•œåƒï¼Œå¯ä»¥åœ¨å·²ç»å‡†å¤‡äº†JDKçš„åŸºç¡€é•œåƒåŸºç¡€ä¸Šæ„å»ºã€‚</p>
<blockquote>
<p>éœ€æ±‚ï¼šåŸºäºjava:8-alpineé•œåƒï¼Œå°†ä¸€ä¸ªJavaé¡¹ç›®æ„å»ºä¸ºé•œåƒ</p>
</blockquote>
<p>â‘  æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ docker-demo</p>
<p>â‘¡ æ‹·è´ docker-demo.jar åˆ°è¿™ä¸ªç›®å½•ä¸­</p>
<p>â‘¢ åœ¨ç›®å½•ä¸­æ–°å»º Dockerfile æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">FROM java:8-alpine
COPY ./docker-demo.jar /tmp/app.jar
EXPOSE 8090
ENTRYPOINT java -jar /tmp/app.jar
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>â‘£ ä½¿ç”¨docker buildå‘½ä»¤æ„å»ºé•œåƒ</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">docker build -t javaweb:2.0 <span class="token keyword">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>â‘¤ ä½¿ç”¨docker runåˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">docker run --name web -p 8090:8090 -d javaweb:2.0 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="â‘¤DockerCompose"><a href="#â‘¤DockerCompose" class="headerlink" title="â‘¤DockerCompose"></a>â‘¤DockerCompose</h2><h3 id="â¶ç®€ä»‹-1"><a href="#â¶ç®€ä»‹-1" class="headerlink" title="â¶ç®€ä»‹"></a>â¶ç®€ä»‹</h3><p>åœ¨çº¿ä¸Šç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¸ä¼šå°†é¡¹ç›®çš„æ‰€æœ‰ç»„ä»¶æ”¾åˆ°åŒä¸€ä¸ªå®¹å™¨ä¸­ï¼›æ›´å¥½çš„åšæ³•æ˜¯<strong>æŠŠæ¯ä¸ªç‹¬ç«‹çš„åŠŸèƒ½è£…è¿›å•ç‹¬çš„å®¹å™¨</strong>ï¼Œè¿™æ ·æ–¹ä¾¿å¤ç”¨ã€‚å› æ­¤åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šä¼šè¿è¡Œç€å¤šä¸ªå®¹å™¨ï¼Œå¦‚æœæ¯æ¬¡éƒ½é ä¸€æ¡æ¡æŒ‡ä»¤å»å¯åŠ¨ï¼Œæœªå…ä¹Ÿå¤ªç¹çäº†ã€‚ <code>Docker-compose</code> å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå®ƒç”¨æ¥ç¼–æ’å¤šä¸ªå®¹å™¨ï¼Œå°†å¯åŠ¨å®¹å™¨çš„å‘½ä»¤ç»Ÿä¸€å†™åˆ° <code>docker-compose.yml</code> æ–‡ä»¶ä¸­ï¼Œä»¥åæ¯æ¬¡å¯åŠ¨è¿™ä¸€ç»„å®¹å™¨æ—¶ï¼Œåªéœ€è¦ <code>docker-compose up</code> å°±å¯ä»¥äº†ã€‚</p>
<p>å…¶å®DockerComposeæ–‡ä»¶å¯ä»¥çœ‹åšæ˜¯å°†å¤šä¸ªdocker runå‘½ä»¤å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œåªæ˜¯è¯­æ³•ç¨æœ‰å·®å¼‚ã€‚</p>
<p>Composeæ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œé€šè¿‡æŒ‡ä»¤å®šä¹‰é›†ç¾¤ä¸­çš„æ¯ä¸ªå®¹å™¨å¦‚ä½•è¿è¡Œã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>
 <span class="token key atrule">services</span><span class="token punctuation">:</span>
  mysql<span class="token punctuation">:</span>
    image<span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.25
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
     <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root 
    volumes<span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token string">"/tmp/mysql/data:/var/lib/mysql"</span>
     <span class="token punctuation">-</span> <span class="token string">"/tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf"</span>
  web<span class="token punctuation">:</span>
    build<span class="token punctuation">:</span> .
    ports<span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token string">"8090:8090"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„Composeæ–‡ä»¶å°±æè¿°ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå®¹å™¨ï¼š</p>
<ul>
<li>mysqlï¼šä¸€ä¸ªåŸºäº<code>mysql:5.7.25</code>é•œåƒæ„å»ºçš„å®¹å™¨ï¼Œå¹¶ä¸”æŒ‚è½½äº†ä¸¤ä¸ªç›®å½•</li>
<li>webï¼šä¸€ä¸ªåŸºäº<code>docker build</code>ä¸´æ—¶æ„å»ºçš„é•œåƒå®¹å™¨ï¼Œæ˜ å°„ç«¯å£æ—¶8090</li>
</ul>
<p>DockerComposeçš„è¯¦ç»†è¯­æ³•å‚è€ƒå®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></p>
<h3 id="â·æ¡ˆä¾‹ï¼šéƒ¨ç½²å¾®æœåŠ¡é›†ç¾¤"><a href="#â·æ¡ˆä¾‹ï¼šéƒ¨ç½²å¾®æœåŠ¡é›†ç¾¤" class="headerlink" title="â·æ¡ˆä¾‹ï¼šéƒ¨ç½²å¾®æœåŠ¡é›†ç¾¤"></a>â·æ¡ˆä¾‹ï¼šéƒ¨ç½²å¾®æœåŠ¡é›†ç¾¤</h3><blockquote>
<p><strong>éœ€æ±‚</strong>ï¼šå°†ä¹‹å‰å­¦ä¹ çš„cloud-demoå¾®æœåŠ¡é›†ç¾¤åˆ©ç”¨DockerComposeéƒ¨ç½²</p>
</blockquote>
<p><strong>å®ç°æ€è·¯</strong>ï¼š</p>
<p>â‘  åœ¨cloud-demoæ–‡ä»¶å¤¹ç¼–å†™docker-composeæ–‡ä»¶</p>
<p>â‘¡ ä¿®æ”¹è‡ªå·±çš„cloud-demoé¡¹ç›®ï¼Œå°†æ•°æ®åº“ã€nacosåœ°å€éƒ½å‘½åä¸ºdocker-composeä¸­çš„æœåŠ¡å</p>
<p>â‘¢ ä½¿ç”¨mavenæ‰“åŒ…å·¥å…·ï¼Œå°†é¡¹ç›®ä¸­çš„æ¯ä¸ªå¾®æœåŠ¡éƒ½æ‰“åŒ…ä¸ºapp.jar</p>
<p>â‘£ å°†æ‰“åŒ…å¥½çš„app.jaræ‹·è´åˆ°cloud-demoä¸­çš„æ¯ä¸€ä¸ªå¯¹åº”çš„å­ç›®å½•ä¸­</p>
<p>â‘¤ å°†cloud-demoä¸Šä¼ è‡³è™šæ‹Ÿæœºï¼Œåˆ©ç”¨ docker-compose up -d æ¥éƒ¨ç½²</p>
<h4 id="â“µç¼–å†™docker-composeæ–‡ä»¶"><a href="#â“µç¼–å†™docker-composeæ–‡ä»¶" class="headerlink" title="â“µç¼–å†™docker-composeæ–‡ä»¶"></a>â“µç¼–å†™docker-composeæ–‡ä»¶</h4><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.2"</span> <span class="token comment" spellcheck="true">#docker-composeç‰ˆæœ¬</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nacos/nacos<span class="token punctuation">-</span>server
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MODE</span><span class="token punctuation">:</span> standalone
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8848:8848"</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.25
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"$PWD/mysql/data:/var/lib/mysql"</span>
      <span class="token punctuation">-</span> <span class="token string">"$PWD/mysql/conf:/etc/mysql/conf.d/"</span>
  <span class="token key atrule">userservice</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./user<span class="token punctuation">-</span>service
  <span class="token key atrule">orderservice</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./order<span class="token punctuation">-</span>service
  <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./gateway
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"10010:10010"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­åŒ…å«5ä¸ªserviceæœåŠ¡ï¼š</p>
<ul>
<li><code>nacos</code>ï¼šä½œä¸ºæ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ<ul>
<li><code>image: nacos/nacos-server</code>ï¼š åŸºäºnacos&#x2F;nacos-serveré•œåƒæ„å»º</li>
<li><code>environment</code>ï¼šç¯å¢ƒå˜é‡<ul>
<li><code>MODE: standalone</code>ï¼šå•ç‚¹æ¨¡å¼å¯åŠ¨</li>
</ul>
</li>
<li><code>ports</code>ï¼šç«¯å£æ˜ å°„ï¼Œè¿™é‡Œæš´éœ²äº†8848ç«¯å£</li>
</ul>
</li>
<li><code>mysql</code>ï¼šæ•°æ®åº“<ul>
<li><code>image: mysql:5.7.25</code>ï¼šé•œåƒç‰ˆæœ¬æ˜¯mysql:5.7.25</li>
<li><code>environment</code>ï¼šç¯å¢ƒå˜é‡<ul>
<li><code>MYSQL_ROOT_PASSWORD: root</code>ï¼šè®¾ç½®æ•°æ®åº“rootè´¦æˆ·çš„å¯†ç ä¸ºroot</li>
</ul>
</li>
<li><code>volumes</code>ï¼šæ•°æ®å·æŒ‚è½½ï¼Œè¿™é‡ŒæŒ‚è½½äº†mysqlçš„dataã€confç›®å½•</li>
</ul>
</li>
<li><code>userservice</code>ã€<code>orderservice</code>ã€<code>gateway</code>ï¼šéƒ½æ˜¯åŸºäºDockerfileä¸´æ—¶æ„å»ºçš„</li>
</ul>
<h4 id="â“¶ä¿®æ”¹å¾®æœåŠ¡é…ç½®"><a href="#â“¶ä¿®æ”¹å¾®æœåŠ¡é…ç½®" class="headerlink" title="â“¶ä¿®æ”¹å¾®æœåŠ¡é…ç½®"></a>â“¶ä¿®æ”¹å¾®æœåŠ¡é…ç½®</h4><p>å› ä¸ºå¾®æœåŠ¡å°†æ¥è¦éƒ¨ç½²ä¸ºdockerå®¹å™¨ï¼Œè€Œå®¹å™¨ä¹‹é—´äº’è”ä¸æ˜¯é€šè¿‡IPåœ°å€ï¼Œè€Œæ˜¯é€šè¿‡å®¹å™¨åã€‚è¿™é‡Œæˆ‘ä»¬å°†order-serviceã€user-serviceã€gatewayæœåŠ¡çš„mysqlã€nacosåœ°å€éƒ½ä¿®æ”¹ä¸ºåŸºäºå®¹å™¨åçš„è®¿é—®ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//mysql<span class="token punctuation">:</span>3306/cloud_order<span class="token punctuation">?</span>useSSL=false <span class="token comment" spellcheck="true"># mysql</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> orderservice
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span><span class="token number">8848 </span><span class="token comment" spellcheck="true"># nacosæœåŠ¡åœ°å€</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“·æ‰“åŒ…å¾®æœåŠ¡æ¨¡å—"><a href="#â“·æ‰“åŒ…å¾®æœåŠ¡æ¨¡å—" class="headerlink" title="â“·æ‰“åŒ…å¾®æœåŠ¡æ¨¡å—"></a>â“·æ‰“åŒ…å¾®æœåŠ¡æ¨¡å—</h4><p>å°†æ¯ä¸ªå¾®æœåŠ¡éƒ½æ‰“åŒ…ã€‚å› ä¸ºä¹‹å‰æŸ¥çœ‹åˆ°Dockerfileä¸­çš„jaråŒ…åç§°éƒ½æ˜¯app.jarï¼Œå› æ­¤æˆ‘ä»¬çš„æ¯ä¸ªå¾®æœåŠ¡éƒ½éœ€è¦ç”¨è¿™ä¸ªåç§°ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹pom.xmlä¸­çš„æ‰“åŒ…åç§°æ¥å®ç°ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½éœ€è¦ä¿®æ”¹</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
  <span class="token comment" spellcheck="true">&lt;!-- æœåŠ¡æ‰“åŒ…çš„æœ€ç»ˆåç§° --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">></span></span>app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¸ç¼–å†™Dockerfile"><a href="#â“¸ç¼–å†™Dockerfile" class="headerlink" title="â“¸ç¼–å†™Dockerfile"></a>â“¸ç¼–å†™Dockerfile</h4><p>å°†æ¯ä¸ªå¾®æœåŠ¡æ„å»ºæˆé•œåƒï¼Œç¼–å†™ä¸‰ä¸ªDockerfileï¼Œæ”¾å…¥å¯¹åº”ç›®å½•</p>
<pre class="line-numbers language-bash"><code class="language-bash">FROM java:8-alpine
COPY ./app.jar /tmp/app.jar
ENTRYPOINT java -jar /tmp/app.jar
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç¼–è¯‘æ‰“åŒ…å¥½çš„app.jaræ–‡ä»¶ï¼Œéœ€è¦æ”¾åˆ°Dockerfileçš„åŒçº§ç›®å½•ä¸­ã€‚æ³¨æ„ï¼šæ¯ä¸ªå¾®æœåŠ¡çš„app.jaræ”¾åˆ°ä¸æœåŠ¡åç§°å¯¹åº”çš„ç›®å½•ï¼Œåˆ«æé”™äº†ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">.</span>
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ gateway
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ app.jar
â”œâ”€â”€ mysql
â”‚   â”œâ”€â”€ conf
â”‚   â””â”€â”€ data
â”œâ”€â”€ order-service
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ app.jar
â””â”€â”€ user-service
    â”œâ”€â”€ Dockerfile
    â””â”€â”€ app.jar
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¹éƒ¨ç½²"><a href="#â“¹éƒ¨ç½²" class="headerlink" title="â“¹éƒ¨ç½²"></a>â“¹éƒ¨ç½²</h4><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦å°†æ•´ä¸ªcloud-demoæ–‡ä»¶å¤¹ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç”±DockerComposeéƒ¨ç½²ã€‚</p>
<p>è¿›å…¥cloud-demoç›®å½•ï¼Œç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker-compose up -d   # åå°è¿è¡Œå®¹å™¨
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å…¶å®ƒå‘½ä»¤</p>
<pre class="line-numbers language-bash"><code class="language-bash">docker-compose build   <span class="token comment" spellcheck="true"># é‡æ–°æ„å»ºé•œåƒ</span>
docker-compose start   <span class="token comment" spellcheck="true"># å¯åŠ¨å·²æœ‰çš„å®¹å™¨</span>
docker-compose stop    <span class="token comment" spellcheck="true"># åœæ­¢å·²æœ‰çš„å®¹å™¨</span>
docker-compose logs    <span class="token comment" spellcheck="true"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span>
docker-compose down    <span class="token comment" spellcheck="true"># åˆ é™¤å®¹å™¨</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="â‘¥ç§æœ‰ä»“åº“"><a href="#â‘¥ç§æœ‰ä»“åº“" class="headerlink" title="â‘¥ç§æœ‰ä»“åº“"></a>â‘¥ç§æœ‰ä»“åº“</h2><p>ä½¿ç”¨DockerComposeéƒ¨ç½²å¸¦æœ‰å›¾è±¡ç•Œé¢çš„DockerRegistryï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.0'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./registry<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/registry
  <span class="token key atrule">ui</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> joxit/docker<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>ui<span class="token punctuation">:</span>static
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">80</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> REGISTRY_TITLE=ç®€ç®€ç§æœ‰ä»“åº“
      <span class="token punctuation">-</span> REGISTRY_URL=http<span class="token punctuation">:</span>//registry<span class="token punctuation">:</span><span class="token number">5000</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> registry
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="â¶é…ç½®Dockerä¿¡ä»»åœ°å€"><a href="#â¶é…ç½®Dockerä¿¡ä»»åœ°å€" class="headerlink" title="â¶é…ç½®Dockerä¿¡ä»»åœ°å€"></a>â¶é…ç½®Dockerä¿¡ä»»åœ°å€</h3><p>æˆ‘ä»¬çš„ç§æœé‡‡ç”¨çš„æ˜¯httpåè®®ï¼Œé»˜è®¤ä½¿ç”¨HTTPSæ¨é€é•œåƒï¼Œhttpä¸è¢«Dockerä¿¡ä»»ï¼Œæ‰€ä»¥éœ€è¦åšä¸€ä¸ªé…ç½®</p>
<pre class="line-numbers language-sh"><code class="language-sh"># æ‰“å¼€è¦ä¿®æ”¹çš„æ–‡ä»¶
vi /etc/docker/daemon.json
# æ·»åŠ å†…å®¹ï¼š
"insecure-registries":["http://192.168.150.101:8080"]
# é‡åŠ è½½
systemctl daemon-reload
# é‡å¯docker
systemctl restart docker
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®¿é—®<code>http://192.168.150.101:8080</code> å³å¯</p>
<h3 id="â·æ¨é€ã€æ‹‰å–é•œåƒ"><a href="#â·æ¨é€ã€æ‹‰å–é•œåƒ" class="headerlink" title="â·æ¨é€ã€æ‹‰å–é•œåƒ"></a>â·æ¨é€ã€æ‹‰å–é•œåƒ</h3><p>æ¨é€é•œåƒåˆ°ç§æœ‰é•œåƒæœåŠ¡å¿…é¡»å…ˆtagï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>â‘  é‡å‘½åæœ¬åœ°é•œåƒï¼Œåç§°å‰ç¼€ä¸ºç§æœ‰ä»“åº“çš„åœ°å€ï¼š192.168.150.101:8080&#x2F;</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker tag nginx:latest 192.168.150.101:8080/nginx:1.0 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>â‘¡ æ¨é€é•œåƒ</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker push 192.168.150.101:8080/nginx:1.0 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>â‘¢ æ‹‰å–é•œåƒ</p>
<pre class="line-numbers language-sh"><code class="language-sh">docker pull 192.168.150.101:8080/nginx:1.0 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="9-RabbitMQ"><a href="#9-RabbitMQ" class="headerlink" title="9.RabbitMQ"></a>9.RabbitMQ</h1><h2 id="â‘ åˆè¯†MQ"><a href="#â‘ åˆè¯†MQ" class="headerlink" title="â‘ åˆè¯†MQ"></a>â‘ åˆè¯†MQ</h2><h3 id="â¶åŒæ­¥å’Œå¼‚æ­¥"><a href="#â¶åŒæ­¥å’Œå¼‚æ­¥" class="headerlink" title="â¶åŒæ­¥å’Œå¼‚æ­¥"></a>â¶åŒæ­¥å’Œå¼‚æ­¥</h3><ul>
<li><p>åŒæ­¥é€šè®¯ï¼šå°±åƒæ‰“ç”µè¯ï¼Œéœ€è¦å®æ—¶å“åº”ã€‚</p>
</li>
<li><p>å¼‚æ­¥é€šè®¯ï¼šå°±åƒå‘å¾®ä¿¡ï¼Œä¸éœ€è¦é©¬ä¸Šå›å¤ã€‚</p>
</li>
</ul>
<p><img src="https://img.jwt1399.top/img/202210051307025.png"></p>
<p>ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼Œæ‰“ç”µè¯å¯ä»¥ç«‹å³å¾—åˆ°å“åº”ï¼Œä½†æ˜¯ä½ å´ä¸èƒ½è·Ÿå¤šä¸ªäººåŒæ—¶é€šè¯ã€‚å‘é€å¾®ä¿¡å¯ä»¥åŒæ—¶ä¸å¤šäººäº¤æµï¼Œä½†æ˜¯å¾€å¾€å“åº”ä¼šæœ‰å»¶è¿Ÿã€‚</p>
<h4 id="åŒæ­¥é€šè®¯"><a href="#åŒæ­¥é€šè®¯" class="headerlink" title="åŒæ­¥é€šè®¯"></a>åŒæ­¥é€šè®¯</h4><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>è€¦åˆåº¦é«˜</li>
<li>æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™</li>
<li>æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€—</li>
<li>æœ‰çº§è”å¤±è´¥é—®é¢˜</li>
</ul>
<h4 id="å¼‚æ­¥é€šè®¯"><a href="#å¼‚æ­¥é€šè®¯" class="headerlink" title="å¼‚æ­¥é€šè®¯"></a>å¼‚æ­¥é€šè®¯</h4><p>ä¸ºäº†è§£é™¤äº‹ä»¶å‘å¸ƒè€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆï¼Œä¸¤è€…å¹¶ä¸æ˜¯ç›´æ¥é€šä¿¡ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªä¸­é—´äººï¼ˆBrokerï¼‰ã€‚å‘å¸ƒè€…å‘å¸ƒäº‹ä»¶åˆ°Brokerï¼Œä¸å…³å¿ƒè°æ¥è®¢é˜…äº‹ä»¶ã€‚æ¥æ”¶è€…ä»Brokerè®¢é˜…äº‹ä»¶ï¼Œä¸å…³å¿ƒè°å‘æ¥çš„æ¶ˆæ¯ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202210051316444.png"></p>
<p>Broker æ˜¯ä¸€ä¸ªåƒæ•°æ®æ€»çº¿ä¸€æ ·çš„ä¸œè¥¿ï¼Œæ‰€æœ‰çš„æœåŠ¡è¦æ¥æ”¶æ•°æ®å’Œå‘é€æ•°æ®éƒ½å‘åˆ°è¿™ä¸ªæ€»çº¿ä¸Šï¼Œè¿™ä¸ªæ€»çº¿å°±åƒåè®®ä¸€æ ·ï¼Œè®©æœåŠ¡é—´çš„é€šè®¯å˜å¾—æ ‡å‡†å’Œå¯æ§ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>ååé‡æå‡ï¼šæ— éœ€ç­‰å¾…æ¥æ”¶è€…å¤„ç†å®Œæˆï¼Œå“åº”æ›´å¿«é€Ÿ</p>
</li>
<li><p>æ•…éšœéš”ç¦»ï¼šæœåŠ¡æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œä¸å­˜åœ¨çº§è”å¤±è´¥é—®é¢˜</p>
</li>
<li><p>è°ƒç”¨é—´æ²¡æœ‰é˜»å¡ï¼Œä¸ä¼šé€ æˆæ— æ•ˆçš„èµ„æºå ç”¨</p>
</li>
<li><p>è€¦åˆåº¦æä½ï¼šæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥çµæ´»æ’æ‹”ï¼Œå¯æ›¿æ¢</p>
</li>
<li><p>æµé‡å‰Šå³°ï¼šä¸ç®¡å‘å¸ƒäº‹ä»¶çš„æµé‡æ³¢åŠ¨å¤šå¤§ï¼Œéƒ½ç”±Brokeræ¥æ”¶ï¼Œæ¥æ”¶è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„é€Ÿåº¦å»å¤„ç†äº‹ä»¶</p>
</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½ç®¡ç†</li>
<li>éœ€è¦ä¾èµ–äºBrokerçš„å¯é ã€å®‰å…¨ã€æ€§èƒ½</li>
</ul>
<h3 id="â·æ¶ˆæ¯é˜Ÿåˆ—MQ"><a href="#â·æ¶ˆæ¯é˜Ÿåˆ—MQ" class="headerlink" title="â·æ¶ˆæ¯é˜Ÿåˆ—MQ"></a>â·æ¶ˆæ¯é˜Ÿåˆ—MQ</h3><p>æ¯”è¾ƒå¸¸è§çš„ä¸€ç§ Broker å°±æ˜¯ MQ æŠ€æœ¯ï¼Œä¸­æ–‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œå­—é¢æ¥çœ‹å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚</p>
<p>æ¯”è¾ƒå¸¸è§çš„MQå®ç°ï¼šActiveMQã€RabbitMQã€RocketMQã€Kafka</p>
<table>
<thead>
<tr>
<th></th>
<th><strong>RabbitMQ</strong></th>
<th><strong>ActiveMQ</strong></th>
<th><strong>RocketMQ</strong></th>
<th><strong>Kafka</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ç»´æŠ¤è€…</td>
<td>Rabbit</td>
<td>Apache</td>
<td>é˜¿é‡Œ</td>
<td>Apache</td>
</tr>
<tr>
<td>å¼€å‘è¯­è¨€</td>
<td>Erlang</td>
<td>Java</td>
<td>Java</td>
<td>Scala&amp;Java</td>
</tr>
<tr>
<td>åè®®æ”¯æŒ</td>
<td>AMQPï¼ŒXMPPï¼ŒSMTPï¼ŒSTOMP</td>
<td>OpenWireï¼ŒSTOMPï¼ŒRESTï¼ŒXMPPï¼ŒAMQP</td>
<td>è‡ªå®šä¹‰åè®®</td>
<td>è‡ªå®šä¹‰åè®®</td>
</tr>
<tr>
<td>å¯ç”¨æ€§</td>
<td>é«˜</td>
<td>ä¸€èˆ¬</td>
<td>é«˜</td>
<td>é«˜</td>
</tr>
<tr>
<td>ååé‡</td>
<td>ä¸€èˆ¬</td>
<td>å·®</td>
<td>é«˜</td>
<td>éå¸¸é«˜</td>
</tr>
<tr>
<td>æ¶ˆæ¯å»¶è¿Ÿ</td>
<td>å¾®ç§’çº§</td>
<td>æ¯«ç§’çº§</td>
<td>æ¯«ç§’çº§</td>
<td>æ¯«ç§’ä»¥å†…</td>
</tr>
<tr>
<td>æ¶ˆæ¯å¯é æ€§</td>
<td>é«˜</td>
<td>ä¸€èˆ¬</td>
<td>é«˜</td>
<td>ä¸€èˆ¬</td>
</tr>
</tbody></table>
<p>è¿½æ±‚å¯ç”¨æ€§ï¼šKafkaã€ RocketMQ ã€RabbitMQ</p>
<p>è¿½æ±‚å¯é æ€§ï¼šRabbitMQã€RocketMQ</p>
<p>è¿½æ±‚ååèƒ½åŠ›ï¼šRocketMQã€Kafka</p>
<p>è¿½æ±‚æ¶ˆæ¯ä½å»¶è¿Ÿï¼šRabbitMQã€Kafka</p>
<h3 id="â¸RabbitMQç»“æ„"><a href="#â¸RabbitMQç»“æ„" class="headerlink" title="â¸RabbitMQç»“æ„"></a>â¸RabbitMQç»“æ„</h3><table>
<thead>
<tr>
<th>MQæˆå‘˜</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>publisher</td>
<td>ç”Ÿäº§è€…</td>
</tr>
<tr>
<td>consumer</td>
<td>æ¶ˆè´¹è€…</td>
</tr>
<tr>
<td>exchange</td>
<td>äº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±</td>
</tr>
<tr>
<td>queue</td>
<td>é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯</td>
</tr>
<tr>
<td>virtualHost</td>
<td>è™šæ‹Ÿä¸»æœºï¼Œéš”ç¦»ä¸åŒç§Ÿæˆ·çš„ exchangeã€queue</td>
</tr>
</tbody></table>
<p><img src="https://img.jwt1399.top/img/202210051322263.png"></p>
<h3 id="â¹RabbitMQæ¶ˆæ¯æ¨¡å‹"><a href="#â¹RabbitMQæ¶ˆæ¯æ¨¡å‹" class="headerlink" title="â¹RabbitMQæ¶ˆæ¯æ¨¡å‹"></a>â¹RabbitMQæ¶ˆæ¯æ¨¡å‹</h3><p>RabbitMQå®˜æ–¹æä¾›äº†5ä¸ªä¸åŒçš„Demoç¤ºä¾‹ï¼Œå¯¹åº”äº†ä¸åŒçš„æ¶ˆæ¯æ¨¡å‹</p>
<ul>
<li>åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆBasicQueueï¼‰</li>
<li>å·¥ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆWorkQueueï¼‰</li>
<li>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublish&#x2F;Subscribeï¼‰<ul>
<li>å¹¿æ’­ï¼ˆFanout Exchangeï¼‰</li>
<li>è·¯ç”±ï¼ˆDirect Exchangeï¼‰</li>
<li>ä¸»é¢˜ï¼ˆTopic Exchangeï¼‰</li>
</ul>
</li>
</ul>
<h2 id="â‘¡å¿«é€Ÿå…¥é—¨-1"><a href="#â‘¡å¿«é€Ÿå…¥é—¨-1" class="headerlink" title="â‘¡å¿«é€Ÿå…¥é—¨"></a>â‘¡å¿«é€Ÿå…¥é—¨</h2><h3 id="â¶å®‰è£…RabbitMQ"><a href="#â¶å®‰è£…RabbitMQ" class="headerlink" title="â¶å®‰è£…RabbitMQ"></a>â¶å®‰è£…RabbitMQ</h3><ul>
<li>æ‹‰å–é•œåƒ</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">docker pull rabbitmq:3-management
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>è¿è¡Œé•œåƒ</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">docker run \
 -e RABBITMQ_DEFAULT_USER<span class="token operator">=</span>jianjian \
 -e RABBITMQ_DEFAULT_PASS<span class="token operator">=</span>123321 \
 --name mq \
 --hostname mq1 \
 -p 15672:15672 \
 -p 5672:5672 \
 -d rabbitmq:3-management
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®¿é—® <code>http://127.0.0.1:15672</code> å³å¯</p>
<h3 id="â·å…¥é—¨æ¡ˆä¾‹"><a href="#â·å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="â·å…¥é—¨æ¡ˆä¾‹"></a>â·å…¥é—¨æ¡ˆä¾‹</h3><p>åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼çš„æ¨¡å‹å›¾ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202210051435751.png"></p>
<p>å®˜æ–¹çš„HelloWorldæ˜¯åŸºäºæœ€åŸºç¡€çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹æ¥å®ç°çš„ï¼ŒåªåŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š</p>
<ul>
<li>publisherï¼šæ¶ˆæ¯å‘å¸ƒè€…ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—queue</li>
<li>queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè´Ÿè´£æ¥å—å¹¶ç¼“å­˜æ¶ˆæ¯</li>
<li>consumerï¼šè®¢é˜…é˜Ÿåˆ—ï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</li>
</ul>
<h4 id="â“µå‡†å¤‡å·¥ä½œ"><a href="#â“µå‡†å¤‡å·¥ä½œ" class="headerlink" title="â“µå‡†å¤‡å·¥ä½œ"></a>â“µå‡†å¤‡å·¥ä½œ</h4><p>IDEAä¸­å¯¼å…¥Demoå·¥ç¨‹ <a target="_blank" rel="noopener" href="https://jwt1399.lanzouv.com/iw6lR0d7tmob">mq-demo</a>ï¼Œå¯¼å…¥åç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://img.jwt1399.top/img/202210051432528.png"></p>
<p>åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š</p>
<ul>
<li>mq-demoï¼šçˆ¶å·¥ç¨‹ï¼Œç®¡ç†é¡¹ç›®ä¾èµ–</li>
<li>publisherï¼šæ¶ˆæ¯çš„å‘é€è€…</li>
<li>consumerï¼šæ¶ˆæ¯çš„æ¶ˆè´¹è€…</li>
</ul>
<h4 id="â“¶publisherå®ç°"><a href="#â“¶publisherå®ç°" class="headerlink" title="â“¶publisherå®ç°"></a>â“¶publisherå®ç°</h4><p>æ€è·¯ï¼š</p>
<ul>
<li>1.å»ºç«‹è¿æ¥</li>
<li>2.åˆ›å»ºChannel</li>
<li>3.å£°æ˜é˜Ÿåˆ—</li>
<li>4.å‘é€æ¶ˆæ¯</li>
<li>5.å…³é—­è¿æ¥å’Œé€šé“</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PublisherTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> TimeoutException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1.å»ºç«‹è¿æ¥</span>
        ConnectionFactory factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.50.86"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"jianjian"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123321"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 1.2.å»ºç«‹è¿æ¥</span>
        Connection connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 2.åˆ›å»ºé€šé“Channel</span>
        Channel channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 3.åˆ›å»ºé˜Ÿåˆ—</span>
        String queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 4.å‘é€æ¶ˆæ¯</span>
        String message <span class="token operator">=</span> <span class="token string">"hello, rabbitmq!"</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> queueName<span class="token punctuation">,</span> null<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å‘é€æ¶ˆæ¯æˆåŠŸï¼šã€"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 5.å…³é—­é€šé“å’Œè¿æ¥</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“·consumerå®ç°"><a href="#â“·consumerå®ç°" class="headerlink" title="â“·consumerå®ç°"></a>â“·consumerå®ç°</h4><p>æ€è·¯ï¼š</p>
<ul>
<li>1.å»ºç«‹è¿æ¥</li>
<li>2.åˆ›å»ºChannel</li>
<li>3.å£°æ˜é˜Ÿåˆ—</li>
<li>4.è®¢é˜…æ¶ˆæ¯</li>
<li>5.å¤„ç†æ¶ˆæ¯</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> TimeoutException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1.å»ºç«‹è¿æ¥</span>
        ConnectionFactory factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.50.86"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"jianjian"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123321"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 1.2.å»ºç«‹è¿æ¥</span>
        Connection connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 2.åˆ›å»ºé€šé“Channel</span>
        Channel channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 3.åˆ›å»ºé˜Ÿåˆ—</span>
        String queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 4.è®¢é˜…æ¶ˆæ¯</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span>
                                       AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 5.å¤„ç†æ¶ˆæ¯</span>
                String message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¸æ€»ç»“"><a href="#â“¸æ€»ç»“" class="headerlink" title="â“¸æ€»ç»“"></a>â“¸æ€»ç»“</h4><p>åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å‘é€æµç¨‹ï¼š</p>
<ol>
<li><p>å»ºç«‹connection</p>
</li>
<li><p>åˆ›å»ºchannel</p>
</li>
<li><p>åˆ©ç”¨channelå£°æ˜é˜Ÿåˆ—</p>
</li>
<li><p>åˆ©ç”¨channelå‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯</p>
</li>
</ol>
<p>åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶æµç¨‹ï¼š</p>
<ol>
<li><p>å»ºç«‹connection</p>
</li>
<li><p>åˆ›å»ºchannel</p>
</li>
<li><p>åˆ©ç”¨channelå£°æ˜é˜Ÿåˆ—</p>
</li>
<li><p>å®šä¹‰consumerçš„æ¶ˆè´¹è¡Œä¸ºhandleDelivery()</p>
</li>
<li><p>åˆ©ç”¨channelå°†æ¶ˆè´¹è€…ä¸é˜Ÿåˆ—ç»‘å®š</p>
</li>
</ol>
<h2 id="â‘¢SpringAMQP"><a href="#â‘¢SpringAMQP" class="headerlink" title="â‘¢SpringAMQP"></a>â‘¢SpringAMQP</h2><h3 id="âŠç®€ä»‹"><a href="#âŠç®€ä»‹" class="headerlink" title="âŠç®€ä»‹"></a>âŠç®€ä»‹</h3><p>AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰æ˜¯ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’ä¸šåŠ¡æ¶ˆæ¯çš„å¼€æ”¾æ ‡å‡†ã€‚è¯¥åè®®ä¸è¯­è¨€å’Œå¹³å°æ— å…³ï¼Œæ›´ç¬¦åˆå¾®æœåŠ¡ä¸­ç‹¬ç«‹æ€§çš„è¦æ±‚ã€‚</p>
<p>SpringAMQP æ˜¯åŸºäºAMQPåè®® å’Œ RabbitMQ å°è£…çš„ä¸€å¥—APIè§„èŒƒï¼Œæä¾›äº†æ¨¡æ¿æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­spring- amqpæ˜¯åŸºç¡€æŠ½è±¡ï¼Œspring-rabbitæ˜¯åº•å±‚çš„é»˜è®¤å®ç°ã€‚å¹¶ä¸”è¿˜åˆ©ç”¨SpringBootå¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚SpringAMQPçš„å®˜æ–¹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a></p>
<p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</li>
<li>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</li>
<li>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</li>
</ul>
<h3 id="â‹Basic-Queue"><a href="#â‹Basic-Queue" class="headerlink" title="â‹Basic Queue"></a>â‹Basic Queue</h3><p><img src="https://img.jwt1399.top/img/202210051435751.png"></p>
<h4 id="â“µå‡†å¤‡å·¥ä½œ-1"><a href="#â“µå‡†å¤‡å·¥ä½œ-1" class="headerlink" title="â“µå‡†å¤‡å·¥ä½œ"></a>â“µå‡†å¤‡å·¥ä½œ</h4><p>åœ¨çˆ¶å·¥ç¨‹mq-demoä¸­å¼•å…¥ä¾èµ–</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¶æ¶ˆæ¯å‘é€"><a href="#â“¶æ¶ˆæ¯å‘é€" class="headerlink" title="â“¶æ¶ˆæ¯å‘é€"></a>â“¶æ¶ˆæ¯å‘é€</h4><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨publisheræœåŠ¡çš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1 <span class="token comment" spellcheck="true"># ä¸»æœºå</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672 </span><span class="token comment" spellcheck="true"># ç«¯å£</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> / <span class="token comment" spellcheck="true"># è™šæ‹Ÿä¸»æœº</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> jianjian <span class="token comment" spellcheck="true"># ç”¨æˆ·å</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123321 </span><span class="token comment" spellcheck="true"># å¯†ç </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶ååœ¨publisheræœåŠ¡ä¸­ç¼–å†™æµ‹è¯•ç±»SpringAmqpTestï¼Œå¹¶åˆ©ç”¨RabbitTemplateå®ç°æ¶ˆæ¯å‘é€ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringAmqpTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> RabbitTemplate rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimpleQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// é˜Ÿåˆ—åç§°</span>
        String queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// æ¶ˆæ¯</span>
        String message <span class="token operator">=</span> <span class="token string">"hello, spring amqp!"</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å‘é€æ¶ˆæ¯</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“·æ¶ˆæ¯æ¥æ”¶"><a href="#â“·æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="â“·æ¶ˆæ¯æ¥æ”¶"></a>â“·æ¶ˆæ¯æ¥æ”¶</h4><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨consumeræœåŠ¡çš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1 <span class="token comment" spellcheck="true"># ä¸»æœºå</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672 </span><span class="token comment" spellcheck="true"># ç«¯å£</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> / <span class="token comment" spellcheck="true"># è™šæ‹Ÿä¸»æœº</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> jianjian <span class="token comment" spellcheck="true"># ç”¨æˆ·å</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123321 </span><span class="token comment" spellcheck="true"># å¯†ç </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶ååœ¨consumeræœåŠ¡çš„<code>cn.jianjian.mq.listener</code>åŒ…ä¸­æ–°å»ºä¸€ä¸ªç±»SpringRabbitListenerï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringRabbitListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenSimpleQueueMessage</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¸æµ‹è¯•"><a href="#â“¸æµ‹è¯•" class="headerlink" title="â“¸æµ‹è¯•"></a>â“¸æµ‹è¯•</h4><p>å¯åŠ¨consumeræœåŠ¡ï¼Œç„¶ååœ¨publisheræœåŠ¡ä¸­è¿è¡Œæµ‹è¯•ä»£ç ï¼Œå‘é€MQæ¶ˆæ¯</p>
<h3 id="âŒWorkQueue"><a href="#âŒWorkQueue" class="headerlink" title="âŒWorkQueue"></a>âŒWorkQueue</h3><p>Work queues ä¹Ÿè¢«ç§°ä¸º Task queuesã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202210061946056.png"></p>
<p>å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œåˆ™ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ work æ¨¡å‹ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†æ¶ˆæ¯å¤„ç†ï¼Œé€Ÿåº¦å°±èƒ½å¤§å¤§æé«˜äº†ã€‚</p>
<h4 id="â“µæ¶ˆæ¯å‘é€"><a href="#â“µæ¶ˆæ¯å‘é€" class="headerlink" title="â“µæ¶ˆæ¯å‘é€"></a>â“µæ¶ˆæ¯å‘é€</h4><p>è¿™æ¬¡æˆ‘ä»¬å¾ªç¯å‘é€ï¼Œæ¨¡æ‹Ÿå¤§é‡æ¶ˆæ¯å †ç§¯ç°è±¡ã€‚åœ¨publisheræœåŠ¡ä¸­çš„SpringAmqpTestç±»ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testWorkQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// é˜Ÿåˆ—åç§°</span>
    String queueName <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// æ¶ˆæ¯</span>
    String message <span class="token operator">=</span> <span class="token string">"hello, message_"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// å‘é€æ¶ˆæ¯</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> message <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// é¿å…å‘é€å¤ªå¿«</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¶æ¶ˆæ¯æ¥æ”¶"><a href="#â“¶æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="â“¶æ¶ˆæ¯æ¥æ”¶"></a>â“¶æ¶ˆæ¯æ¥æ”¶</h4><p>è¦æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ 2ä¸ªæ–°çš„æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenWorkQueue1</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span> <span class="token operator">+</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"simple.queue"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenWorkQueue2</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span> <span class="token operator">+</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“·æµ‹è¯•"><a href="#â“·æµ‹è¯•" class="headerlink" title="â“·æµ‹è¯•"></a>â“·æµ‹è¯•</h4><p>å¯åŠ¨ConsumerApplicationåï¼Œå†æ‰§è¡ŒpublisheræœåŠ¡ä¸­åˆšåˆšç¼–å†™çš„æµ‹è¯•æ–¹æ³•testWorkQueueã€‚</p>
<p>å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…1å¾ˆå¿«å®Œæˆäº†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…2å´åœ¨ç¼“æ…¢çš„å¤„ç†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æ˜¯å¹³å‡åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚è¿™æ ·æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<h4 id="â“¸æ¶ˆè´¹é¢„å–é™åˆ¶"><a href="#â“¸æ¶ˆè´¹é¢„å–é™åˆ¶" class="headerlink" title="â“¸æ¶ˆè´¹é¢„å–é™åˆ¶"></a>â“¸æ¶ˆè´¹é¢„å–é™åˆ¶</h4><p>é€šè¿‡é…ç½®å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œè®¾ç½®preFetchå€¼ï¼Œå¯ä»¥æ§åˆ¶é¢„å–æ¶ˆæ¯çš„ä¸Šé™</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefetch</span><span class="token punctuation">:</span> <span class="token number">1 </span><span class="token comment" spellcheck="true"># æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="â“¹æ€»ç»“"><a href="#â“¹æ€»ç»“" class="headerlink" title="â“¹æ€»ç»“"></a>â“¹æ€»ç»“</h4><ul>
<li>å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†</li>
<li>é€šè¿‡è®¾ç½®prefetchæ¥æ§åˆ¶æ¶ˆè´¹è€…é¢„å–çš„æ¶ˆæ¯æ•°é‡</li>
</ul>
<h3 id="âPublish-x2F-Subscribe"><a href="#âPublish-x2F-Subscribe" class="headerlink" title="âPublish&#x2F;Subscribe"></a>âPublish&#x2F;Subscribe</h3><p>å‘å¸ƒè®¢é˜…æ¨¡å¼çš„åŒºåˆ«å°±æ˜¯å…è®¸å°†åŒä¸€æ¶ˆæ¯å‘é€ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚å®ç°æ–¹å¼æ˜¯åŠ å…¥äº†exchangeï¼ˆäº¤æ¢æœºï¼‰ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202210062001172.png" alt="å‘å¸ƒè®¢é˜…æ¨¡å‹"></p>
<ul>
<li>Publisherï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™äº¤æ¢æœº</li>
<li>Consumerï¼šæ¶ˆè´¹è€…ï¼Œä¸ä»¥å‰ä¸€æ ·ï¼Œè®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰å˜åŒ–</li>
<li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿä¸ä»¥å‰ä¸€æ ·ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚</li>
<li>Exchangeï¼šäº¤æ¢æœºï¼Œä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰ä»¥ä¸‹3ç§ç±»å‹ï¼š<ul>
<li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li>
<li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</li>
<li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</li>
</ul>
</li>
</ul>
<p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p>
<h4 id="â€Fanout"><a href="#â€Fanout" class="headerlink" title="â€Fanout"></a>â€Fanout</h4><p><img src="https://img.jwt1399.top/img/202210071521150.png"></p>
<p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>1ï¼‰  å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</li>
<li>2ï¼‰  æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ° exchangeï¼ˆäº¤æ¢æœºï¼‰</li>
<li>3ï¼‰  ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœºï¼Œäº¤æ¢æœºæ¥å†³å®šè¦å‘ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ— æ³•å†³å®š</li>
<li>4ï¼‰  äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</li>
<li>5ï¼‰  è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</li>
</ul>
<p><strong>æ¡ˆä¾‹</strong></p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº jianjian.fanoutï¼Œç±»å‹æ˜¯ Fanout</li>
<li>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—fanout.queue1å’Œfanout.queue2ï¼Œç»‘å®šåˆ°äº¤æ¢æœº jianjian.fanout</li>
</ul>
<h5 id="â€å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a href="#â€å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº" class="headerlink" title="â€å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a>â€å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h5><p>Springæä¾›äº†ä¸€ä¸ªæ¥å£Exchangeï¼Œæ¥è¡¨ç¤ºæ‰€æœ‰ä¸åŒç±»å‹çš„äº¤æ¢æœºï¼š</p>
<p><img src="https://img.jwt1399.top/img/202210071521480.png"></p>
<p>åœ¨consumerä¸­åˆ›å»ºä¸€ä¸ªç±»ï¼Œå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FanoutConfig</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * å£°æ˜äº¤æ¢æœº
     * @return Fanoutç±»å‹äº¤æ¢æœº
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> FanoutExchange <span class="token function">fanoutExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token string">"jianjian.fanout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * ç¬¬1ä¸ªé˜Ÿåˆ—
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> Queue <span class="token function">fanoutQueue1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"fanout.queue1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> Binding <span class="token function">bindingQueue1</span><span class="token punctuation">(</span>Queue fanoutQueue1<span class="token punctuation">,</span> FanoutExchange fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> BindingBuilder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fanoutQueue1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * ç¬¬2ä¸ªé˜Ÿåˆ—
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> Queue <span class="token function">fanoutQueue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"fanout.queue2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> Binding <span class="token function">bindingQueue2</span><span class="token punctuation">(</span>Queue fanoutQueue2<span class="token punctuation">,</span> FanoutExchange fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> BindingBuilder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fanoutQueue2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="âæ¶ˆæ¯å‘é€"><a href="#âæ¶ˆæ¯å‘é€" class="headerlink" title="âæ¶ˆæ¯å‘é€"></a>âæ¶ˆæ¯å‘é€</h5><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFanoutExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// é˜Ÿåˆ—åç§°</span>
    String exchangeName <span class="token operator">=</span> <span class="token string">"jianjian.fanout"</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// æ¶ˆæ¯</span>
    String message <span class="token operator">=</span> <span class="token string">"hello, everyone!"</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="â‚æ¶ˆæ¯æ¥æ”¶"><a href="#â‚æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="â‚æ¶ˆæ¯æ¥æ”¶"></a>â‚æ¶ˆæ¯æ¥æ”¶</h5><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä½œä¸ºæ¶ˆè´¹è€…ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"fanout.queue1"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenFanoutQueue1</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…1æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"fanout.queue2"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenFanoutQueue2</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…2æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="âƒæ€»ç»“"><a href="#âƒæ€»ç»“" class="headerlink" title="âƒæ€»ç»“"></a>âƒæ€»ç»“</h5><p>äº¤æ¢æœºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æ¥æ”¶publisherå‘é€çš„æ¶ˆæ¯</li>
<li>å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li>
<li>ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¤±</li>
<li>FanoutExchangeä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ—</li>
</ul>
<p>å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»çš„Beanæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>Queue</li>
<li>FanoutExchange</li>
<li>Binding</li>
</ul>
<h4 id="âDirect"><a href="#âDirect" class="headerlink" title="âDirect"></a>âDirect</h4><p>åœ¨<code>Fanout</code>æ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«æ‰€æœ‰è®¢é˜…çš„é˜Ÿåˆ—éƒ½æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ¶ˆæ¯è¢«ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚è¿™æ—¶å°±è¦ç”¨åˆ°<code>Direct</code>ç±»å‹çš„exchangeã€‚</p>
<p><img src="https://img.jwt1399.top/img/202210071530068.png"></p>
<p> åœ¨Directæ¨¡å‹ä¸‹ï¼š</p>
<ul>
<li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</li>
<li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨å‘ exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</li>
<li>exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„<code>Routing Key</code>è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„<code>Routingkey</code>ä¸æ¶ˆæ¯çš„ <code>Routing key</code>å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li>
</ul>
<p><strong>æ¡ˆä¾‹</strong></p>
<ol>
<li><p>åˆ©ç”¨@RabbitListenerå£°æ˜Exchangeã€Queueã€RoutingKey</p>
</li>
<li><p>åœ¨consumeræœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬direct.queue1å’Œdirect.queue2</p>
</li>
<li><p>åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘jianjian. directå‘é€æ¶ˆæ¯</p>
</li>
</ol>
<h5 id="â€åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a href="#â€åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº" class="headerlink" title="â€åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a>â€åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h5><p>åŸºäº@Beançš„æ–¹å¼å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæ¯”è¾ƒéº»çƒ¦ï¼ŒSpringè¿˜æä¾›äº†åŸºäºæ³¨è§£æ–¹å¼æ¥å£°æ˜ã€‚</p>
<p>åœ¨consumerçš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒåŒæ—¶åŸºäºæ³¨è§£æ¥å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"direct.queue1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"jianjian.direct"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ExchangeTypes<span class="token punctuation">.</span>DIRECT<span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenDirectQueue1</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"direct.queue2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"jianjian.direct"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ExchangeTypes<span class="token punctuation">.</span>DIRECT<span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenDirectQueue2</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="âæ¶ˆæ¯å‘é€-1"><a href="#âæ¶ˆæ¯å‘é€-1" class="headerlink" title="âæ¶ˆæ¯å‘é€"></a>âæ¶ˆæ¯å‘é€</h5><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendDirectExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// äº¤æ¢æœºåç§°</span>
    String exchangeName <span class="token operator">=</span> <span class="token string">"jianjian.direct"</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// æ¶ˆæ¯</span>
    String message <span class="token operator">=</span> <span class="token string">"çº¢è‰²è­¦æŠ¥ï¼æ—¥æœ¬ä¹±æ’æ ¸åºŸæ°´ï¼Œå¯¼è‡´æµ·æ´‹ç”Ÿç‰©å˜å¼‚ï¼ŒæƒŠç°å“¥æ–¯æ‹‰ï¼"</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="â‚æ€»ç»“"><a href="#â‚æ€»ç»“" class="headerlink" title="â‚æ€»ç»“"></a>â‚æ€»ç»“</h5><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Fanoutäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p>
<ul>
<li>Fanoutäº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li>
<li>Directäº¤æ¢æœºæ ¹æ®RoutingKeyåˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ—</li>
<li>å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„RoutingKeyï¼Œåˆ™ä¸FanoutåŠŸèƒ½ç±»ä¼¼</li>
</ul>
<p>åŸºäº@RabbitListeneræ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæœ‰å“ªäº›å¸¸è§æ³¨è§£ï¼Ÿ</p>
<ul>
<li>@Queue</li>
<li>@Exchange</li>
</ul>
<h4 id="â‚Topic"><a href="#â‚Topic" class="headerlink" title="â‚Topic"></a>â‚Topic</h4><p><code>Topic</code>ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡<code>Topic</code>ç±»å‹<code>exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>Routing key</code> çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼</p>
<p><img src="https://img.jwt1399.top/img/202210071539760.png"></p>
<p><code>Routingkey</code> ä¸€èˆ¬éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥â€œ<code>.</code>â€åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p>
<p> é€šé…ç¬¦è§„åˆ™ï¼š</p>
<ul>
<li><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</li>
<li><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</li>
</ul>
<p>ä¸¾ä¾‹ï¼š</p>
<p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p>
<p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code></p>
<p>è§£é‡Šï¼š</p>
<ul>
<li>Queue1ï¼šç»‘å®šçš„æ˜¯<code>china.#</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>china.</code>å¼€å¤´çš„<code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°ã€‚åŒ…æ‹¬china.newså’Œchina.weather</li>
<li>Queue2ï¼šç»‘å®šçš„æ˜¯<code>#.news</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>.news</code>ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…ã€‚åŒ…æ‹¬china.newså’Œjapan.news</li>
</ul>
<p><strong>æ¡ˆä¾‹</strong></p>
<ol>
<li><p>å¹¶åˆ©ç”¨@RabbitListenerå£°æ˜Exchangeã€Queueã€RoutingKey</p>
</li>
<li><p>åœ¨consumeræœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬topic.queue1å’Œtopic.queue2</p>
</li>
<li><p>åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘jianjian. topicå‘é€æ¶ˆæ¯</p>
</li>
</ol>
<h5 id="â€æ¶ˆæ¯å‘é€"><a href="#â€æ¶ˆæ¯å‘é€" class="headerlink" title="â€æ¶ˆæ¯å‘é€"></a>â€æ¶ˆæ¯å‘é€</h5><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendTopicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// äº¤æ¢æœºåç§°</span>
    String exchangeName <span class="token operator">=</span> <span class="token string">"itcast.topic"</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// æ¶ˆæ¯</span>
    String message <span class="token operator">=</span> <span class="token string">"å–œæŠ¥ï¼å­™æ‚Ÿç©ºå¤§æˆ˜å“¥æ–¯æ‹‰ï¼Œèƒœ!"</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">"china.news"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="âæ¶ˆæ¯æ¥æ”¶"><a href="#âæ¶ˆæ¯æ¥æ”¶" class="headerlink" title="âæ¶ˆæ¯æ¥æ”¶"></a>âæ¶ˆæ¯æ¥æ”¶</h5><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"topic.queue1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"jianjian.topic"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ExchangeTypes<span class="token punctuation">.</span>TOPIC<span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token string">"china.#"</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopicQueue1</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"topic.queue2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"jianjian.topic"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ExchangeTypes<span class="token punctuation">.</span>TOPIC<span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token string">"#.news"</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopicQueue2</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"ã€‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="â‚æ€»ç»“-1"><a href="#â‚æ€»ç»“-1" class="headerlink" title="â‚æ€»ç»“"></a>â‚æ€»ç»“</h5><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Topicäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p>
<ul>
<li>Topicäº¤æ¢æœºæ¥æ”¶çš„æ¶ˆæ¯RoutingKeyå¿…é¡»æ˜¯å¤šä¸ªå•è¯ï¼Œä»¥ <code>.</code> åˆ†å‰²</li>
<li>Topicäº¤æ¢æœºä¸é˜Ÿåˆ—ç»‘å®šæ—¶çš„bindingKeyå¯ä»¥æŒ‡å®šé€šé…ç¬¦<ul>
<li><code>#</code>ï¼šä»£è¡¨0ä¸ªæˆ–å¤šä¸ªè¯</li>
<li><code>*</code>ï¼šä»£è¡¨1ä¸ªè¯</li>
</ul>
</li>
</ul>
<h3 id="â‘æ¶ˆæ¯è½¬æ¢å™¨"><a href="#â‘æ¶ˆæ¯è½¬æ¢å™¨" class="headerlink" title="â‘æ¶ˆæ¯è½¬æ¢å™¨"></a>â‘æ¶ˆæ¯è½¬æ¢å™¨</h3><p>Springä¼šæŠŠä½ å‘é€çš„æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—èŠ‚å‘é€ç»™MQï¼Œæ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿˜ä¼šæŠŠå­—èŠ‚ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202210082150457.png"></p>
<p>åªä¸è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹Springé‡‡ç”¨çš„åºåˆ—åŒ–æ–¹å¼æ˜¯JDKåºåˆ—åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJDKåºåˆ—åŒ–å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p>
<ul>
<li>æ•°æ®ä½“ç§¯è¿‡å¤§</li>
<li>æœ‰å®‰å…¨æ¼æ´</li>
<li>å¯è¯»æ€§å·®</li>
</ul>
<h4 id="â€æµ‹è¯•é»˜è®¤è½¬æ¢å™¨"><a href="#â€æµ‹è¯•é»˜è®¤è½¬æ¢å™¨" class="headerlink" title="â€æµ‹è¯•é»˜è®¤è½¬æ¢å™¨"></a>â€æµ‹è¯•é»˜è®¤è½¬æ¢å™¨</h4><p>æˆ‘ä»¬ä¿®æ”¹æ¶ˆæ¯å‘é€çš„ä»£ç ï¼Œå‘é€ä¸€ä¸ªMapå¯¹è±¡ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// å‡†å¤‡æ¶ˆæ¯</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    msg<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    msg<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"simple.queue"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‘é€æ¶ˆæ¯åæŸ¥çœ‹æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ¶ˆæ¯å¾ˆé•¿ï¼Œå¯è¯»æ€§å·®ã€‚</p>
<p><img src="https://img.jwt1399.top/img/202210082150423.png"></p>
<h4 id="âé…ç½®JSONè½¬æ¢å™¨"><a href="#âé…ç½®JSONè½¬æ¢å™¨" class="headerlink" title="âé…ç½®JSONè½¬æ¢å™¨"></a>âé…ç½®JSONè½¬æ¢å™¨</h4><p>æ˜¾ç„¶ï¼ŒJDKåºåˆ—åŒ–æ–¹å¼å¹¶ä¸åˆé€‚ã€‚æˆ‘ä»¬å¸Œæœ›æ¶ˆæ¯ä½“çš„ä½“ç§¯æ›´å°ã€å¯è¯»æ€§æ›´é«˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨JSONæ–¹å¼æ¥åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<p>åœ¨publisherå’Œconsumerä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å¼•å…¥jacksonä¾èµ–ï¼š</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.dataformat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-dataformat-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ï¼Œåœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªBeanå³å¯ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> MessageConverter <span class="token function">jsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="10-elasticsearch"><a href="#10-elasticsearch" class="headerlink" title="10.elasticsearch"></a>10.elasticsearch</h1><h1 id="Sponsorâ¤ï¸"><a href="#Sponsorâ¤ï¸" class="headerlink" title="Sponsorâ¤ï¸"></a>Sponsorâ¤ï¸</h1><p>æ‚¨çš„æ”¯æŒæ˜¯æˆ‘ä¸æ–­å‰è¿›çš„åŠ¨åŠ›ï¼Œå¦‚æœæ‚¨æ„Ÿè§‰æœ¬æ–‡å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©çš„è¯ï¼Œå¯ä»¥è€ƒè™‘æ‰“èµä¸€ä¸‹æœ¬æ–‡ï¼Œç”¨ä»¥ç»´æŒæœ¬åšå®¢çš„è¿è¥è´¹ç”¨ï¼Œæ‹’ç»ç™½å«–ï¼Œä»ä½ æˆ‘åšèµ·ï¼ğŸ¥°ğŸ¥°ğŸ¥°</p>
<table>
  <tbody>
     <tr>
         <td style="text-align:center;">æ”¯ä»˜å®</td>
         <td style="text-align:center;">å¾®ä¿¡</td>
     </tr>
   <tr>
    <td style="text-align:center;" ><img width="200" src="https://jwt1399.top/medias/reward/alipay.png"></td>    
      <td style="text-align:center;"><img width="200" src="https://jwt1399.top/medias/reward/sponor_wechat.png"></td>     
  </tr>
</tbody></table>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jwt1399.top" rel="external nofollow noreferrer">ç®€ç®€</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jwt1399.top/posts/42622.html">https://jwt1399.top/posts/42622.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="https://jwt1399.top" target="_blank">ç®€ç®€</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/SpringCloud/">
                                    <span class="chip bg-color">SpringCloud</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,linkedin,facebook,twitter,google,douban" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">æ‰“</a>
	<a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>
    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">ä½ çš„èµè¯†æ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        /*max-width: 100%;*/
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
    .v[data-class=v] .vinput {
     padding: 0px 0px;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>è¯„è®º<center>å¡«ä¸Šé‚®ç®±ä¼šæ”¶åˆ°è¯„è®ºå›å¤æé†’å“¦!!!</center></span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/valine/1.4.18/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'Awf92dhT3VWqTfENqbCDoqbA-gzGzoHsz',
        appKey: '9uN7ODvigK9GAp8CYBz0fOrX',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: '',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '[å¡«ä¸Šé‚®ç®±ï¼Œä¼šç»™ä½ å‘é€è¯„è®ºæé†’]ï¼Œãƒ¾ï¾‰â‰§âˆ€â‰¦)o è¯·ç•…æ‰€æ¬²è¨€~',
        enableQQ: true,
        boolean: true,
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/posts/44711.html">
                    <div class="card-image">
                        
                        <img src="https://img.jwt1399.top/img/20220118195531.png" class="responsive-img" alt="å¯æœç´¢åŠ å¯†ï¼šVFSAæ–¹æ¡ˆ">
                        
                        <span class="card-title">å¯æœç´¢åŠ å¯†ï¼šVFSAæ–¹æ¡ˆ</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            è®ºæ–‡åç§°ï¼šã€ŠVerifiable Fuzzy Multi-keyword Search over Encrypted Data with Adaptive Securityã€‹

ä½œè€…ï¼šç«¥ç§‹äº‘; è‹—é“¶æ–Œ; ç†Šå¥; åˆ˜å¸ŒèŒ; é‡‘å…‰Â·é›·è’™å¾·Â·å‘¨;
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-09-30
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Crypto/" class="post-category">
                                    Crypto
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%8F%AF%E6%90%9C%E7%B4%A2%E5%8A%A0%E5%AF%86/">
                        <span class="chip bg-color">å¯æœç´¢åŠ å¯†</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/58591.html">
                    <div class="card-image">
                        
                        <img src="https://img.jwt1399.top/img/202206151419096.png" class="responsive-img" alt="SpringBoot-æ•´åˆç¯‡">
                        
                        <span class="card-title">SpringBoot-æ•´åˆç¯‡</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
æ•´åˆç¯‡åŒ…å«SpringBootå¯¹å„ç§ç¬¬ä¸‰æ–¹æŠ€æœ¯çš„æ•´åˆã€‚ä¾‹å¦‚SQLã€NoSQLã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å®šæ—¶ä»»åŠ¡ã€æ–‡æ¡£æ“ä½œã€è®¤è¯æˆæƒã€æ¶ˆæ¯é€šçŸ¥ç­‰ç­‰

å°ç®€ä» 0 å¼€å§‹å­¦ Java çŸ¥è¯†ä¹‹ Java-å­¦ä¹ è·¯çº¿ ä¸­çš„ã€ŠSpringBoot-æ•´åˆç¯‡ã€‹ï¼Œä¸
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-09-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Spring/" class="post-category">
                                    Spring
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/SpringBoot/">
                        <span class="chip bg-color">SpringBoot</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('100')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'æ¥æº: ç®€è¨€ä¹‹<br />'
            + 'æ–‡ç« ä½œè€…: ç®€ç®€<br />'
            + 'æ–‡ç« é“¾æ¥: <a href="' + url + '">' + url + '</a><br />'
            + 'æœ¬æ–‡ç« è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½éƒ½è¯·æ³¨æ˜å‡ºå¤„ã€‚';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- ä»£ç è¯­è¨€ -->

    
<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- ä»£ç å—æŠ˜è¡Œ -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h1, h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://jwt1399.top" target="_blank"><b>ç®€ç®€</b>&nbsp;|&nbsp;Sponsored by</a>
            <!-- <span>|&nbsp;ä¸º ğŸ’—ğŸ’ğŸ©· å‘ç”µ</span> -->
            <!-- |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> -->
            <!-- |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>&nbsp;| -->

			
            <a target="_blank" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"><img no-lazy src="https://img.jwt1399.top/img/20200824181422.png" style="width: 47px; vertical-align: middle;" ></a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;Word:&nbsp;<span
                class="white-color">1130k</span>&nbsp;å­—
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;PV:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;æ¬¡
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;UV:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;äºº
            </span>
            
            <br>

            
            <span id="sitetime">è½½å…¥è¿è¡Œæ—¶é—´...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "7";
                    var startDate = "2";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffDays + " å¤© " + diffHours +
                            " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffYears + " å¹´ " + diffDays +
                            " å¤© " + diffHours + " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            <a href="https://search.google.com/search-console?resource_id=http%3A%2F%2Fjwt1399.top%2F" target="_blank"
                rel="nofollow noopener">è°·æ­Œç»Ÿè®¡</a>&nbsp;|
            
            <span id="icp"><img no-lazy src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="http://www.beian.miit.gov.cn/" target="_blank">èœ€ICPå¤‡19020450å·</a>
            </span>
            |
            
            <a href="https://tongji.baidu.com/web/10000159136/overview/index?siteId=14519996" target="_blank"
                rel="nofollow noopener">ç™¾åº¦ç»Ÿè®¡</a>

        </div>
        <div class="col s12 m4 l4 social-link social-statis">

    <a href="https://jwt1399.top/baidusitemap.xml" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„sitemap" data-position="top" data-delay="50">
        <i class="fas fa-sitemap"></i>
    </a>


    <a href="https://pl.jwt1399.top" class="tooltipped" target="_blank" data-tooltip="valineè¯„è®º: https://pl.jwt1399.top" data-position="top" data-delay="50">
        <i class="fab fa-optin-monster"></i>
    </a>


    <a href="mailto:1019084218@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope"></i>
    </a>













    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1019084218" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 1019084218" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>


    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>

    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.json", 'searchInput', 'searchResult');
});
</script>
    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.staticfile.org/aos/3.0.0-beta.6/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>
	<!--valine_äººæœºéªŒè¯-->
	<button id="TencentCaptcha"data-appid="2046265119"data-cbfn="callback"type="button" hidden></button>
	
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160042502-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-160042502-1');
</script>


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?0e306ce3426983ae6367d094d39f1190";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon.min.js" async="async"></script>
    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

        
</body>

</html>
